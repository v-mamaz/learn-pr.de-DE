<span data-ttu-id="020b8-101">Das vorherrschende Sicherheitsrisiko für Anwendungen besteht heute darin, dass aus externen Quellen empfangene Eingaben, insbesondere _Benutzereingaben_, nicht ordnungsgemäß verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="020b8-101">The most prevalent security weakness of applications today is to not correctly process input received from external sources, particularly _user input_.</span></span> <span data-ttu-id="020b8-102">Sie sollten sich Eingaben immer genau ansehen, um sicherzustellen, dass sie vor der Verwendung überprüft wurden.</span><span class="sxs-lookup"><span data-stu-id="020b8-102">You should always take a close look at any input to make sure it has been validated before it is used.</span></span> <span data-ttu-id="020b8-103">Andernfalls kann das Ergebnis der Verlust oder die Offenlegung von Daten, die Ausweitung von Rechten oder sogar die Ausführung von schädlichem Code auf den Computern anderer Benutzer sein.</span><span class="sxs-lookup"><span data-stu-id="020b8-103">Failing to do this can result in data loss or exposure, escalation of privilege, or even execution of malicious code on other users' computers.</span></span>

<span data-ttu-id="020b8-104">Dabei kann dieses Problem einfach gelöst werden.</span><span class="sxs-lookup"><span data-stu-id="020b8-104">The tragic thing is that this is an easy problem to solve.</span></span> <span data-ttu-id="020b8-105">Hier wird der Umgang mit Daten behandelt: wenn sie empfangen werden, wenn sie auf dem Bildschirm angezeigt werden und wenn sie für die spätere Verwendung gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="020b8-105">Here we will cover how to treat data; when it’s received, when it’s displayed on the screen, and when it's stored for later use.</span></span>

## <a name="why-do-we-need-to-validate-our-input"></a><span data-ttu-id="020b8-106">Warum müssen wir unsere Eingaben überprüfen?</span><span class="sxs-lookup"><span data-stu-id="020b8-106">Why do we need to validate our input?</span></span>

<span data-ttu-id="020b8-107">Angenommen, Sie erstellen eine Schnittstelle, damit ein Benutzer auf Ihrer Website ein Konto erstellen kann.</span><span class="sxs-lookup"><span data-stu-id="020b8-107">Imagine that you are building an interface to allow a user to create an account on your website.</span></span> <span data-ttu-id="020b8-108">Unsere Profildaten umfassen einen Namen, eine E-Mail-Adresse und einen Spitznamen, der allen Benutzern angezeigt wird, die die Website besuchen.</span><span class="sxs-lookup"><span data-stu-id="020b8-108">Our profile data includes a name, email, and a nickname that we will display to everyone who visits the site.</span></span> <span data-ttu-id="020b8-109">Was geschieht, wenn ein neuer Benutzer ein Profil erstellt und einen Spitznamen eingibt, der einige SQL‑Befehle enthält?</span><span class="sxs-lookup"><span data-stu-id="020b8-109">What if a new user creates a profile and enters a nickname that includes some SQL commands?</span></span> <span data-ttu-id="020b8-110">Dieser Benutzer könnte beispielsweise Folgendes eingeben:</span><span class="sxs-lookup"><span data-stu-id="020b8-110">For example - what if our bad user enters something like:</span></span>

```sql
Eve'); DROP TABLE Users;--
```

<span data-ttu-id="020b8-111">Wenn wir diesen Wert blind in eine Datenbank aufnehmen, könnte er die SQL-Anweisung ändern und Befehle ausführen, die wir unbedingt vermeiden möchten.</span><span class="sxs-lookup"><span data-stu-id="020b8-111">If we just blindly insert this value into a database, it could potentially alter the SQL statement to execute commands we absolutely don't want to run!</span></span> <span data-ttu-id="020b8-112">Dies wird auch als „Angriff durch Einschleusung von SQL-Befehlen“ bezeichnet und ist einer von _vielen_ Exploits, die ausgeführt werden können, wenn Eingaben nicht ordnungsgemäß verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="020b8-112">This is referred to as a "SQL Injection" attack and is one of the _many_ types of exploits that can potentially be done when you don't properly handle inputs.</span></span> <span data-ttu-id="020b8-113">Wie lässt sich dieses Problem beheben?</span><span class="sxs-lookup"><span data-stu-id="020b8-113">So, what can we do to fix this?</span></span> <span data-ttu-id="020b8-114">In dieser Einheit wird vermittelt, wann Eingaben überprüft werden müssen, wie Ausgaben codiert werden und wie parametrisierte Abfragen erstellt werden (um den oben genannten Exploit zu verhindern).</span><span class="sxs-lookup"><span data-stu-id="020b8-114">This unit will teach you when to validate input, how to encode output, and how to create parameterized queries (which solves the above exploit).</span></span> <span data-ttu-id="020b8-115">Dies sind die drei wichtigsten Verteidigungstechniken gegen schädliche Eingaben in Ihre Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="020b8-115">These are the three main defense techniques against malicious input being entered into your applications.</span></span>

## <a name="when-do-i-need-to-validate-input"></a><span data-ttu-id="020b8-116">Wann muss ich Eingaben überprüfen?</span><span class="sxs-lookup"><span data-stu-id="020b8-116">When do I need to validate input?</span></span>

<span data-ttu-id="020b8-117">Die Antwort ist _immer_.</span><span class="sxs-lookup"><span data-stu-id="020b8-117">The answer is _always_.</span></span> <span data-ttu-id="020b8-118">Sie müssen **jede** Eingabe in Ihre Anwendung überprüfen.</span><span class="sxs-lookup"><span data-stu-id="020b8-118">You must validate **every** input for your application.</span></span> <span data-ttu-id="020b8-119">Dazu gehören Parameter in der URL, Eingaben des Benutzers, Daten aus der Datenbank, Daten von einer API und alle Eingaben, die ein Benutzer bearbeiten könnte.</span><span class="sxs-lookup"><span data-stu-id="020b8-119">This includes parameters in the URL, input from the user, data from the database, data from an API and anything that is passed in the clear that a user could potentially manipulate.</span></span> <span data-ttu-id="020b8-120">Folgen Sie immer einem Whitelistansatz. Dies bedeutet, dass Sie nur „bekannte gute“ Eingaben akzeptieren, statt eine Blacklist zu verwenden (mit der Sie speziell nach ungültigen Eingaben suchen). Denn es ist nicht möglich, eine vollständige Liste der potenziell gefährlichen Eingaben zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="020b8-120">Always use a whitelist approach, which means you only accept "known good" input, instead of a blacklist (where you specifically look for bad input) because it's impossible to think of a complete list of potentially dangerous input.</span></span>  <span data-ttu-id="020b8-121">Erledigen Sie diese Aufgabe auf dem Server und nicht auf dem Client (oder zusätzlich zum Client), um sicherzustellen, dass Ihre Verteidigung nicht umgangen werden kann.</span><span class="sxs-lookup"><span data-stu-id="020b8-121">Do this work on the server, not the client-side (or in addition to the client-side), to ensure that your defenses cannot be circumvented.</span></span> <span data-ttu-id="020b8-122">Behandeln Sie **alle** Daten als nicht vertrauenswürdig. Dadurch schützen Sie sich von den meisten gängigen Sicherheitslücken von Web-Apps.</span><span class="sxs-lookup"><span data-stu-id="020b8-122">Treat **ALL** data as untrusted and you will protect yourself from most of the common web app vulnerabilities.</span></span>

<span data-ttu-id="020b8-123">Das ASP.NET-Framework bietet [hervorragende Unterstützung für das Überprüfen von Eingaben](https://docs.microsoft.com/aspnet/web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites) auf dem Client und dem Server.</span><span class="sxs-lookup"><span data-stu-id="020b8-123">If you are using ASP.NET, the framework provides [great support for validating input](https://docs.microsoft.com/aspnet/web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites) on both the client and server side.</span></span>

<span data-ttu-id="020b8-124">Wenn Sie ein anderes Webframework verwenden, stehen Ihnen im [OWASP-Spickzettel für die Überprüfung von Eingaben](https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet) einige großartige Techniken für die Überprüfung von Eingaben zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="020b8-124">If you are using another web framework, there are some great techniques for doing input validation available on the [OWASP Input Validation Cheatsheet](https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet).</span></span>


## <a name="always-use-parameterized-queries"></a><span data-ttu-id="020b8-125">Ausschließliches Verwenden von parametrisierten Abfragen</span><span class="sxs-lookup"><span data-stu-id="020b8-125">Always use parameterized queries</span></span>

<span data-ttu-id="020b8-126">SQL-Datenbanken werden häufig zum Speichern von Daten verwendet, z.B. von Profilinformationen.</span><span class="sxs-lookup"><span data-stu-id="020b8-126">SQL databases are commonly used to store data, for example profile information.</span></span>  <span data-ttu-id="020b8-127">Erstellen Sie keine Inline-SQL- oder sonstigen Datenbankabfragen unmittelbar in Ihrem Code, um sie direkt an die Datenbank zu senden. Wie bereits dargestellt, führt dies garantiert in eine Katastrophe.</span><span class="sxs-lookup"><span data-stu-id="020b8-127">Never create inline SQL or other database queries "on the fly" in your code and send it directly to the database, this is a recipe for disaster, as we saw above.</span></span>

<span data-ttu-id="020b8-128">Machen Sie z.B. **Folgendes nicht** (bekannt als Inline-SQL):</span><span class="sxs-lookup"><span data-stu-id="020b8-128">For example, **do not do this** (known as inline SQL):</span></span>

```csharp
string userName = ... // receive input from the user BEWARE!
...
string query = "SELECT *  FROM  [dbo].[users] WHERE userName = '" + userName + "'";
```

<span data-ttu-id="020b8-129">Hier verketten wir Textzeichenfolgen, um die Abfrage zu erstellen, übernehmen die Eingabe des Benutzers und generieren eine dynamische SQL-Abfrage, um den Benutzer zu suchen.</span><span class="sxs-lookup"><span data-stu-id="020b8-129">Here we concatenate text strings together to create the query, taking the input from the user and generating a dynamic SQL query to lookup the user.</span></span> <span data-ttu-id="020b8-130">Wenn ein böswilliger Benutzer dies erkennen würde oder nur verschiedene Eingabeformate _ausprobieren_ würde, um eine Schwachstelle zu finden, könnte das Ergebnis ein schwerwiegender Zwischenfall sein.</span><span class="sxs-lookup"><span data-stu-id="020b8-130">Again, if a malicious user realized we were doing this, or just _tried_ different input styles to see if there was a vulnerability, we could end up with a major disaster.</span></span> <span data-ttu-id="020b8-131">Verwenden Sie stattdessen parametrisierte SQL-Anweisungen oder gespeicherte Prozeduren, z.B.:</span><span class="sxs-lookup"><span data-stu-id="020b8-131">Instead, use parameterized SQL statements or stored procedures such as this:</span></span>

```sql
-- Lookup a user
CREATE PROCEDURE sp_findUser
(
@UserName varchar(50)
)

SELECT *  FROM  [dbo].[users] WHERE userName = @UserName
```

<span data-ttu-id="020b8-132">Mit dieser Methode können Sie dann die Prozedur sicher über den Code aufrufen und die Zeichenfolge `userName` übergeben, ohne befürchten zu müssen, dass sie als Teil der SQL-Anweisung behandelt wird.</span><span class="sxs-lookup"><span data-stu-id="020b8-132">With this method you can invoke the procedure from your code safely, passing it the `userName` string without worrying about it being treated as part of the SQL statement.</span></span>

## <a name="always-encode-your-output"></a><span data-ttu-id="020b8-133">Codieren aller Ausgaben</span><span class="sxs-lookup"><span data-stu-id="020b8-133">Always encode your output</span></span>

<span data-ttu-id="020b8-134">Alle Ausgaben, die Sie entweder visuell oder in einem Dokument bereitstellen, sollten immer codiert und mit Escapezeichen versehen werden.</span><span class="sxs-lookup"><span data-stu-id="020b8-134">Any output you present either visually or within a document should always be encoded and escaped.</span></span> <span data-ttu-id="020b8-135">So werden Sie geschützt, falls etwas bei der Bereinigung übersehen wurde oder der Code versehentlich etwas generiert, was in böswilliger Absicht verwendet werden könnte.</span><span class="sxs-lookup"><span data-stu-id="020b8-135">This can protect you in case something was missed in the sanitization pass, or the code accidentally generates something that can be used maliciously.</span></span> <span data-ttu-id="020b8-136">Auf diese Weise wird sichergestellt, dass alles als _Ausgabe_ angezeigt wird und nicht versehentlich als etwas interpretiert wird, das ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="020b8-136">This will make sure that everything is displayed as _output_ and not inadvertently interpreted as something that should be executed.</span></span> <span data-ttu-id="020b8-137">Dies ist eine weitere sehr häufige Angriffstechnik, die als „Cross-Site Scripting“ (XSS) bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="020b8-137">This is another very common attack technique referred to as "Cross-Site Scripting" (XSS).</span></span>

<span data-ttu-id="020b8-138">Da es sich um eine sehr häufige Anforderung handelt, ist dies ein weiterer Bereich, in dem ASP.NET Ihnen die Arbeit abnimmt.</span><span class="sxs-lookup"><span data-stu-id="020b8-138">Since this is such as common requirement, this is another area where ASP.NET will do the work for you.</span></span> <span data-ttu-id="020b8-139">Standardmäßig sind alle Ausgaben bereits codiert.</span><span class="sxs-lookup"><span data-stu-id="020b8-139">By default, all output is already encoded.</span></span> <span data-ttu-id="020b8-140">Wenn Sie ein anderes Webframework verwenden, können Sie Ihre Optionen für die Ausgabecodierung auf der Website mit den Informationen unter [OWASP XSS Prevention Cheatsheet](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet) überprüfen.</span><span class="sxs-lookup"><span data-stu-id="020b8-140">If you are using another web framework, you can verify your options for output encoding on websites with the [OWASP XSS Prevention Cheatsheet](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet).</span></span>

## <a name="summary"></a><span data-ttu-id="020b8-141">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="020b8-141">Summary</span></span>

<span data-ttu-id="020b8-142">Das Bereinigen und Überprüfen Ihrer Eingaben ist eine unerlässliche Anforderung, um sicherzustellen, dass die Eingaben gültig sind und sicher verwendet und gespeichert werden können.</span><span class="sxs-lookup"><span data-stu-id="020b8-142">Santizing and validating your input is a necessary requirement to ensure your input is valid and safe to use and store.</span></span> <span data-ttu-id="020b8-143">Die meisten modernen Webframeworks verfügen über integrierte Features, mit denen einige dieser Arbeitsschritte automatisiert werden können.</span><span class="sxs-lookup"><span data-stu-id="020b8-143">Most modern web frameworks offer built-in features which can automate some of this work.</span></span> <span data-ttu-id="020b8-144">Sie können in der Dokumentation Ihres bevorzugten Frameworks nachsehen, welche Features vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="020b8-144">You can check your preferred framework's documentation and see what features it offers.</span></span> <span data-ttu-id="020b8-145">Für Webanwendungen passiert dies zwar am häufigsten, aber bedenken Sie, dass auch andere Arten von Anwendungen genauso anfällig sein können.</span><span class="sxs-lookup"><span data-stu-id="020b8-145">While web applications are the most common place where this happens, keep in mind that other types of applications can be just as vulnerable.</span></span> <span data-ttu-id="020b8-146">Sie sollten nicht glauben, dass Sie sicher sind, weil es sich bei Ihrer neuen Anwendung um eine Desktop-App handelt.</span><span class="sxs-lookup"><span data-stu-id="020b8-146">Don't think you're safe just because your new application is a desktop app.</span></span> <span data-ttu-id="020b8-147">Sie müssen dennoch Benutzereingaben richtig verarbeiten, um sicherzustellen, dass niemand über die App Ihre Daten oder den Ruf Ihres Unternehmens beschädigt.</span><span class="sxs-lookup"><span data-stu-id="020b8-147">You will still need to properly handle user input to ensure someone doesn't use your app to corrupt your data, or damage your company's reputation.</span></span>