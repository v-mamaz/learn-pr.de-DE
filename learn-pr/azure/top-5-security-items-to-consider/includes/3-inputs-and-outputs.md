<span data-ttu-id="f5f80-101">Das vorherrschende Sicherheitsrisiko für Anwendungen besteht heute darin, dass aus externen Quellen empfangene Eingaben, insbesondere _Benutzereingaben_, nicht ordnungsgemäß verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="f5f80-101">The most prevalent security weakness of applications today is to not correctly process input received from external sources, particularly _user input_.</span></span> <span data-ttu-id="f5f80-102">Sie sollten sich Eingaben immer genau ansehen, um sicherzustellen, dass sie vor der Verwendung überprüft wurden.</span><span class="sxs-lookup"><span data-stu-id="f5f80-102">You should always take a close look at any input to make sure it has been validated before it is used.</span></span> <span data-ttu-id="f5f80-103">Andernfalls kann das Ergebnis der Verlust oder die Offenlegung von Daten, die Ausweitung von Rechten oder sogar die Ausführung von bösartigem Code auf den Computern von anderen Benutzern sein.</span><span class="sxs-lookup"><span data-stu-id="f5f80-103">Failing to do this can result in data loss or exposure, escalation of privilege, or even execution of malicious code on other users' computers!</span></span>

<span data-ttu-id="f5f80-104">Dabei kann dieses Problem einfach gelöst werden.</span><span class="sxs-lookup"><span data-stu-id="f5f80-104">The tragic thing is that this is an easy problem to solve.</span></span> <span data-ttu-id="f5f80-105">Hier wird der Umgang mit Daten behandelt: wenn sie empfangen werden, wenn sie auf dem Bildschirm angezeigt werden und wenn sie für die spätere Verwendung gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="f5f80-105">Here we will cover how to treat data; when it’s received, when it’s displayed on the screen, and when it's stored for later use.</span></span>

## <a name="why-do-we-need-to-validate-our-input"></a><span data-ttu-id="f5f80-106">Warum müssen wir unsere Eingaben überprüfen?</span><span class="sxs-lookup"><span data-stu-id="f5f80-106">Why do we need to validate our input?</span></span>

<span data-ttu-id="f5f80-107">Angenommen, Sie erstellen eine Schnittstelle, damit ein Benutzer auf Ihrer Website ein Konto erstellen kann.</span><span class="sxs-lookup"><span data-stu-id="f5f80-107">Imagine that you are building an interface to allow a user to create an account on your website.</span></span> <span data-ttu-id="f5f80-108">Unsere Profildaten umfassen einen Namen, eine E-Mail-Adresse und einen Spitznamen, der allen Benutzern angezeigt wird, die die Website besuchen.</span><span class="sxs-lookup"><span data-stu-id="f5f80-108">Our profile data includes a name, email, and a nickname that we will display to everyone who visits the site.</span></span> <span data-ttu-id="f5f80-109">Was geschieht, wenn ein neuer Benutzer ein Profil erstellt und einen Spitznamen eingibt, der einige SQL‑Befehle enthält?</span><span class="sxs-lookup"><span data-stu-id="f5f80-109">What if a new user creates a profile and enters a nickname that includes some SQL commands?</span></span> <span data-ttu-id="f5f80-110">Dieser Benutzer könnte beispielsweise Folgendes eingeben:</span><span class="sxs-lookup"><span data-stu-id="f5f80-110">For example - what if our bad user enters something like:</span></span>

```output
Eve'); DROP TABLE Users;--
```

<span data-ttu-id="f5f80-111">Wenn wir diesen Wert blind in eine Datenbank aufnehmen, könnte er die SQL-Anweisung ändern und Befehle ausführen, die wir unbedingt vermeiden möchten.</span><span class="sxs-lookup"><span data-stu-id="f5f80-111">If we just blindly insert this value into a database, it could potentially alter the SQL statement to execute commands we absolutely don't want to run!</span></span> <span data-ttu-id="f5f80-112">Dies wird auch als „Angriff durch Einschleusung von SQL-Befehlen“ bezeichnet und ist einer von _vielen_ Exploits, die ausgeführt werden können, wenn Eingaben nicht ordnungsgemäß verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="f5f80-112">This is referred to as a "SQL Injection" attack and is one of the _many_ types of exploits that can potentially be done when you don't properly handle inputs.</span></span> <span data-ttu-id="f5f80-113">Wie lässt sich dieses Problem beheben?</span><span class="sxs-lookup"><span data-stu-id="f5f80-113">So, what can we do to fix this?</span></span> <span data-ttu-id="f5f80-114">In dieser Einheit wird vermittelt, wann Eingaben bereinigt werden müssen, wie Ausgaben codiert werden und wie parametrisierte Abfragen erstellt werden (um den oben genannten Exploit zu verhindern).</span><span class="sxs-lookup"><span data-stu-id="f5f80-114">This unit will teach you when to sanitize input, how to encode output, and how to create parameterized queries (which solves the above exploit!).</span></span> <span data-ttu-id="f5f80-115">Dies sind die drei wichtigsten Verteidigungstechniken gegen böswillige Eingaben in Ihre Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="f5f80-115">These are the three main defense techniques against malicious input being entered into your applications.</span></span>

## <a name="when-do-i-need-to-validate-input"></a><span data-ttu-id="f5f80-116">Wann muss ich Eingaben überprüfen?</span><span class="sxs-lookup"><span data-stu-id="f5f80-116">When do I need to validate input?</span></span>

<span data-ttu-id="f5f80-117">Die Antwort ist _immer_.</span><span class="sxs-lookup"><span data-stu-id="f5f80-117">The answer is _always_.</span></span> <span data-ttu-id="f5f80-118">Sie müssen **jede** Eingabe in Ihre Anwendung überprüfen.</span><span class="sxs-lookup"><span data-stu-id="f5f80-118">You must validate **every** input for your application.</span></span> <span data-ttu-id="f5f80-119">Dazu gehören Parameter in der URL, Eingaben des Benutzers, Daten aus der Datenbank, Daten von einer API und alle Eingaben, die ein Benutzer bearbeiten könnte.</span><span class="sxs-lookup"><span data-stu-id="f5f80-119">This includes parameters in the URL, input from the user, data from the database, data from an API and anything that is passed in the clear that a user could potentially manipulate.</span></span> <span data-ttu-id="f5f80-120">Folgen Sie immer einem Whitelistansatz. Dies bedeutet, dass Sie nur „bekannte gute“ Eingaben akzeptieren, statt eine Blacklist zu verwenden (mit der Sie speziell nach ungültigen Eingaben suchen). Denn es ist nicht möglich, eine vollständige Liste der potenziell gefährlichen Eingaben zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="f5f80-120">Always use a whitelist approach, which means you only accept "known good" input, instead of a blacklist (where you specifically look for bad input) because it's impossible to think of a complete list of potentially dangerous input.</span></span>  <span data-ttu-id="f5f80-121">Erledigen Sie diese Aufgabe auf dem Server und nicht auf dem Client (oder zusätzlich zum Client), um sicherzustellen, dass Ihre Verteidigung nicht umgangen werden kann.</span><span class="sxs-lookup"><span data-stu-id="f5f80-121">Do this work on the server, not the client-side (or in addition to the client-side), to ensure that your defenses cannot be circumvented.</span></span> <span data-ttu-id="f5f80-122">Behandeln Sie **alle** Daten als nicht vertrauenswürdig. Dadurch schützen Sie sich von den meisten gängigen Sicherheitslücken von Web-Apps.</span><span class="sxs-lookup"><span data-stu-id="f5f80-122">Treat **ALL** data as untrusted and you will protect yourself from most of the common web app vulnerabilities.</span></span>

<span data-ttu-id="f5f80-123">Das ASP.NET-Framework bietet [hervorragende Unterstützung für das Überprüfen von Eingaben](https://docs.microsoft.com/aspnet/web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites) auf dem Client und dem Server.</span><span class="sxs-lookup"><span data-stu-id="f5f80-123">If you are using ASP.NET, the framework provides [great support for validating input](https://docs.microsoft.com/aspnet/web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites) on both the client and server side.</span></span>

<span data-ttu-id="f5f80-124">Wenn Sie ein anderes Webframework verwenden, stehen Ihnen im [OWASP-Spickzettel für die Überprüfung von Eingaben](https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet) einige großartige Techniken für die Überprüfung von Eingaben zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="f5f80-124">If you are using another web framework, there are some great techniques for doing input validation available on the [OWASP Input Validation Cheatsheet](https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet).</span></span>


## <a name="always-use-parameterized-queries"></a><span data-ttu-id="f5f80-125">Ausschließliches Verwenden von parametrisierten Abfragen</span><span class="sxs-lookup"><span data-stu-id="f5f80-125">Always use parameterized queries</span></span>

<span data-ttu-id="f5f80-126">SQL-Datenbanken dienen meist zum Speichern von Daten. Wir könnten beispielsweise unsere Profilinformationen in SQL Server speichern.</span><span class="sxs-lookup"><span data-stu-id="f5f80-126">SQL databases are commonly used to store data - we might be storing our profile information in SQL Server for example.</span></span>  <span data-ttu-id="f5f80-127">Erstellen Sie keine Inline-SQL- oder sonstigen Datenbankabfragen unmittelbar in Ihrem Code, um sie direkt an die Datenbank zu senden. Wie bereits dargestellt, führt dies garantiert in eine Katastrophe.</span><span class="sxs-lookup"><span data-stu-id="f5f80-127">Never create inline SQL or other database queries "on the fly" in your code and send it directly to the database, this is a recipe for disaster, as we saw above.</span></span>

<span data-ttu-id="f5f80-128">Machen Sie z.B. **Folgendes nicht** (bekannt als Inline-SQL):</span><span class="sxs-lookup"><span data-stu-id="f5f80-128">For example, **do not do this** (known as inline SQL):</span></span>

```csharp
string userName = ... // receive input from the user BEWARE!
...
string query = "SELECT *  FROM  [dbo].[users] WHERE userName = '" + userName + "'";
```

<span data-ttu-id="f5f80-129">Hier verketten wir Textzeichenfolgen, um die Abfrage zu erstellen, übernehmen die Eingabe des Benutzers und generieren eine dynamische SQL-Abfrage, um den Benutzer zu suchen.</span><span class="sxs-lookup"><span data-stu-id="f5f80-129">Here we concatenate text strings together to create the query, taking the input from the user and generating a dynamic SQL query to lookup the user.</span></span> <span data-ttu-id="f5f80-130">Wenn ein bösartiger Benutzer dies erkennen würde oder nur verschiedene Eingabeformate _ausprobieren_ würde, um eine Schwachstelle zu finden, könnte das Ergebnis ein schwerwiegender Zwischenfall sein.</span><span class="sxs-lookup"><span data-stu-id="f5f80-130">Again, if an evil user realized we were doing this, or just _tried_ different input styles to see if there was a vulnerability, we could end up with a major disaster.</span></span> <span data-ttu-id="f5f80-131">Verwenden Sie stattdessen parametrisierte SQL-Anweisungen – oder noch besser: gespeicherte Prozeduren:</span><span class="sxs-lookup"><span data-stu-id="f5f80-131">Instead, prefer to use parameterized SQL statements, or even better - stored procedures:</span></span>

```sql
-- Lookup a user
CREATE PROCEDURE sp_findUser
(
@UserName varchar(50)
)

SELECT *  FROM  [dbo].[users] WHERE userName = @UserName
```

<span data-ttu-id="f5f80-132">Dann können Sie die Prozedur sicher über den Code aufrufen und die Zeichenfolge `userName` übergeben, ohne sich Gedanken machen zu müssen, dass sie als Teil der SQL-Anweisung behandelt wird.</span><span class="sxs-lookup"><span data-stu-id="f5f80-132">Then you can invoke the procedure from your code safely, passing it the `userName` string without worrying about it being treated as part of the SQL statement.</span></span>

## <a name="always-encode-your-output"></a><span data-ttu-id="f5f80-133">Codieren aller Ausgaben</span><span class="sxs-lookup"><span data-stu-id="f5f80-133">Always encode your output</span></span>

<span data-ttu-id="f5f80-134">Jede Ausgabe, die Sie visuell oder in Dateien darstellen, sollte immer codiert und mit Escapezeichen versehen werden.</span><span class="sxs-lookup"><span data-stu-id="f5f80-134">Any output you present visually or in files should always be encoded and escaped.</span></span> <span data-ttu-id="f5f80-135">So werden Sie geschützt, falls etwas bei der Bereinigung übersehen wurde oder der Code versehentlich etwas generiert, was in böswilliger Absicht verwendet werden könnte.</span><span class="sxs-lookup"><span data-stu-id="f5f80-135">This can protect you in case something was missed in the sanitization pass, or the code accidentally generates something that can be used maliciously.</span></span> <span data-ttu-id="f5f80-136">Auf diese Weise wird sichergestellt, dass alles als _Ausgabe_ angezeigt wird und nicht versehentlich als etwas interpretiert wird, das ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="f5f80-136">This will make sure that everything is displayed as _output_ and not inadvertently interpreted as something that should be executed.</span></span> <span data-ttu-id="f5f80-137">Dies ist eine weitere sehr häufige Angriffstechnik, die als „Cross-Site Scripting“ (XSS) bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="f5f80-137">This is another very common attack technique referred to as "Cross-Site Scripting" (XSS).</span></span>

<span data-ttu-id="f5f80-138">Da es sich um eine derart gängige Anforderung handelt, ist dies ein weiterer Bereich, in dem ASP.NET Ihnen die Arbeit abnimmt.</span><span class="sxs-lookup"><span data-stu-id="f5f80-138">Since this is such as common requirement, this is another areas where ASP.NET will do the work for you.</span></span> <span data-ttu-id="f5f80-139">Standardmäßig sind [alle Ausgaben bereits codiert](https://docs.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-2.1).</span><span class="sxs-lookup"><span data-stu-id="f5f80-139">By default, [all output is already encoded](https://docs.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-2.1).</span></span> <span data-ttu-id="f5f80-140">Wenn Sie ein anderes Webframework verwenden, können Sie Ihre Optionen für die Ausgabecodierung auf der Website mit dem [OWASP-Spickzettel zur XSS-Verhinderung](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet) überprüfen.</span><span class="sxs-lookup"><span data-stu-id="f5f80-140">If you are using another web framework, you can verify your options for output encoding on websites with the [OWASP XSS Prevention Cheatsheet](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet).</span></span>

## <a name="summary"></a><span data-ttu-id="f5f80-141">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="f5f80-141">Summary</span></span>

<span data-ttu-id="f5f80-142">Das Bereinigen und Überprüfen Ihrer Eingaben ist eine unerlässliche Anforderung, um sicherzustellen, dass die Eingaben gültig sind und sicher verwendet und gespeichert werden können.</span><span class="sxs-lookup"><span data-stu-id="f5f80-142">Santizing and validating your input is a necessary requirement to ensure your input is valid and safe to use and store.</span></span> <span data-ttu-id="f5f80-143">Die meisten modernen Webframeworks bieten integrierte Features, die einen Teil dieser Arbeit automatisieren können. Lesen Sie in der Dokumentation Ihres bevorzugten Frameworks nach, welche Features es bietet.</span><span class="sxs-lookup"><span data-stu-id="f5f80-143">Most modern web frameworks offer built-in features which can automate some of this work - make sure to check your preferred framework's documentation and see what features it offers.</span></span> <span data-ttu-id="f5f80-144">Bedenken Sie außerdem, dass dies zwar am häufigsten in Webanwendungen auftritt, andere Arten von Anwendungen aber ähnliche Probleme aufweisen können.Fühlen Sie sich also nicht zu sicher, weil Sie eine angesagte Desktop-App schreiben.</span><span class="sxs-lookup"><span data-stu-id="f5f80-144">Also, keep in mind that while the most common place this occurs is in web applications, other types of applications can have similar issues - so don't think you're safe if you are writing that cool desktop app!</span></span> <span data-ttu-id="f5f80-145">Sie müssen dennoch Benutzereingaben richtig verarbeiten, um sicherzustellen, dass niemand über die App Ihre Daten oder den Ruf Ihres Unternehmens beschädigt.</span><span class="sxs-lookup"><span data-stu-id="f5f80-145">You still need to properly handle user input to ensure someone doesn't use your app to corrupt your data, or damage your company's reputation.</span></span>


## <a name="knowledge-check"></a><span data-ttu-id="f5f80-146">Wissenstest</span><span class="sxs-lookup"><span data-stu-id="f5f80-146">Knowledge Check</span></span>

<span data-ttu-id="f5f80-147">Welche der folgenden Datenquellen müssen bereinigt werden?</span><span class="sxs-lookup"><span data-stu-id="f5f80-147">Which of the following data sources need to be sanitized?</span></span>
* <span data-ttu-id="f5f80-148">Daten aus der API eines Drittanbieters</span><span class="sxs-lookup"><span data-stu-id="f5f80-148">Data from a 3rd party API</span></span>
* <span data-ttu-id="f5f80-149">Daten des URL-Parameters</span><span class="sxs-lookup"><span data-stu-id="f5f80-149">Data from the URL parameter</span></span>
* <span data-ttu-id="f5f80-150">Vom Benutzer über ein Eingabefeld erfasste Daten</span><span class="sxs-lookup"><span data-stu-id="f5f80-150">Data collected from the user via an input field</span></span>
* <span data-ttu-id="f5f80-151">Alle der oben genannten Antworten (richtige Antwort)</span><span class="sxs-lookup"><span data-stu-id="f5f80-151">All the above (correct answer)</span></span>

<span data-ttu-id="f5f80-152">Für welche der folgenden Daten muss die Ausgabe codiert werden?</span><span class="sxs-lookup"><span data-stu-id="f5f80-152">Which of the following data needs to be output encoded?</span></span>
* <span data-ttu-id="f5f80-153">Daten, die in der Datenbank gespeichert werden</span><span class="sxs-lookup"><span data-stu-id="f5f80-153">Data saved to the database</span></span>
* <span data-ttu-id="f5f80-154">Daten, die auf dem Bildschirm ausgegeben werden (richtige Antwort)</span><span class="sxs-lookup"><span data-stu-id="f5f80-154">Date to be output to the screen (correct answer)</span></span>
* <span data-ttu-id="f5f80-155">Daten, die an die API eines Drittanbieters gesendet werden</span><span class="sxs-lookup"><span data-stu-id="f5f80-155">Data sent to a 3rd party API</span></span>
* <span data-ttu-id="f5f80-156">Daten in den URL-Parametern</span><span class="sxs-lookup"><span data-stu-id="f5f80-156">Data in the URL parameters</span></span>

<span data-ttu-id="f5f80-157">Parametrisierte Abfragen (gespeicherte Prozeduren in SQL) sind aus folgendem Grund immer eine sicherere Wahl für die Kommunikation mit der Datenbank:</span><span class="sxs-lookup"><span data-stu-id="f5f80-157">Parameterized queries (stored procedures in SQL) are always a more secure choice for talking to the database because:</span></span>
* <span data-ttu-id="f5f80-158">Sie sind besser strukturiert als Inline-Datenbankbefehle und daher für Benutzer weniger verwirrend.</span><span class="sxs-lookup"><span data-stu-id="f5f80-158">They are more organized than inline database commands, and therefore less confusing for users.</span></span>
* <span data-ttu-id="f5f80-159">Das Skript in der gespeicherten Prozedur ist klar gegliedert und dadurch verständlicher.</span><span class="sxs-lookup"><span data-stu-id="f5f80-159">There is a clear outline of the script in the stored procedure, ensuring better visibility.</span></span>
* <span data-ttu-id="f5f80-160">Hacker wissen nicht, wie in SQL programmiert wird.</span><span class="sxs-lookup"><span data-stu-id="f5f80-160">Hackers don’t understand how to program in SQL.</span></span>
* <span data-ttu-id="f5f80-161">Parametrisierte Abfragen ersetzen Variablen vor dem Ausführen der Abfragen. Dadurch wird verhindert, dass Code anstelle einer Variablen übermittelt werden kann.</span><span class="sxs-lookup"><span data-stu-id="f5f80-161">Parameterized queries substitute variables before running queries, meaning it avoids the opportunity for code to be submitted in place of a variable.</span></span> <span data-ttu-id="f5f80-162">(richtige Antwort)</span><span class="sxs-lookup"><span data-stu-id="f5f80-162">(correct answer)</span></span>
