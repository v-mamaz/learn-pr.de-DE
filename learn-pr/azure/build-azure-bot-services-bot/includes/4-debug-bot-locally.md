### <a name="exercise-4-debug-the-bot-locally"></a><span data-ttu-id="98c11-101">Übung 4: Lokales Debuggen des Bots</span><span class="sxs-lookup"><span data-stu-id="98c11-101">Exercise 4: Debug the bot locally</span></span>

<span data-ttu-id="98c11-102">Wie bei jedem Anwendungscode, den Sie schreiben, müssen Änderungen des Botcodes lokal getestet und gedebuggt werden, bevor er in der Produktionsumgebung bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="98c11-102">As with any application code that you write, changes to bot code need to be tested and debugged locally before being deployed to production.</span></span> <span data-ttu-id="98c11-103">Um das Debuggen von Bots zu vereinfachen, bietet Microsoft den [Bot Framework Emulator](https://emulator.botframework.com/).</span><span class="sxs-lookup"><span data-stu-id="98c11-103">To help debug bots, Microsoft offers the [Bot Framework Emulator](https://emulator.botframework.com/).</span></span> <span data-ttu-id="98c11-104">In dieser Übung lernen Sie, wie Sie Ihre Bots mit Visual Studio Code und dem Emulator debuggen.</span><span class="sxs-lookup"><span data-stu-id="98c11-104">In this exercise, you will learn how to use Visual Studio Code and the emulator to debug your bots.</span></span>

1. <span data-ttu-id="98c11-105">Wenn Sie den Microsoft Bot Framework Emulator nicht installiert haben, können Sie dies jetzt nachzuholen.</span><span class="sxs-lookup"><span data-stu-id="98c11-105">If you haven't installed the Microsoft Bot Framework Emulator, take a moment to do so now.</span></span> <span data-ttu-id="98c11-106">Sie können ihn von https://emulator.botframework.com/ herunterladen.</span><span class="sxs-lookup"><span data-stu-id="98c11-106">You can download it from https://emulator.botframework.com/.</span></span> <span data-ttu-id="98c11-107">Versionen für Windows, macOS und Linux sind verfügbar.</span><span class="sxs-lookup"><span data-stu-id="98c11-107">Versions are available for Windows, macOS, and Linux.</span></span>

1. <span data-ttu-id="98c11-108">Führen Sie den folgenden Befehl im integrierten Terminal von Visual Studio Code aus, um [Restify](http://restify.com/) zu installieren, ein beliebtes Node-Paket zum Erstellen und Nutzen von RESTful-Webdiensten:</span><span class="sxs-lookup"><span data-stu-id="98c11-108">Execute the following command in Visual Studio Code's integrated terminal to install [Restify](http://restify.com/), a popular Node package for building and consuming RESTful Web services:</span></span>

    ```
    npm install restify
    ```

1. <span data-ttu-id="98c11-109">Wiederholen Sie diesen Schritt für die folgenden Befehle zum Installieren des [Microsoft Bot Framework Bot Builder SDK für Node.js](https://docs.microsoft.com/en-us/bot-framework/nodejs/bot-builder-nodejs-quickstart):</span><span class="sxs-lookup"><span data-stu-id="98c11-109">Repeat this step for the following commands to install the [Microsoft Bot Framework Bot Builder SDK for Node.js](https://docs.microsoft.com/en-us/bot-framework/nodejs/bot-builder-nodejs-quickstart):</span></span>

    ```
    npm install botbuilder
    npm install botbuilder-azure
    npm install botbuilder-cognitiveservices
    ```

1. <span data-ttu-id="98c11-110">Klicken Sie in der Aktivitätsleiste von Visual Studio Code auf die **Explorer**-Schaltfläche.</span><span class="sxs-lookup"><span data-stu-id="98c11-110">Click the **Explorer** button in Visual Studio Code's activity bar.</span></span> <span data-ttu-id="98c11-111">Wählen Sie dann **app.js** aus, um die Datei im Code-Editor zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="98c11-111">Then select **app.js** to open it in the code editor.</span></span> <span data-ttu-id="98c11-112">Diese Datei enthält den Code, der den Bot steuert – Code, der vom Azure Bot Service generiert und aus dem Azure-Portal heruntergeladen wurde.</span><span class="sxs-lookup"><span data-stu-id="98c11-112">This file contains the code that drives the bot — code that was generated by the Azure Bot Service and downloaded from the Azure portal.</span></span>

    ![Öffnen von „app.js“](../images/vs-select-index-js.png)

    <span data-ttu-id="98c11-114">_Öffnen von „app.js“_</span><span class="sxs-lookup"><span data-stu-id="98c11-114">_Opening app.js_</span></span> 

1. <span data-ttu-id="98c11-115">Ersetzen Sie den Inhalt von **app.js** durch den folgenden Code.</span><span class="sxs-lookup"><span data-stu-id="98c11-115">Replace the contents of **app.js** with the following code.</span></span> <span data-ttu-id="98c11-116">Speichern Sie dann die Datei:</span><span class="sxs-lookup"><span data-stu-id="98c11-116">Then save the file:</span></span>

    ```JavaScript
    "use strict";
    var builder = require("botbuilder");
    var botbuilder_azure = require("botbuilder-azure");
    
    var useEmulator = true; 
    var userName = ""; 
    var yearsCoding = ""; 
    var selectedLanguage = "";
    
    var connector = useEmulator ? new builder.ChatConnector() : new botbuilder_azure.BotServiceConnector({
        appId: process.env.MicrosoftAppId,
        appPassword: process.env.MicrosoftAppPassword      
    });
    
    var bot = new builder.UniversalBot(connector);
    
    bot.dialog('/', [
    
    function (session) {
        builder.Prompts.text(session, "Hello, and welcome to QnA Factbot! What's your name?");
    },
    
    function (session, results) {
        userName = results.response;
        builder.Prompts.number(session, "Hi " + userName + ", how many years have you been writing code?"); 
    },
    
    function (session, results) {
        yearsCoding = results.response;
        builder.Prompts.choice(session, "What language do you love the most?", ["C#", "Python", "Node.js", "Visual FoxPro"]);
    },
    
    function (session, results) {
        selectedLanguage = results.response.entity;   
    
        session.send("Okay, " + userName + ", I think I've got it:" +
                    " You've been writing code for " + yearsCoding + " years," +
                    " and prefer to use " + selectedLanguage + ".");
    }]);
     
    var restify = require('restify');
    var server = restify.createServer();

    server.listen(3978, function() {
        console.log('test bot endpoint at http://localhost:3978/api/messages');
    });

    server.post('/api/messages', connector.listen());    
    ```

1. <span data-ttu-id="98c11-117">Legen Sie für die Zeilen 20, 25 und 30 durch Klicken auf den Rand auf der linken Seite Haltepunkte fest.</span><span class="sxs-lookup"><span data-stu-id="98c11-117">Set breakpoints on lines 20, 25, and 30 by clicking in the margin on the left.</span></span>
 
    ![Hinzufügen von Haltepunkten zu „app.js“](../images/vs-add-breakpoints.png)

    <span data-ttu-id="98c11-119">_Hinzufügen von Haltepunkten zu „app.js“_</span><span class="sxs-lookup"><span data-stu-id="98c11-119">_Adding breakpoints to app.js_</span></span> 

1. <span data-ttu-id="98c11-120">Klicken Sie in der Aktivitätsleiste auf die Schaltfläche **Debuggen** und dann auf den grünen Pfeil, um eine Debugsitzung zu starten.</span><span class="sxs-lookup"><span data-stu-id="98c11-120">Click the **Debug** button in the activity bar, and then click the green arrow to start a debugging session.</span></span> <span data-ttu-id="98c11-121">Überprüfen Sie, ob „Botendpunkt bei http://localhost:3978/api/messages testen“ auf der Debugkonsole angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="98c11-121">Confirm that "test bot endpoint at http://localhost:3978/api/messages" appears in the debug console.</span></span>
 
    ![Starten des Debuggers](../images/vs-launch-debugger.png)

    <span data-ttu-id="98c11-123">_Starten des Debuggers_</span><span class="sxs-lookup"><span data-stu-id="98c11-123">_Launching the debugger_</span></span> 

1. <span data-ttu-id="98c11-124">Ihr Botcode wird jetzt lokal ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="98c11-124">Your bot code is now running locally.</span></span> <span data-ttu-id="98c11-125">Starten Sie den Bot Framework Emulator, und klicken Sie auf **Neue Botkonfiguration erstellen**.</span><span class="sxs-lookup"><span data-stu-id="98c11-125">Launch the Bot Framework Emulator and click **Create a new bot configuration**.</span></span> <span data-ttu-id="98c11-126">Geben Sie den Botnamen und die Bot-URL ein, die im vorherigen Schritt in der Debugkonsole angezeigt wurden.</span><span class="sxs-lookup"><span data-stu-id="98c11-126">Enter the bot name and the bot URL displayed in the debug console in the previous step.</span></span> <span data-ttu-id="98c11-127">Klicken Sie dann auf **Speichern und verbinden**, und speichern Sie die Konfigurationsdatei am Speicherort Ihrer Wahl.</span><span class="sxs-lookup"><span data-stu-id="98c11-127">Then click **Save and connect** and save the configuration file in the location of your choice.</span></span>

    > <span data-ttu-id="98c11-128">In Zukunft können Sie die Verbindung mit dem Bot wiederherstellen, indem Sie einfach unter „Meine Bots“ auf den Namen des Bots klicken.</span><span class="sxs-lookup"><span data-stu-id="98c11-128">In the future, you can reconnect to the bot simply by clicking the bot name under "My Bots."</span></span>

    ![Herstellen der Verbindung mit dem Bot](../images/new-bot-configuration.png)

    <span data-ttu-id="98c11-130">_Herstellen der Verbindung mit dem Bot_</span><span class="sxs-lookup"><span data-stu-id="98c11-130">_Connecting to the bot_</span></span> 

1. <span data-ttu-id="98c11-131">Geben Sie „hi“ in das Feld am unteren Rand des Emulators ein, und drücken Sie die **EINGABETASTE**.</span><span class="sxs-lookup"><span data-stu-id="98c11-131">Type "hi" into the box at the bottom of the emulator and press **Enter**.</span></span> <span data-ttu-id="98c11-132">Vergewissern Sie sich, dass Visual Studio Code in Zeile 20 von **app.js** anhält.</span><span class="sxs-lookup"><span data-stu-id="98c11-132">Confirm that Visual Studio Code breaks on line 20 of **app.js**.</span></span> <span data-ttu-id="98c11-133">Klicken Sie dann in der Debugsymbolleiste von Visual Studio Code auf die Schaltfläche **Weiter**, und kehren Sie zum Emulator zurück, um die Antwort des Bots anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="98c11-133">Then click the **Continue** button in Visual Studio Code's debugging toolbar and return to the emulator to see the bot's response.</span></span>
 
    ![Fortfahren im Debugger](../images/continue-debugging.png)

    <span data-ttu-id="98c11-135">_Fortfahren im Debugger_</span><span class="sxs-lookup"><span data-stu-id="98c11-135">_Continuing in the debugger_</span></span> 

1. <span data-ttu-id="98c11-136">Der Bot wird Ihnen eine Reihe von Fragen stellen.</span><span class="sxs-lookup"><span data-stu-id="98c11-136">The bot will ask you a series of questions.</span></span> <span data-ttu-id="98c11-137">Beantworten Sie diese, und klicken Sie jedes Mal dann in Visual Studio Code auf **Weiter**, wenn ein Haltepunkt erreicht wird.</span><span class="sxs-lookup"><span data-stu-id="98c11-137">Answer them and click **Continue** in Visual Studio Code each time a breakpoint is hit.</span></span> <span data-ttu-id="98c11-138">Wenn Sie fertig sind, klicken Sie in der Debugsymbolleiste auf die **Beenden**-Schaltfläche, um die Debugsitzung zu beenden.</span><span class="sxs-lookup"><span data-stu-id="98c11-138">When you're done, click the **Stop** button in the debugging toolbar to end the debugging session.</span></span>

<span data-ttu-id="98c11-139">An diesem Punkt verfügen Sie über einen voll funktionsfähigen Bot und wissen, wie Sie ihn durch lokale Ausführung im Microsoft Bot Emulator debuggen können.</span><span class="sxs-lookup"><span data-stu-id="98c11-139">At this point, you have a fully functioning bot and know how to debug it by running it locally in the Microsoft Bot Emulator.</span></span> <span data-ttu-id="98c11-140">Der nächste Schritt besteht darin, den Bot durch Herstellen einer Verbindung mit der Wissensdatenbank, die Sie in [Übung 2](#Exercise2) veröffentlicht haben, intelligenter zu machen.</span><span class="sxs-lookup"><span data-stu-id="98c11-140">The next step is to make the bot more intelligent by connecting it to the knowledge base you published in [Exercise 2](#Exercise2).</span></span>