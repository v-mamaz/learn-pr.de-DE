<span data-ttu-id="9dd73-101">Bevor wir einen virtuellen Linux-Computer in Azure erstellen können, müssen wir uns Gedanken über den Remotezugriff machen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-101">Before we can create a Linux virtual machine in Azure, we will need to think about remote access.</span></span> <span data-ttu-id="9dd73-102">Wir möchten uns bei unserem Linux-Webserver anmelden können, um die Software zu konfigurieren und Wartungsarbeiten auszuführen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-102">We want to be able to sign in to our Linux web server to configure the software and perform maintenance.</span></span> <span data-ttu-id="9dd73-103">Der Standardansatz zum Verwalten von virtuellen Linux-Computern, die in Azure gehostet werden, ist SSH.</span><span class="sxs-lookup"><span data-stu-id="9dd73-103">The default approach to administering Linux VMs hosted in Azure is SSH.</span></span>

<!-- Activate the sandbox -->
[!include[](../../../includes/azure-sandbox-activate.md)]

## <a name="what-is-ssh"></a><span data-ttu-id="9dd73-104">Was ist SSH?</span><span class="sxs-lookup"><span data-stu-id="9dd73-104">What is SSH?</span></span>

<span data-ttu-id="9dd73-105">Secure Shell (SSH) ist ein Protokoll für verschlüsselte Verbindungen, das die sichere Anmeldung über ungesicherte Verbindungen ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="9dd73-105">Secure Shell (SSH) is an encrypted connection protocol that allows secure sign-ins over unsecured connections.</span></span> <span data-ttu-id="9dd73-106">SSH ermöglicht es Ihnen, über eine Netzwerkverbindung von einem Remotestandort aus eine Verbindung mit einer Terminalshell herzustellen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-106">SSH allows you to connect to a terminal shell from a remote location using a network connection.</span></span>

<span data-ttu-id="9dd73-107">Es gibt zwei Ansätze, mit denen Sie eine SSH-Verbindung authentifizieren können: **Benutzername/Kennwort** oder ein **SSH-Schlüsselpaar**.</span><span class="sxs-lookup"><span data-stu-id="9dd73-107">There are two approaches we can use to authenticate an SSH connection: **username and password**, or an **SSH key pair**.</span></span>

> [!TIP]
> <span data-ttu-id="9dd73-108">SSH stellt bereits eine verschlüsselte Verbindung bereit. Bei Verwendung von Kennwörtern für SSH-Verbindungen ist der virtuelle Computer aber anfällig für Brute-Force-Angriffe auf Kennwörter.</span><span class="sxs-lookup"><span data-stu-id="9dd73-108">Although SSH provides an encrypted connection, using passwords with SSH connections leaves the VM vulnerable to brute-force attacks of passwords.</span></span> <span data-ttu-id="9dd73-109">Die sicherere und bevorzugte Methode für die Verbindungsherstellung mit einem virtuellen Linux-Computer über SSH ist die Verwendung eines Paars aus einem öffentlichen und einem privaten Schlüssel, auch als SSH-Schlüssel bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="9dd73-109">A more secure and preferred method of connecting to a Linux VM with SSH is a public-private key pair, also known as SSH keys.</span></span>

<span data-ttu-id="9dd73-110">Mit einem SSH-Schlüsselpaar können Sie sich bei Linux-basierten virtuellen Azure-Computern ohne ein Kennwort anmelden.</span><span class="sxs-lookup"><span data-stu-id="9dd73-110">With an SSH key pair, you can sign in to Linux-based Azure virtual machines without a password.</span></span> <span data-ttu-id="9dd73-111">Dies ist ein sichererer Ansatz, wenn Sie sich nur von einigen wenigen Computern aus anmelden möchten.</span><span class="sxs-lookup"><span data-stu-id="9dd73-111">This is a more secure approach if you only plan to sign in to the VM from a few computers.</span></span> <span data-ttu-id="9dd73-112">Wenn Sie von verschiedenen Standorten aus auf den virtuellen Linux-Computer zugreifen müssen, ist eine Kombination aus Benutzername und Kennwort vielleicht die bessere Lösung.</span><span class="sxs-lookup"><span data-stu-id="9dd73-112">If you need to be able to access the Linux VM from a variety of locations, a username and password combination might be a better approach.</span></span> <span data-ttu-id="9dd73-113">Ein SSH-Schlüsselpaar besteht aus zwei Teilen: einem öffentlichen Schlüssel und einem privaten Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="9dd73-113">There are two parts to an SSH key pair: a public key and a private key.</span></span>

* <span data-ttu-id="9dd73-114">Der öffentliche Schlüssel wird auf Ihrem virtuellen Linux-Computer oder in einem anderen Dienst gespeichert, den Sie für die Verschlüsselung mit einem öffentlichen Schlüssel verwenden möchten.</span><span class="sxs-lookup"><span data-stu-id="9dd73-114">The public key is placed on your Linux VM or any other service that you wish to use with public-key cryptography.</span></span> <span data-ttu-id="9dd73-115">Dieser Schlüssel kann für beliebige Personen freigegeben werden.</span><span class="sxs-lookup"><span data-stu-id="9dd73-115">This can be shared with anyone.</span></span>

* <span data-ttu-id="9dd73-116">Sie geben den **privaten Schlüssel** beim Herstellen einer SSH-Verbindung für Ihren virtuellen Linux-Computer an, um Ihre Identität zu bestätigen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-116">The **private key** is what you present to verify your identity to your Linux VM when you make an SSH connection.</span></span> <span data-ttu-id="9dd73-117">Betrachten Sie diesen als vertrauliche Information, und schützen Sie ihn wie ein Kennwort oder andere private Daten.</span><span class="sxs-lookup"><span data-stu-id="9dd73-117">Consider this confidential information and protect this like you would a password or any other private data.</span></span>

<span data-ttu-id="9dd73-118">Sie können das gleiche Paar aus einem öffentlichen und privaten Schlüssel verwenden, um auf mehrere virtuelle Azure-Computer und Dienste zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-118">You can use the same single public-private key pair to access multiple Azure VMs and services.</span></span>

## <a name="create-the-ssh-key-pair"></a><span data-ttu-id="9dd73-119">Erstellen des SSH-Schlüsselpaars</span><span class="sxs-lookup"><span data-stu-id="9dd73-119">Create the SSH key pair</span></span>

<span data-ttu-id="9dd73-120">Unter Linux, Windows 10 und macOS können Sie den integrierten Befehl `ssh-keygen` verwenden, um die Dateien mit den öffentlichen und privaten SSH-Schlüsseln zu generieren.</span><span class="sxs-lookup"><span data-stu-id="9dd73-120">On Linux, Windows 10, and MacOS, you can use the built-in `ssh-keygen` command to generate the SSH public and private key files.</span></span>

> [!TIP]
> <span data-ttu-id="9dd73-121">Windows 10 bietet mit dem **Fall Creators Update** einen SSH-Client.</span><span class="sxs-lookup"><span data-stu-id="9dd73-121">Windows 10 includes an SSH client with the **Fall Creators Update**.</span></span> <span data-ttu-id="9dd73-122">In früheren Windows-Versionen ist für die Verwendung von SSH zusätzliche Software erforderlich. [Ausführliche Informationen finden Sie in der Dokumentation](https://docs.microsoft.com/azure/virtual-machines/linux/ssh-from-windows).</span><span class="sxs-lookup"><span data-stu-id="9dd73-122">Earlier versions of Windows require additional software to use SSH; [check the documentation for full details](https://docs.microsoft.com/azure/virtual-machines/linux/ssh-from-windows).</span></span> <span data-ttu-id="9dd73-123">Alternativ können Sie SSH auch dann nutzen, wenn Sie das Linux-Subsystem für Windows installieren.</span><span class="sxs-lookup"><span data-stu-id="9dd73-123">Alternatively, you can install the Linux subsystem for Windows and get the same functionality.</span></span>

> [!NOTE]
> <span data-ttu-id="9dd73-124">Wir verwenden Azure Cloud Shell, die die generierten Schlüssel in Azure in Ihrem privaten Speicherkonto speichert.</span><span class="sxs-lookup"><span data-stu-id="9dd73-124">We will use Azure Cloud Shell, which will store the generated keys in Azure in your private storage account.</span></span> <span data-ttu-id="9dd73-125">Sie können diese Befehle auch direkt in Ihre lokale Shell eingeben, wenn Sie möchten.</span><span class="sxs-lookup"><span data-stu-id="9dd73-125">You can also type these commands directly into your local shell if you prefer.</span></span> <span data-ttu-id="9dd73-126">Sie müssen die Anweisungen in diesem Modul so anpassen, dass sie einer lokalen Sitzung entsprechen, wenn Sie diesen Ansatz verfolgen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-126">You will need to adjust the instructions throughout this module to reflect a local session if you take this approach.</span></span>

[!include[](../../../includes/azure-sandbox-activate.md)]

<span data-ttu-id="9dd73-127">Bei dem folgenden Befehl handelt es sich um die kürzeste Anweisung, um das Schlüsselpaar für einen virtuellen Azure-Computer zu generieren.</span><span class="sxs-lookup"><span data-stu-id="9dd73-127">Here is the minimum command necessary to generate the key pair for an Azure VM.</span></span> <span data-ttu-id="9dd73-128">Dadurch wird ein RSA-Schlüsselpaar mit einem öffentlichen und privaten Schlüssel mit einer Länge von 2048 Bit (der Mindestlänge) erstellt, wobei das SSH-Protokoll 2 (SSH-2) genutzt wird.</span><span class="sxs-lookup"><span data-stu-id="9dd73-128">This will create an SSH protocol 2 (SSH-2) RSA public-private key pair with a 2048-bit length (the minimum length).</span></span>

<span data-ttu-id="9dd73-129">Geben Sie den folgenden Befehl in Cloud Shell ein:</span><span class="sxs-lookup"><span data-stu-id="9dd73-129">Type this command into Cloud Shell:</span></span>

```bash
ssh-keygen -t rsa -b 2048
```

<span data-ttu-id="9dd73-130">Das Tool fordert zur Eingabe von Dateinamen und einer optionalen Passphrase auf.</span><span class="sxs-lookup"><span data-stu-id="9dd73-130">The tool will prompt for file names and an optional passphrase.</span></span> <span data-ttu-id="9dd73-131">Verwenden Sie einfach die Standardeinstellungen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-131">Just take the defaults.</span></span> <span data-ttu-id="9dd73-132">Es werden zwei Dateien erstellt: `id_rsa` und `id_rsa.pub` im Verzeichnis `~/.ssh`.</span><span class="sxs-lookup"><span data-stu-id="9dd73-132">It will create two files: `id_rsa` and `id_rsa.pub` in the `~/.ssh` directory.</span></span> <span data-ttu-id="9dd73-133">Die Dateien werden überschrieben, wenn sie bereits vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="9dd73-133">The files will be overwritten if they exist.</span></span> <span data-ttu-id="9dd73-134">Es gibt verschiedene Optionen, die Sie verwenden können, um den Dateinamen oder eine Passphrase anzugeben, wenn Sie die Eingabeaufforderung vermeiden möchten.</span><span class="sxs-lookup"><span data-stu-id="9dd73-134">There are various options you can use to provide the file name or a passphrase to avoid the prompt.</span></span>

### <a name="private-key-passphrase"></a><span data-ttu-id="9dd73-135">Passphrase für den privaten Schlüssel</span><span class="sxs-lookup"><span data-stu-id="9dd73-135">Private key passphrase</span></span>

<span data-ttu-id="9dd73-136">Sie können optional eine Passphrase angeben, während Sie Ihren privaten Schlüssel generieren.</span><span class="sxs-lookup"><span data-stu-id="9dd73-136">You can optionally provide a passphrase while generating your private key.</span></span> <span data-ttu-id="9dd73-137">Dies ist ein Kennwort, das Sie eingeben müssen, wenn Sie den Schlüssel verwenden.</span><span class="sxs-lookup"><span data-stu-id="9dd73-137">This is a password you must enter when you use the key.</span></span> <span data-ttu-id="9dd73-138">Diese Passphrase wird für den Zugriff auf die private SSH-Schlüsseldatei verwendet und ist nicht das Kennwort für das Benutzerkonto.</span><span class="sxs-lookup"><span data-stu-id="9dd73-138">This passphrase is used to access the private SSH key file and is not the user account password.</span></span>

<span data-ttu-id="9dd73-139">Wenn Sie Ihren SSH-Schlüssel mit einer Passphrase versehen, wird der private Schlüssel mit der 128-Bit-AES-Variante verschlüsselt, sodass er ohne die Passphrase nicht verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="9dd73-139">When you add a passphrase to your SSH key, it encrypts the private key using 128-bit AES so that the private key is useless without the passphrase to decrypt it.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9dd73-140">Es wird **dringend** empfohlen, eine Passphrase hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-140">It is **strongly** recommended that you add a passphrase.</span></span> <span data-ttu-id="9dd73-141">Falls ein Angreifer Ihren privaten Schlüssel entwendet und dafür keine Passphrase konfiguriert wurde, kann sich der Angreifer mithilfe des privaten Schlüssels bei jedem Server anmelden, der über den entsprechenden öffentlichen Schlüssel verfügt.</span><span class="sxs-lookup"><span data-stu-id="9dd73-141">If an attacker stole your private key and that key did not have a passphrase, they would be able to use that private key to log in to any servers that have the corresponding public key.</span></span> <span data-ttu-id="9dd73-142">Wenn mit einer Passphrase ein privater Schlüssel geschützt wird, kann er von diesem Angreifer nicht genutzt werden.</span><span class="sxs-lookup"><span data-stu-id="9dd73-142">If a passphrase protects a private key, it cannot be used by that attacker.</span></span> <span data-ttu-id="9dd73-143">Dies ist eine zusätzliche Sicherheitsebene für Ihre Infrastruktur in Azure dar.</span><span class="sxs-lookup"><span data-stu-id="9dd73-143">This provides an additional layer of security for your infrastructure on Azure.</span></span>

<span data-ttu-id="9dd73-144">Das folgende Beispiel zeigt, wie die Passphrase festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="9dd73-144">Here is an example showing how to set the passphrase.</span></span> <span data-ttu-id="9dd73-145">Die Ausführung dieses Befehls ist optional:</span><span class="sxs-lookup"><span data-stu-id="9dd73-145">You don't need to execute this command (although you can if you want to):</span></span>

```bash
ssh-keygen -t rsa -b 4096 \
    -C "azureuser@myserver" \
    -f ~/.ssh/mykeys/myprivatekey \
    -N someReallySecurePhraseYouWillRemember
```

| <span data-ttu-id="9dd73-146">Parameter</span><span class="sxs-lookup"><span data-stu-id="9dd73-146">Parameter</span></span> | <span data-ttu-id="9dd73-147">Funktionsbeschreibung</span><span class="sxs-lookup"><span data-stu-id="9dd73-147">What it does</span></span> |
|-----------|--------------|
| `-t` | <span data-ttu-id="9dd73-148">Der Typ des zu erstellenden Schlüssels.</span><span class="sxs-lookup"><span data-stu-id="9dd73-148">Type of key to create.</span></span> <span data-ttu-id="9dd73-149">Muss **rsa** sein.</span><span class="sxs-lookup"><span data-stu-id="9dd73-149">Must be **rsa**.</span></span> |
| `-b` | <span data-ttu-id="9dd73-150">Die Anzahl der Bits im Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="9dd73-150">Number of bits in the key.</span></span> <span data-ttu-id="9dd73-151">Die Mindestlänge beträgt 2.048 Bits, die Höchstlänge 4.096 Bits.</span><span class="sxs-lookup"><span data-stu-id="9dd73-151">Minimum length is 2048; maximum is 4096.</span></span> |
| `-C` | <span data-ttu-id="9dd73-152">Ein optionaler Kommentar, der an den öffentlichen Schlüssel angefügt wird und verwendet werden kann, um ihn zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="9dd73-152">An optional comment to append to the public key that can be used to identify it.</span></span> <span data-ttu-id="9dd73-153">Normalerweise ist dies eine E-Mail-Adresse, aber es handelt sich um einfachen Text.</span><span class="sxs-lookup"><span data-stu-id="9dd73-153">Normally, this is an email address, but it's simple text.</span></span> <span data-ttu-id="9dd73-154">Daher können Sie eine beliebige Identifikationsmethode verwenden, die Sie bevorzugen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-154">As a result, you can use whatever identification method you prefer.</span></span> |
| `-f` | <span data-ttu-id="9dd73-155">Der Speicherort und Dateiname der Datei mit dem privaten Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="9dd73-155">The location and file name of the private key file.</span></span> <span data-ttu-id="9dd73-156">Eine entsprechende Datei für den öffentlichen Schlüssel mit der Erweiterung **.pub** wird im gleichen Verzeichnis generiert.</span><span class="sxs-lookup"><span data-stu-id="9dd73-156">A corresponding public key file appended with **.pub** is generated in the same directory.</span></span> <span data-ttu-id="9dd73-157">Das Verzeichnis muss vorhanden sein.</span><span class="sxs-lookup"><span data-stu-id="9dd73-157">The directory must exist.</span></span> |
| `-N` | <span data-ttu-id="9dd73-158">Die Passphrase, die zum Verschlüsseln des privaten Schlüssels verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="9dd73-158">The passphrase used to encrypt the private key.</span></span> |

## <a name="use-the-ssh-key-pair-with-an-azure-linux-vm"></a><span data-ttu-id="9dd73-159">Verwenden des SSH-Schlüsselpaars mit einem virtuellen Linux-Computer in Azure</span><span class="sxs-lookup"><span data-stu-id="9dd73-159">Use the SSH key pair with an Azure Linux VM</span></span>

<span data-ttu-id="9dd73-160">Nachdem Sie das Schlüsselpaar generiert haben, können Sie es mit einem virtuellen Linux-Computer in Azure verwenden.</span><span class="sxs-lookup"><span data-stu-id="9dd73-160">Once you have the key pair generated, you can use it with a Linux VM in Azure.</span></span> <span data-ttu-id="9dd73-161">Sie können den öffentlichen Schlüssel während der Erstellung des virtuellen Computers angeben oder nach dem Erstellen des virtuellen Computers hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-161">You can supply the public key during the VM creation or add it after the VM has been created.</span></span>

<span data-ttu-id="9dd73-162">Sie können den Inhalt der Datei in Azure Cloud Shell mit dem folgenden Befehl anzeigen:</span><span class="sxs-lookup"><span data-stu-id="9dd73-162">You can view the contents of the file in Azure Cloud Shell with the following command:</span></span>

```bash
cat ~/.ssh/id_rsa.pub
```

<span data-ttu-id="9dd73-163">Es handelt sich um eine einzelne Zeile, die ungefähr wie das folgende Beispiel aussieht:</span><span class="sxs-lookup"><span data-stu-id="9dd73-163">It will be a single line and look something like:</span></span>

```output
ssh-rsa XXXXXXXXXXc2EAAAADAXABAAABAXC5Am7+fGZ+5zXBGgXS6GUvmsXCLGc7tX7/rViXk3+eShZzaXnt75gUmT1I2f75zFn2hlAIDGKWf4g12KWcZxy81TniUOTjUsVlwPymXUXxESL/UfJKfbdstBhTOdy5EG9rYWA0K43SJmwPhH28BpoLfXXXXXGX/ilsXXXXXKgRLiJ2W19MzXHp8z3Lxw7r9wx3HaVlP4XiFv9U4hGcp8RMI1MP1nNesFlOBpG4pV2bJRBTXNXeY4l6F8WZ3C4kuf8XxOo08mXaTpvZ3T1841altmNTZCcPkXuMrBjYSJbA8npoXAXNwiivyoe3X2KMXXXXXdXXXXXXXXXXCXXXXX/ azureuser@myserver
```

<span data-ttu-id="9dd73-164">Kopieren Sie diesen Wert, damit Sie ihn in der nächsten Übung verwenden können.</span><span class="sxs-lookup"><span data-stu-id="9dd73-164">Copy this value, so you can use it in the next exercise.</span></span>

### <a name="use-the-ssh-key-when-creating-a-linux-vm"></a><span data-ttu-id="9dd73-165">Verwenden des SSH-Schlüssels beim Erstellen eines virtuellen Linux-Computers</span><span class="sxs-lookup"><span data-stu-id="9dd73-165">Use the SSH key when creating a Linux VM</span></span>

<span data-ttu-id="9dd73-166">Um den SSH-Schlüssel beim Erstellen eines neuen virtuellen Linux-Computers anzuwenden, müssen Sie den Inhalt des öffentlichen Schlüssels kopieren und im Azure-Portal zur Verfügung stellen, _oder_ stellen Sie die Datei mit dem öffentlichen Schlüssel in der Azure CLI oder mit einem Azure PowerShell-Befehl bereit.</span><span class="sxs-lookup"><span data-stu-id="9dd73-166">To apply the SSH key while creating a new Linux VM, you will need to copy the contents of the public key and supply it to the Azure portal, _or_ supply the public key file to the Azure CLI or Azure PowerShell command.</span></span> <span data-ttu-id="9dd73-167">Wir verwenden diesen Ansatz, wenn wir den virtuellen Linux-Computer erstellen.</span><span class="sxs-lookup"><span data-stu-id="9dd73-167">We'll use this approach when we create our Linux VM.</span></span>

### <a name="add-the-ssh-key-to-an-existing-linux-vm"></a><span data-ttu-id="9dd73-168">Hinzufügen des SSH-Schlüssels zu einem vorhandenen virtuellen Linux-Computer</span><span class="sxs-lookup"><span data-stu-id="9dd73-168">Add the SSH key to an existing Linux VM</span></span>

<span data-ttu-id="9dd73-169">Wenn Sie bereits einen virtuellen Computer erstellt haben, können Sie den öffentlichen Schlüssel auf dem virtuellen Linux-Computer mit dem Befehl `ssh-copy-id` installieren.</span><span class="sxs-lookup"><span data-stu-id="9dd73-169">If you have already created a VM, you can install the public key onto your Linux VM with the `ssh-copy-id` command.</span></span> <span data-ttu-id="9dd73-170">Nachdem der Schlüssel für SSH autorisiert wurde, gewährt er ohne Angabe eines Kennworts Zugriff auf den Server.</span><span class="sxs-lookup"><span data-stu-id="9dd73-170">Once the key has been authorized for SSH, it grants access to the server without a password.</span></span>

<span data-ttu-id="9dd73-171">Übergeben Sie ihm die Datei mit dem öffentlichen Schlüssel und den Benutzernamen, der dem Schlüssel zugeordnet werden soll:</span><span class="sxs-lookup"><span data-stu-id="9dd73-171">Pass it the public key file and the username to associate with the key:</span></span>

```bash
ssh-copy-id -i ~/.ssh/id_rsa.pub azureuser@myserver
```

<span data-ttu-id="9dd73-172">Da wir nun über unseren öffentlichen Schlüssel verfügen, wechseln wir zum Azure-Portal und erstellen einen virtuellen Linux-Computer.</span><span class="sxs-lookup"><span data-stu-id="9dd73-172">Now that we have our public key, let's switch to the Azure portal and create a Linux VM.</span></span>
