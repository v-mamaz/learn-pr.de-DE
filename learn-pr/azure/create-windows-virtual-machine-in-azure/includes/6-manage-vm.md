<span data-ttu-id="dded4-101">Wir haben unsere benutzerdefinierte Software installiert, einen FTP-Server eingerichtet und den virtuellen Computer für den Empfang von Videodateien konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="dded4-101">We've installed our custom software, set up an FTP server, and configured the VM to receive our video files.</span></span> <span data-ttu-id="dded4-102">Allerdings können wir keine FTP-Verbindung mit unserer öffentlichen IP-Adresse herstellen, da sie blockiert wird.</span><span class="sxs-lookup"><span data-stu-id="dded4-102">However, if we try to connect to our public IP address with FTP, we'll find that it's blocked.</span></span> 

<span data-ttu-id="dded4-103">In der Regel werden Änderungen an der Serverkonfiguration über Geräte in Ihrer lokalen Umgebung vorgenommen.</span><span class="sxs-lookup"><span data-stu-id="dded4-103">Making adjustments to server configuration is commonly performed with equipment in your on-premises environment.</span></span> <span data-ttu-id="dded4-104">In diesem Sinne können virtuelle Azure-Computer als Erweiterung dieser Umgebung betrachtet werden.</span><span class="sxs-lookup"><span data-stu-id="dded4-104">In this sense, you can consider Azure VMs to be an extension of that environment.</span></span> <span data-ttu-id="dded4-105">Sie können mithilfe des Azure-Portals, der Azure CLI oder der Azure PowerShell-Tools Änderungen an Konfigurationen vornehmen, Netzwerke verwalten und Datenverkehr zulassen oder blockieren.</span><span class="sxs-lookup"><span data-stu-id="dded4-105">You can make configuration changes, manage networks, open or block traffic, and more through the Azure portal, Azure CLI, or Azure PowerShell tools.</span></span>

<span data-ttu-id="dded4-106">Sie haben bereits einige der grundlegenden Informationen und Verwaltungsoptionen des Bereichs **Übersicht** für den virtuellen Computer gesehen.</span><span class="sxs-lookup"><span data-stu-id="dded4-106">You've already seen some of the basic information and management options in the **Overview** panel for the virtual machine.</span></span> <span data-ttu-id="dded4-107">Hier gehen wir etwas ausführlicher auf die Netzwerkkonfiguration ein.</span><span class="sxs-lookup"><span data-stu-id="dded4-107">Let's explore network configuration a bit more.</span></span>

## <a name="opening-ports-in-azure-vms"></a><span data-ttu-id="dded4-108">Öffnen von Ports auf virtuellen Azure-Computern</span><span class="sxs-lookup"><span data-stu-id="dded4-108">Opening ports in Azure VMs</span></span>

<span data-ttu-id="dded4-109">Standardmäßig sind neue virtuelle Computer gesperrt.</span><span class="sxs-lookup"><span data-stu-id="dded4-109">By default, new VMs are locked down.</span></span> 

<span data-ttu-id="dded4-110">Apps können ausgehende Anforderungen vornehmen, aber der einzige zulässige eingehende Datenverkehr stammt aus dem virtuellen Netzwerk (z.B. andere Ressourcen im gleichen lokalen Netzwerk) und aus dem Load Balancer von Azure (Testprüfungen).</span><span class="sxs-lookup"><span data-stu-id="dded4-110">Apps can make outgoing requests, but the only inbound traffic allowed is from the virtual network (e.g. other resources on the same local network), and from Azure's Load Balancer (probe checks).</span></span>

<span data-ttu-id="dded4-111">Sie können die Konfiguration in zwei Schritten ändern, sodass FTP unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="dded4-111">There are two steps to adjusting the configuration to support FTP.</span></span> <span data-ttu-id="dded4-112">Bei der Erstellung eines neuen virtuellen Computers können Sie einige gängige Ports öffnen (RDP, HTTP, HTTPS und SSH).</span><span class="sxs-lookup"><span data-stu-id="dded4-112">When you create a new VM you have an opportunity to open a few common ports (RDP, HTTP, HTTPS, and SSH).</span></span> <span data-ttu-id="dded4-113">Weitere Änderungen an der Firewall müssen Sie allerdings manuell vornehmen.</span><span class="sxs-lookup"><span data-stu-id="dded4-113">However, if you require other changes to the firewall, you will need to do them yourself.</span></span>

<span data-ttu-id="dded4-114">Der Prozess umfasst zwei Schritte:</span><span class="sxs-lookup"><span data-stu-id="dded4-114">The process for this involves two steps:</span></span>

1. <span data-ttu-id="dded4-115">Erstellen einer Netzwerksicherheitsgruppe</span><span class="sxs-lookup"><span data-stu-id="dded4-115">Create a Network Security Group.</span></span>
2. <span data-ttu-id="dded4-116">Erstellen einer Eingangsregel für eine aktive FTP-Unterstützung, die Datenverkehr an den Ports 20 und 21 zulässt</span><span class="sxs-lookup"><span data-stu-id="dded4-116">Create an inbound rule allowing traffic on port 20 and 21 for active FTP support.</span></span>

### <a name="what-is-a-network-security-group"></a><span data-ttu-id="dded4-117">Was ist eine Netzwerksicherheitsgruppe?</span><span class="sxs-lookup"><span data-stu-id="dded4-117">What is a Network Security Group?</span></span>

<span data-ttu-id="dded4-118">Virtuelle Netzwerke (VNETs) stellen die Grundlage des Azure-Netzwerkmodells dar und sorgen für Isolation und Schutz.</span><span class="sxs-lookup"><span data-stu-id="dded4-118">Virtual networks (VNets) are the foundation of the Azure networking model and provide isolation and protection.</span></span> <span data-ttu-id="dded4-119">Netzwerksicherheitsgruppen (NSGs) sind das wichtigste Tool zur Erzwingung und Steuerung von Regeln für Netzwerkdatenverkehr auf Netzwerkebene.</span><span class="sxs-lookup"><span data-stu-id="dded4-119">Network Security Groups (NSGs) are the main tool you use to enforce and control network traffic rules at the networking level.</span></span> <span data-ttu-id="dded4-120">NSGs sind eine optionale Sicherheitsebene mit einer Softwarefirewall zur Filterung von eingehendem und ausgehendem Datenverkehr für das VNET.</span><span class="sxs-lookup"><span data-stu-id="dded4-120">NSGs are an optional security layer that provides a software firewall by filtering inbound and outbound traffic on the VNet.</span></span> 

<span data-ttu-id="dded4-121">Außerdem können sie einer Netzwerkschnittstelle (für hostspezifische Regeln), einem Subnetz im VNet (das für mehrere Ressourcen verwendbar ist) oder beiden zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="dded4-121">Security groups can be associated to a network interface (for per-host rules), a subnet in the virtual network (to apply to multiple resources), or both levels.</span></span> 

#### <a name="security-group-rules"></a><span data-ttu-id="dded4-122">Regeln für Sicherheitsgruppen</span><span class="sxs-lookup"><span data-stu-id="dded4-122">Security group rules</span></span>

<span data-ttu-id="dded4-123">NGS verwenden _Regeln_, um Datenverkehr im Netzwerk zuzulassen oder zu blockieren.</span><span class="sxs-lookup"><span data-stu-id="dded4-123">NGSs use _rules_ to allow or deny traffic moving through the network.</span></span> <span data-ttu-id="dded4-124">Jede Regel gibt die Quell- und Zieladresse (oder den entsprechenden Adressbereich), das Protokoll, den Port (oder den Portbereich), die Richtung (eingehend oder ausgehend) sowie eine numerische Priorität an und legt fest, ob der entsprechende Datenverkehr zugelassen oder blockiert werden soll.</span><span class="sxs-lookup"><span data-stu-id="dded4-124">Each rule identifies the source and destination address (or range), protocol, port (or range), direction (inbound or outbound), a numeric priority, and whether to allow or deny the traffic that matches the rule.</span></span> <span data-ttu-id="dded4-125">Die folgende Abbildung zeigt NSG-Regeln, die auf Subnetz- und Netzwerkschnittstellenebene angewendet wurden.</span><span class="sxs-lookup"><span data-stu-id="dded4-125">The following illustration shows NSG rules applied at the subnet and network interface levels.</span></span>

![Abbildung, die die Architektur von Netzwerksicherheitsgruppen in zwei verschiedenen Subnetzen zeigt.](../media/7-nsg-rules.png)

<span data-ttu-id="dded4-129">Jede Sicherheitsgruppe verfügt über einen Satz von Standardsicherheitsregeln, um die oben beschriebenen Standardnetzwerkregeln anzuwenden.</span><span class="sxs-lookup"><span data-stu-id="dded4-129">Each security group has a set of default security rules to apply the default network rules described above.</span></span> <span data-ttu-id="dded4-130">Diese Standardregeln können zwar nicht verändert, aber sie können _überschrieben_ werden.</span><span class="sxs-lookup"><span data-stu-id="dded4-130">These default rules cannot be modified, but _can_ be overridden.</span></span>

#### <a name="how-azure-uses-network-rules"></a><span data-ttu-id="dded4-131">Verwendung von Netzwerkregeln durch Azure</span><span class="sxs-lookup"><span data-stu-id="dded4-131">How Azure uses network rules</span></span>

<span data-ttu-id="dded4-132">Für eingehenden Datenverkehr verarbeitet Azure zuerst die Sicherheitsgruppe, die dem Subnetz zugeordnet ist, und anschließend die Sicherheitsgruppe, die der Netzwerkschnittstelle zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="dded4-132">For inbound traffic, Azure processes the security group associated to the subnet, then the security group applied to the network interface.</span></span> <span data-ttu-id="dded4-133">Ausgehender Datenverkehr wird in umgekehrter Reihenfolge verarbeitet (also erst die Netzwerkschnittstelle, dann das Subnetz).</span><span class="sxs-lookup"><span data-stu-id="dded4-133">Outbound traffic is processed in the opposite order (the network interface first, followed by the subnet).</span></span>

> [!WARNING]
> <span data-ttu-id="dded4-134">Beachten Sie, dass Sicherheitsgruppen auf beiden Ebenen optional sind.</span><span class="sxs-lookup"><span data-stu-id="dded4-134">Keep in mind that security groups are optional at both levels.</span></span> <span data-ttu-id="dded4-135">Wenn keine Sicherheitsgruppe verwendet wird, lässt Azure **sämtlichen Datenverkehr** zu.</span><span class="sxs-lookup"><span data-stu-id="dded4-135">If no security group is applied then **all traffic is allowed** by Azure.</span></span> <span data-ttu-id="dded4-136">Wenn der virtuelle Computer über eine öffentliche IP-Adresse verfügt, kann dies ein ernsthaftes Risiko darstellen – insbesondere, wenn das Betriebssystem keine Firewall bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="dded4-136">If the VM has a public IP, this could be a serious risk particularly if the OS doesn't provide some sort of firewall.</span></span>

<span data-ttu-id="dded4-137">Die Regeln werden je nach _Priorität_ bewertet, angefangen bei der Regel mit der **niedrigsten Priorität**.</span><span class="sxs-lookup"><span data-stu-id="dded4-137">The rules are evaluated in _priority-order_, starting with the **lowest priority** rule.</span></span> <span data-ttu-id="dded4-138">Ablehnungsregeln führen immer zur **Beendigung** der Auswertung.</span><span class="sxs-lookup"><span data-stu-id="dded4-138">Deny rules always **stop** the evaluation.</span></span> <span data-ttu-id="dded4-139">Wenn also beispielsweise eine ausgehende Anforderung durch eine Netzwerkschnittstellenregel blockiert wird, werden sämtliche Regeln, die auf das Subnetz angewendet werden, nicht mehr überprüft.</span><span class="sxs-lookup"><span data-stu-id="dded4-139">For example, if an outbound request is blocked by a network interface rule, any rules applied to the subnet will not be checked.</span></span> <span data-ttu-id="dded4-140">Damit die Sicherheitsgruppe Datenverkehr zulässt, muss dieser _alle_ angewendeten Gruppen durchlaufen.</span><span class="sxs-lookup"><span data-stu-id="dded4-140">In order for traffic to be allowed through the security group, it must pass through _all_ applied groups.</span></span>

<span data-ttu-id="dded4-141">Die letzte Regel ist immer eine Regel vom Typ **Alle ablehnen**.</span><span class="sxs-lookup"><span data-stu-id="dded4-141">The last rule is always a **Deny All** rule.</span></span> <span data-ttu-id="dded4-142">Diese Standardregel wird jeder Sicherheitsgruppe für eingehenden und ausgehenden Datenverkehr mit der Priorität 65.500 hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="dded4-142">This is a default rule added to every security group for both inbound and outbound traffic with a priority of 65500.</span></span> <span data-ttu-id="dded4-143">D.h., der Datenverkehr muss die Sicherheitsgruppe durchlaufen, und _Sie müssen über eine Zulassungsregel verfügen_, damit dieser nicht von der letzten Standardregel blockiert wird.</span><span class="sxs-lookup"><span data-stu-id="dded4-143">That means to have traffic pass through the security group _you must have an allow rule_ or it will be blocked by the default final rule.</span></span>

> [!NOTE]
> <span data-ttu-id="dded4-144">SMTP (Port 25) ist ein Sonderfall. Abhängig von Ihrer Abonnementstufe und dem Erstelldatum Ihres Kontos wird ausgehender SMTP-Datenverkehr möglicherweise blockiert.</span><span class="sxs-lookup"><span data-stu-id="dded4-144">SMTP (port 25) is a special case, depending on your subscription level and when your account was created, outbound SMTP traffic may be blocked.</span></span> <span data-ttu-id="dded4-145">Sie können einen Antrag auf Entfernen dieser Einschränkung stellen, wenn Sie dies geschäftlich begründen können.</span><span class="sxs-lookup"><span data-stu-id="dded4-145">You can make a request to remove this restriction with business justification.</span></span>

<span data-ttu-id="dded4-146">Nachfolgend erfahren Sie, wie Sie eine Sicherheitsgruppe für diese VM erstellen.</span><span class="sxs-lookup"><span data-stu-id="dded4-146">Since we didn't create a security group for this VM, let's do that and apply it.</span></span>

## <a name="creating-network-security-groups"></a><span data-ttu-id="dded4-147">Erstellen von Netzwerksicherheitsgruppen</span><span class="sxs-lookup"><span data-stu-id="dded4-147">Creating Network Security Groups</span></span>

<span data-ttu-id="dded4-148">Sicherheitsgruppen sind verwaltete Ressourcen, die Sie wie beinahe alle Azure-Elemente über das Azure-Portal oder mithilfe von Skripterstellungstools auf Befehlszeilenebene erstellen können.</span><span class="sxs-lookup"><span data-stu-id="dded4-148">Security groups are managed resources like most everything in Azure, you can create them in the Azure portal or through command-line scripting tools.</span></span> <span data-ttu-id="dded4-149">Die Schwierigkeit besteht darin, die Regeln zu definieren.</span><span class="sxs-lookup"><span data-stu-id="dded4-149">The challenge is in defining the rules.</span></span> <span data-ttu-id="dded4-150">Im nächsten Teil erfahren Sie, wie Sie eine neue Regel erstellen, um FTP-Zugriff zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="dded4-150">Let's look at defining a new rule to allow FTP access.</span></span>