<span data-ttu-id="ced23-101">Es wurde bereits erläutert, wie Sie benutzerdefinierte Software installieren, einen FTP-Server einrichten und die VM so konfigurieren, dass sie Videodateien empfängt.</span><span class="sxs-lookup"><span data-stu-id="ced23-101">We've installed our custom software, set up an FTP server, and configured the VM to receive our video files.</span></span> <span data-ttu-id="ced23-102">Sie können allerding nicht über einen FTP-Server eine Verbindung mit einer öffentlichen IP-Adresse herstellen.</span><span class="sxs-lookup"><span data-stu-id="ced23-102">However, if we try to connect to our public IP address with FTP, we'll find that it's blocked.</span></span> 

<span data-ttu-id="ced23-103">In der Regel werden Änderungen an Serverkonfigurationen mithilfe von Geräten in Ihrer lokalen Umgebung vorgenommen.</span><span class="sxs-lookup"><span data-stu-id="ced23-103">Making adjustments to server configuration is commonly performed with equipment in your on-premises environment.</span></span> <span data-ttu-id="ced23-104">In diesem Zusammenhang stellen Azure-VMs eine Erweiterung zu dieser Umgebung dar.</span><span class="sxs-lookup"><span data-stu-id="ced23-104">In this sense, you can consider Azure VMs to be an extension of that environment.</span></span> <span data-ttu-id="ced23-105">Sie können mithilfe des Azure-Portals, der Azure CLI oder der Azure PowerShell-Tools Änderungen an Konfigurationen vornehmen, Netzwerke verwalten und Datenverkehr zulassen oder blockieren.</span><span class="sxs-lookup"><span data-stu-id="ced23-105">You can make configuration changes, manage networks, open or block traffic, and more through the Azure portal, Azure CLI, or Azure PowerShell tools.</span></span>

<span data-ttu-id="ced23-106">Einige der grundlegenden Informationen und die Verwaltungsoptionen im Bereich **Übersicht** der VM wurden bereits erläutert.</span><span class="sxs-lookup"><span data-stu-id="ced23-106">You've already seen some of the basic information and management options in the **Overview** panel for the virtual machine.</span></span> <span data-ttu-id="ced23-107">Nachfolgend wird ausführlicher auf Netzwerkkonfigurationen eingegangen.</span><span class="sxs-lookup"><span data-stu-id="ced23-107">Let's explore network configuration a bit more.</span></span>

## <a name="opening-ports-in-azure-vms"></a><span data-ttu-id="ced23-108">Öffnen von Ports in Azure-VMs</span><span class="sxs-lookup"><span data-stu-id="ced23-108">Opening ports in Azure VMs</span></span>

<!-- TODO: Azure portal is inconsistent here in applying the NSG.
By default, new VMs are locked down. 

Apps can make outgoing requests, but the only inbound traffic allowed is from the virtual network (e.g. other resources on the same local network), and from Azure's Load Balancer (probe checks). -->

<span data-ttu-id="ced23-109">Sie können die Konfiguration in zwei Schritten ändern, sodass FTP unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="ced23-109">There are two steps to adjusting the configuration to support FTP.</span></span> <span data-ttu-id="ced23-110">Wenn Sie eine neue VM erstellen, können Sie einige häufig verwendete Ports öffnen (RDP, HTTP, HTTPS und SSH).</span><span class="sxs-lookup"><span data-stu-id="ced23-110">When you create a new VM you have an opportunity to open a few common ports (RDP, HTTP, HTTPS, and SSH).</span></span> <span data-ttu-id="ced23-111">Weitere Änderungen an der Firewall müssen Sie allerdings manuell vornehmen.</span><span class="sxs-lookup"><span data-stu-id="ced23-111">However, if you require other changes to the firewall, you will need to do them yourself.</span></span>

<span data-ttu-id="ced23-112">Dies umfasst zwei Schritte:</span><span class="sxs-lookup"><span data-stu-id="ced23-112">The process for this involves two steps:</span></span>

1. <span data-ttu-id="ced23-113">Erstellen Sie eine Netzwerksicherheitsgruppe.</span><span class="sxs-lookup"><span data-stu-id="ced23-113">Create a Network Security Group.</span></span>
2. <span data-ttu-id="ced23-114">Erstellen Sie eine eingehende Regel, die Datenverkehr für eine aktive FTP-Unterstützung auf den Ports 20 und 21 zulässt.</span><span class="sxs-lookup"><span data-stu-id="ced23-114">Create an inbound rule allowing traffic on port 20 and 21 for active FTP support.</span></span>

### <a name="what-is-a-network-security-group"></a><span data-ttu-id="ced23-115">Was ist eine Netzwerksicherheitsgruppe?</span><span class="sxs-lookup"><span data-stu-id="ced23-115">What is a Network Security Group?</span></span>

<span data-ttu-id="ced23-116">Virtuelle Netzwerke (VNets) stellen die Grundlage des Azure-Netzwerkmodells dar und stellen Isolation und Schutz bereit.</span><span class="sxs-lookup"><span data-stu-id="ced23-116">Virtual networks (VNets) are the foundation of the Azure networking model and provide isolation and protection.</span></span> <span data-ttu-id="ced23-117">Netzwerksicherheitsgruppen werden in erster Linie dazu verwendet, Regeln zum Netzwerkdatenverkehr auf Netzwerkebene zu erzwingen und zu überwachen.</span><span class="sxs-lookup"><span data-stu-id="ced23-117">Network Security Groups (NSGs) are the main tool you use to enforce and control network traffic rules at the networking level.</span></span> <span data-ttu-id="ced23-118">Sie stellen eine optionale Sicherheitsebene dar, die eine Firewall für Software darstellt, indem sie eingehenden und ausgehenden Datenverkehr auf dem VNet bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="ced23-118">NSGs are an optional security layer that provides a software firewall by filtering inbound and outbound traffic on the VNet.</span></span> 

<span data-ttu-id="ced23-119">Außerdem können sie einer Netzwerkschnittstelle (für hostspezifische Regeln), einem Subnetz im VNet (das für mehrere Ressourcen verwendbar ist) oder beiden zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="ced23-119">Security groups can be associated to a network interface (for per-host rules), a subnet in the virtual network (to apply to multiple resources), or both levels.</span></span> 

#### <a name="security-group-rules"></a><span data-ttu-id="ced23-120">Regeln für Sicherheitsgruppen</span><span class="sxs-lookup"><span data-stu-id="ced23-120">Security group rules</span></span>

<span data-ttu-id="ced23-121">Netzwerksicherheitsgruppen verwenden _Regeln_, um Datenverkehr im Netzwerk zuzulassen oder zu blockieren.</span><span class="sxs-lookup"><span data-stu-id="ced23-121">NGSs use _rules_ to allow or deny traffic moving through the network.</span></span> <span data-ttu-id="ced23-122">Jede Regel erkennt die Quell- und Zieladresse (oder den Bereich), das Protokoll, den Port (oder den Bereich), die Richtung (eingehend oder ausgehend) sowie eine numerische Priorität und stellt fest, ob Datenverkehr, der der Regel entspricht, zugelassen oder blockiert wird.</span><span class="sxs-lookup"><span data-stu-id="ced23-122">Each rule identifies the source and destination address (or range), protocol, port (or range), direction (inbound or outbound), a numeric priority, and whether to allow or deny the traffic that matches the rule.</span></span>

![Regeln für Netzwerksicherheitsgruppen](../media/7-nsg-rules.png)

<span data-ttu-id="ced23-124">Jede Sicherheitsgruppe verfügt über mehrere Standardsicherheitsregeln, damit die oben beschriebenen Standardnetzwerkregeln angewendet werden können.</span><span class="sxs-lookup"><span data-stu-id="ced23-124">Each security group has a set of default security rules to apply the default network rules described above.</span></span> <span data-ttu-id="ced23-125">Diese Standardregeln können zwar nicht verändert, aber dafür _überschrieben_ werden.</span><span class="sxs-lookup"><span data-stu-id="ced23-125">These default rules cannot be modified, but _can_ be overridden.</span></span>

#### <a name="how-azure-uses-network-rules"></a><span data-ttu-id="ced23-126">So verwendet Azure Netzwerkregeln</span><span class="sxs-lookup"><span data-stu-id="ced23-126">How Azure uses network rules</span></span>

<span data-ttu-id="ced23-127">Für eingehenden Datenverkehr verarbeitet Azure erst die Sicherheitsgruppen, die dem Subnetz zugeordnet sind, und anschließend die Sicherheitsgruppen, die der Netzwerkschnittstelle zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="ced23-127">For inbound traffic, Azure processes the security group associated to the subnet, then the security group applied to the network interface.</span></span> <span data-ttu-id="ced23-128">Ausgehender Datenverkehr wird in umgekehrter Reihenfolge verarbeitet (zuerst die Netzwerkschnittstelle, gefolgt vom Subnetz).</span><span class="sxs-lookup"><span data-stu-id="ced23-128">Outbound traffic is processed in the opposite order (the network interface first, followed by the subnet).</span></span>

> [!WARNING]
> <span data-ttu-id="ced23-129">Beachten Sie, dass Sicherheitsgruppen auf beiden Ebenen optional sind.</span><span class="sxs-lookup"><span data-stu-id="ced23-129">Keep in mind that security groups are optional at both levels.</span></span> <span data-ttu-id="ced23-130">Wenn keine Sicherheitsgruppe verwendet wird, lässt Azure **sämtlichen Datenverkehr** zu.</span><span class="sxs-lookup"><span data-stu-id="ced23-130">If no security group is applied then **all traffic is allowed** by Azure.</span></span> <span data-ttu-id="ced23-131">Wenn die VM über eine öffentliche IP-Adresse verfügt, kann dies ein ernsthaftes Risiko darstellen, insbesondere wenn das Betriebssystem keine Firewall zur Verfügung stellt.</span><span class="sxs-lookup"><span data-stu-id="ced23-131">If the VM has a public IP, this could be a serious risk particularly if the OS doesn't provide some sort of firewall.</span></span>

<span data-ttu-id="ced23-132">Die Regeln werden je nach _Priorität_ bewertet, angefangen bei der Regel mit der **niedrigsten Priorität**.</span><span class="sxs-lookup"><span data-stu-id="ced23-132">The rules are evaluated in _priority-order_, starting with the **lowest priority** rule.</span></span> <span data-ttu-id="ced23-133">Ablehnungsregeln **beenden** die Auswertung immer.</span><span class="sxs-lookup"><span data-stu-id="ced23-133">Deny rules always **stop** the evaluation.</span></span> <span data-ttu-id="ced23-134">Wenn beispielsweise eine ausgehende Anforderung von einer Netzwerkschnittstellenregel blockiert wird, werden sämtliche Regeln, die auf das Subnetz angewendet werden, nicht mehr überprüft.</span><span class="sxs-lookup"><span data-stu-id="ced23-134">For example, if an outbound request is blocked by a network interface rule, any rules applied to the subnet will not be checked.</span></span> <span data-ttu-id="ced23-135">Damit die Sicherheitsgruppe Datenverkehr zulässt, muss dieser _alle_ angewendeten Gruppen durchlaufen.</span><span class="sxs-lookup"><span data-stu-id="ced23-135">In order for traffic to be allowed through the security group, it must pass through _all_ applied groups.</span></span>

<span data-ttu-id="ced23-136">Die letzte Regel ist immer eine **Alle Ablehnen**-Regel.</span><span class="sxs-lookup"><span data-stu-id="ced23-136">The last rule is always a **Deny All** rule.</span></span> <span data-ttu-id="ced23-137">Es handelt sich dabei um eine Standardregel, die sämtlichen Sicherheitsregeln für eingehenden und ausgehenden Datenverkehr mit einer Priorität von 65500 hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="ced23-137">This is a default rule added to every security group for both inbound and outbound traffic with a priority of 65500.</span></span> <span data-ttu-id="ced23-138">D.h., der Datenverkehr muss die Sicherheitsgruppe durchlaufen, und _Sie müssen über eine Zulassungsregel verfügen_, damit dieser nicht von der letzten Standardregel blockiert wird.</span><span class="sxs-lookup"><span data-stu-id="ced23-138">That means to have traffic pass through the security group _you must have an allow rule_ or it will be blocked by the default final rule.</span></span>

> [!NOTE]
> <span data-ttu-id="ced23-139">Bei SMTP (Port 25) handelt es sich um einen Sonderfall. Abhängig von Ihrer Abonnementstufe und dem Erstelldatum Ihres Kontos, wird SMTP-Datenverkehr möglicherweise blockiert.</span><span class="sxs-lookup"><span data-stu-id="ced23-139">SMTP (port 25) is a special case, depending on your subscription level and when your account was created, outbound SMTP traffic may be blocked.</span></span> <span data-ttu-id="ced23-140">Sie können einen Antrag auf Entfernen dieser Beschränkung stellen, wenn Sie dies geschäftlich begründen können.</span><span class="sxs-lookup"><span data-stu-id="ced23-140">You can make a request to remove this restriction with business justification.</span></span>

<span data-ttu-id="ced23-141">Nachfolgend erfahren Sie, wie Sie eine Sicherheitsgruppe für diese VM erstellen.</span><span class="sxs-lookup"><span data-stu-id="ced23-141">Since we didn't create a security group for this VM, let's do that and apply it.</span></span>

## <a name="creating-network-security-groups"></a><span data-ttu-id="ced23-142">Erstellen von Netzwerksicherheitsgruppen</span><span class="sxs-lookup"><span data-stu-id="ced23-142">Creating Network Security Groups</span></span>

<span data-ttu-id="ced23-143">Sicherheitsgruppen sind verwaltete Ressourcen, die Sie wie beinahe alle Azure-Elemente im Azure-Portal oder über Tools zur Skripterstellung auf Befehlszeilenebene erstellen können.</span><span class="sxs-lookup"><span data-stu-id="ced23-143">Security groups are managed resources like most everything in Azure, you can create them in the Azure portal or through command-line scripting tools.</span></span> <span data-ttu-id="ced23-144">Die Schwierigkeit besteht darin, die Regeln zu definieren.</span><span class="sxs-lookup"><span data-stu-id="ced23-144">The challenge is in defining the rules.</span></span> <span data-ttu-id="ced23-145">Nachfolgend wird erläutert, wie Sie neue Regeln erstellen können, um den Zugriff auf FTP zuzulassen.</span><span class="sxs-lookup"><span data-stu-id="ced23-145">Let's look at defining a new rule to allow FTP access.</span></span>