<span data-ttu-id="54b6d-101">In einer verteilten Anwendung müssen einige Nachrichten nur an eine Empfängerkomponente gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="54b6d-101">In a distributed application, some messages need to be spent to a single recipient component.</span></span> <span data-ttu-id="54b6d-102">Andere Nachrichten sind für mehr als ein Ziel bestimmt.</span><span class="sxs-lookup"><span data-stu-id="54b6d-102">Other messages need to reach more than one destination.</span></span>

<span data-ttu-id="54b6d-103">Hier wird beschrieben, was passiert, wenn ein Benutzer die Bestellung einer Pizza storniert.</span><span class="sxs-lookup"><span data-stu-id="54b6d-103">Let's discuss what happens when a user cancels a pizza order.</span></span> <span data-ttu-id="54b6d-104">Dieser Vorgang weicht etwas vom Aufgeben der ursprünglichen Bestellung ab.</span><span class="sxs-lookup"><span data-stu-id="54b6d-104">This is a little different than placing the initial order.</span></span> <span data-ttu-id="54b6d-105">In diesem Fall wollten wir warten, bis für die Bestellung die Verarbeitung der Zahlung abgeschlossen ist, bevor die Bestellung an die weiteren Schritte gesendet wird (z.B. den Zubereitungs-/Kochvorgang im Geschäft).</span><span class="sxs-lookup"><span data-stu-id="54b6d-105">In that case, we wanted to wait until the order cleared payment processing before sending the order on to other steps (like having it prepared and cooked at the local storefront).</span></span> <span data-ttu-id="54b6d-106">Für den Stornierungsvorgang benachrichtigen wir dagegen gleichzeitig das Geschäft *und* die Stelle, von der die Zahlung verarbeitet wird.</span><span class="sxs-lookup"><span data-stu-id="54b6d-106">But for the cancel operation, we are going to notify both the storefront *and* the payment processor at the same time.</span></span> <span data-ttu-id="54b6d-107">Mit diesem Ansatz wird die Wahrscheinlichkeit verringert, dass wir Zutaten oder Lieferzeitaufwand vergeuden.</span><span class="sxs-lookup"><span data-stu-id="54b6d-107">This approach minimizes the chances that we waste ingredients or delivery driver time.</span></span>

<span data-ttu-id="54b6d-108">Wir verwenden ein Azure Service Bus-Thema, um es zu ermöglichen, dass mehrere Komponenten die gleiche Nachricht erhalten.</span><span class="sxs-lookup"><span data-stu-id="54b6d-108">To allow multiple components to receive the same message, we'll use an Azure Service Bus topic.</span></span>

## <a name="how-code-that-uses-topics-differs-from-queues"></a><span data-ttu-id="54b6d-109">Code mit Verwendung von Themen – Unterscheidung von Warteschlangen</span><span class="sxs-lookup"><span data-stu-id="54b6d-109">How code that uses topics differs from queues</span></span>

<span data-ttu-id="54b6d-110">Sie verwenden Themen, wenn Sie möchten, dass alle an das Thema gesendeten Nachrichten für alle am Abonnement beteiligten Komponenten zugestellt wird.</span><span class="sxs-lookup"><span data-stu-id="54b6d-110">If you want every message sent to the topic to be delivered to all subscribing components, you'll use topics.</span></span> <span data-ttu-id="54b6d-111">Das Schreiben von Code mit Verwendung von Themen unterscheidet sich von Warteschlangen.</span><span class="sxs-lookup"><span data-stu-id="54b6d-111">Writing code that uses topics is way to  queues.</span></span> <span data-ttu-id="54b6d-112">Sie verwenden das gleiche **Microsoft.Azure.ServiceBus**-NuGet-Paket, konfigurieren Verbindungszeichenfolgen und nutzen asynchrone Programmierungsmuster.</span><span class="sxs-lookup"><span data-stu-id="54b6d-112">You use the same **Microsoft.Azure.ServiceBus** NuGet package, configure connection strings, and use asynchronous programming patterns.</span></span>

<span data-ttu-id="54b6d-113">Anstelle der `QueueClient`-Klasse verwenden Sie aber die `TopicClient`-Klasse, um Nachrichten zu senden, und die `SubscriptionClient`-Klasse, um Nachrichten zu empfangen.</span><span class="sxs-lookup"><span data-stu-id="54b6d-113">However, you use the `TopicClient` class instead of the `QueueClient` class to send messages and the `SubscriptionClient` class to receive messages.</span></span>

## <a name="setting-filters-on-subscriptions"></a><span data-ttu-id="54b6d-114">Festlegen von Filtern für Abonnements</span><span class="sxs-lookup"><span data-stu-id="54b6d-114">Setting filters on subscriptions</span></span>

<span data-ttu-id="54b6d-115">Wenn Sie steuern möchten, welche an das Thema gesendeten Nachrichten an die jeweiligen Abonnements gesendet werden, können Sie für jedes Abonnement im Thema Filter festlegen.</span><span class="sxs-lookup"><span data-stu-id="54b6d-115">If you want to control which messages sent to the topic are delivered to which subscriptions, you can place filters on each subscription in the topic.</span></span> <span data-ttu-id="54b6d-116">In der Pizza-Anwendung werden in den Geschäften beispielsweise UWP-Anwendungen ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="54b6d-116">In the pizza application, for instance, our storefronts are running UWP applications.</span></span> <span data-ttu-id="54b6d-117">Jedes Geschäft kann das Thema „OrderCancellation“ abonnieren, aber nach seiner eigenen „StoreId“ filtern.</span><span class="sxs-lookup"><span data-stu-id="54b6d-117">Each store can subscribe to the "OrderCancellation" topic but filter for its own StoreId.</span></span> <span data-ttu-id="54b6d-118">Wir sparen Internetbandbreite, da keine unnötigen Nachrichten an weit entfernte Geschäftsstandorte gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="54b6d-118">We save internet bandwidth because we are not sending unnecessary messages to distant store locations.</span></span> <span data-ttu-id="54b6d-119">In der Zwischenzeit abonniert die Komponente für die Zahlungsverarbeitung unsere gesamten Stornierungsnachrichten.</span><span class="sxs-lookup"><span data-stu-id="54b6d-119">Meanwhile, the payment processing component subscribes to all our cancellation messages.</span></span>

<span data-ttu-id="54b6d-120">Drei Arten von Filtern sind möglich:</span><span class="sxs-lookup"><span data-stu-id="54b6d-120">Filters can be one of three types:</span></span>

- <span data-ttu-id="54b6d-121">**Boolesche Filter:**</span><span class="sxs-lookup"><span data-stu-id="54b6d-121">**Boolean Filters.**</span></span> <span data-ttu-id="54b6d-122">Mit `TrueFilter` wird sichergestellt, dass alle an das Thema gesendeten Nachrichten für das aktuelle Abonnement zugestellt werden.</span><span class="sxs-lookup"><span data-stu-id="54b6d-122">The `TrueFilter` ensures that all messages sent to the topic are delivered to the current subscription.</span></span> <span data-ttu-id="54b6d-123">Mit `FalseFilter` wird sichergestellt, dass keine Nachricht für das aktuelle Abonnement zugestellt wird. (Hierdurch wird das Abonnement praktisch blockiert bzw. ausgeschaltet.)</span><span class="sxs-lookup"><span data-stu-id="54b6d-123">The `FalseFilter` ensures that none of the messages are delivered to the current subscription (This effectively blocks or switches off the subscription).</span></span>
- <span data-ttu-id="54b6d-124">**SQL-Filter:**</span><span class="sxs-lookup"><span data-stu-id="54b6d-124">**SQL Filters.**</span></span> <span data-ttu-id="54b6d-125">Mit einem SQL-Filter wird eine Bedingung angegeben, indem die gleiche Syntax wie in der `WHERE`-Klausel einer SQL-Abfrage verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="54b6d-125">A SQL filter specifies a condition by using the same syntax as a `WHERE` clause in a SQL query.</span></span> <span data-ttu-id="54b6d-126">Nur Nachrichten, für die beim Auswerten für dieses Abonnement `True` zurückgegeben wird, werden für die Abonnenten zugestellt.</span><span class="sxs-lookup"><span data-stu-id="54b6d-126">Only messages that return `True`, when evaluated against this subscription, will be delivered to the subscribers.</span></span>
- <span data-ttu-id="54b6d-127">**Korrelationsfilter:**</span><span class="sxs-lookup"><span data-stu-id="54b6d-127">**Correlation Filters.**</span></span> <span data-ttu-id="54b6d-128">Ein Korrelationsfilter enthält einen Satz mit Bedingungen, die mit den Eigenschaften jeder Nachricht abgeglichen werden.</span><span class="sxs-lookup"><span data-stu-id="54b6d-128">A correlation filter holds a set of conditions that are matched against the properties of each message.</span></span> <span data-ttu-id="54b6d-129">Wenn die Eigenschaft im Filter und die Eigenschaft der Nachricht über den gleichen Wert verfügen, ergibt sich eine Übereinstimmung.</span><span class="sxs-lookup"><span data-stu-id="54b6d-129">If the property in the filter and the property on the message have the same value, it is considered a match.</span></span>

<span data-ttu-id="54b6d-130">Für unseren StoreId-Filter *können* wir einen SQL-Filter verwenden.</span><span class="sxs-lookup"><span data-stu-id="54b6d-130">For our StoreId filter, we *could* use a SQL filter.</span></span> <span data-ttu-id="54b6d-131">Dies sind die flexibelsten Filter, die aber auch mit dem höchsten Rechenaufwand verbunden sind und zu einer Verlangsamung des Service Bus-Durchsatzes führen können.</span><span class="sxs-lookup"><span data-stu-id="54b6d-131">Those are the most flexible, but also the most computationally expensive and could slow down our service bus throughput.</span></span> <span data-ttu-id="54b6d-132">In diesem Fall wählen wir stattdessen einen Korrelationsfilter.</span><span class="sxs-lookup"><span data-stu-id="54b6d-132">In this case we choose a correlation filter instead.</span></span> 

## <a name="topicclient-example"></a><span data-ttu-id="54b6d-133">TopicClient-Beispiel</span><span class="sxs-lookup"><span data-stu-id="54b6d-133">TopicClient example</span></span>

<span data-ttu-id="54b6d-134">Für alle Sende- oder Empfangskomponenten sollten Sie die folgenden using-Anweisungen allen Codedateien hinzufügen, mit denen ein Service Bus-Thema aufgerufen wird:</span><span class="sxs-lookup"><span data-stu-id="54b6d-134">In any sending or receiving component, you should add the following using statements to any code file that calls a Service Bus topic:</span></span>

    ```C#
    using System.Threading;
    using System.Threading.Tasks;
    using Microsoft.Azure.ServiceBus;
    ```

<span data-ttu-id="54b6d-135">Beginnen Sie das Senden einer Nachricht, indem Sie ein neues `TopicClient`-Objekt erstellen und dafür die Verbindungszeichenfolge und den Namen des Themas übergeben:</span><span class="sxs-lookup"><span data-stu-id="54b6d-135">To send a message, start by creating a new `TopicClient` object and pass it the connection string and the name of the topic:</span></span>

    ```C#
    topicClient = new TopicClient(TextAppConnectionString, "GroupMessageTopic");
    ```

<span data-ttu-id="54b6d-136">Sie können eine Nachricht an das Thema senden, indem Sie die `TopicClient.SendAsync()`-Methode aufrufen und die Nachricht übergeben.</span><span class="sxs-lookup"><span data-stu-id="54b6d-136">You can send a message to the topic, by calling the `TopicClient.SendAsync()` method and passing the message.</span></span> <span data-ttu-id="54b6d-137">Wie bei Warteschlangen auch, muss die Nachricht das Format einer Zeichenfolge mit UTF-8-Codierung aufweisen:</span><span class="sxs-lookup"><span data-stu-id="54b6d-137">As for queues, the message must be in the form of a UTF8 encoded string:</span></span>

    ```C#
    string message = "Cancel! I can't believe you use canned mushrooms!";
    var encodedMessage = new Message(Encoding.UTF8.GetBytes(message));
    await topicClient.SendAsync(encodedMessage);
    ```

<span data-ttu-id="54b6d-138">Um Nachrichten zu erhalten, müssen Sie ein `SubscriptionClient`-Objekt erstellen (kein `TopicClient`-Objekt) und dafür die Verbindungszeichenfolge, den Namen des Themas **und** den Namen des Abonnements übergeben:</span><span class="sxs-lookup"><span data-stu-id="54b6d-138">To receive messages, you must create a `SubscriptionClient` object, not a `TopicClient` object, and pass it the connection string, the name of the topic, **and** the name of the subscription:</span></span>

    ```C#
    subscriptionClient = new SubscriptionClient(ServiceBusConnectionString, "GroupMessageTopic", "NorthAmerica");
    ```

<span data-ttu-id="54b6d-139">Registrieren Sie anschließend einen Nachrichtenhandler. Dies ist die asynchrone Methode in Ihrem Code, mit der die abgerufene Nachricht verarbeitet wird.</span><span class="sxs-lookup"><span data-stu-id="54b6d-139">Then register a message handler - this is the asynchronous method in your code that processes the retrieved message.</span></span>

    ```C#
    subscriptionClient.RegisterMessageHandler(MessageHandler, messageHandlerOptions);
    ```

<span data-ttu-id="54b6d-140">Rufen Sie im Nachrichtenhandler die `SubscriptionClient.CompleteAsync()`-Methode auf, um die Nachricht aus der Warteschlange zu entfernen:</span><span class="sxs-lookup"><span data-stu-id="54b6d-140">Within the message handler, call the `SubscriptionClient.CompleteAsync()` method to remove the message from the queue:</span></span>

    ```C#
    await subscriptionClient.CompleteAsync(message.SystemProperties.LockToken);
    ```