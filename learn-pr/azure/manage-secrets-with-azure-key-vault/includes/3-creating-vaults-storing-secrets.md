## <a name="creating-key-vaults-for-your-applications"></a><span data-ttu-id="fbd69-101">Erstellen von Key Vaults für Ihre Anwendungen</span><span class="sxs-lookup"><span data-stu-id="fbd69-101">Creating Key Vaults for your applications</span></span>

<span data-ttu-id="fbd69-102">Es empfiehlt sich, für jede Bereitstellungsumgebung (Entwicklung, Test und Produktion) Ihrer verschiedenen Anwendungen einen separaten Tresor bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="fbd69-102">Good practice is to create a separate vault for each deployment environment of each of your applications, such as development, test, and production.</span></span> <span data-ttu-id="fbd69-103">Es ist zwar möglich, Tresore zum plattformübergreifenden Freigeben von Geheimnissen zu verwenden, allerdings nehmen die Auswirkungen eines Angriffs, bei dem Lesezugriff auf einen Tresor erlangt wurde, mit der Anzahl der Geheimnisse im Tresor zu.</span><span class="sxs-lookup"><span data-stu-id="fbd69-103">It's possible to use vaults to share secrets across multiple apps, but the impact of an attacker gaining read access to a vault increases with the number of secrets in the vault.</span></span>

> [!TIP]
> <span data-ttu-id="fbd69-104">Wenn Sie in verschiedenen Umgebungen einer Anwendung dieselben Namen für Geheimnisse verwenden, ist die Tresor-URL die einzige umgebungsspezifische Konfiguration, die in Ihrer Anwendung geändert werden muss.</span><span class="sxs-lookup"><span data-stu-id="fbd69-104">If you use the same names for secrets across different environments for an application, the only environment-specific configuration that has to change in your app is the vault URL.</span></span>

<span data-ttu-id="fbd69-105">Das Erstellen eines Tresors erfordert keine anfängliche Konfiguration.</span><span class="sxs-lookup"><span data-stu-id="fbd69-105">Creating a vault requires no initial configuration.</span></span> <span data-ttu-id="fbd69-106">Ihrer Benutzeridentität werden automatisch alle Berechtigungen für die Verwaltung von Geheimnissen erteilt, und Sie können sofort mit dem Hinzufügen von Geheimnissen beginnen.</span><span class="sxs-lookup"><span data-stu-id="fbd69-106">Your user identity is automatically granted the full set of secret management permissions and you can start adding secrets immediately.</span></span> <span data-ttu-id="fbd69-107">Sobald Sie einen Tresor haben, können Sie Geheimnisse über jede Azure-Verwaltungsschnittstelle hinzufügen und verwalten, einschließlich Azure-Portal, Azure CLI und Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="fbd69-107">Once you have a vault, adding and managing secrets can be done from any Azure administrative interface, including the Azure portal, the Azure CLI, and Azure PowerShell.</span></span> <span data-ttu-id="fbd69-108">Wenn Sie Ihre Anwendung für die Verwendung des Tresors einrichten, müssen Sie ihr die ordnungsgemäßen Berechtigungen zuweisen, womit wir uns in der nächsten Einheit beschäftigen.</span><span class="sxs-lookup"><span data-stu-id="fbd69-108">When you set up your application to use the vault, you'll need to assign the correct permissions to it; we'll see that in the next unit.</span></span>

## <a name="vault-authentication-and-permissions"></a><span data-ttu-id="fbd69-109">Tresorauthentifizierung und -berechtigungen</span><span class="sxs-lookup"><span data-stu-id="fbd69-109">Vault authentication and permissions</span></span>

<span data-ttu-id="fbd69-110">Die Azure Key Vault-API verwendet Azure Active Directory zum Authentifizieren von Benutzern und Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="fbd69-110">Azure Key Vault's API uses Azure Active Directory to authenticate users and applications.</span></span> <span data-ttu-id="fbd69-111">Tresorzugriffsrichtlinien basieren auf *Aktionen* und gelten für einen gesamten Tresor.</span><span class="sxs-lookup"><span data-stu-id="fbd69-111">Vault access policies are based on *actions*, and are applied across an entire vault.</span></span> <span data-ttu-id="fbd69-112">Beispiel: Eine Anwendung mit den Berechtigungen **Get (Abrufen)** (Werte von Geheimnissen lesen), **List (Auflisten)** (Namen aller Geheimnisse auflisten) und **Set (Festlegen)** (Werte von Geheimnissen erstellen oder aktualisieren) kann Geheimnisse erstellen, alle Namen von Geheimnissen auflisten und alle Werte von Geheimnissen in diesem Tresor abrufen und festlegen.</span><span class="sxs-lookup"><span data-stu-id="fbd69-112">For example, an application with **Get** (read secret values), **List** (list names of all secrets), and **Set** (create or update secret values) permissions to a vault is able to create secrets, list all secret names, and get and set all secret values in that vault.</span></span>

<span data-ttu-id="fbd69-113">*Alle* Aktionen, die für einen Tresor erfolgen, erfordern eine Authentifizierung und Autorisierung. Ein anonymer Zugriff ist nicht möglich.</span><span class="sxs-lookup"><span data-stu-id="fbd69-113">*All* actions performed on a vault require authentication and authorization &mdash; there is no way to grant any kind of anonymous access.</span></span>

> [!TIP]
> <span data-ttu-id="fbd69-114">Wenn Sie Entwicklern und Anwendungen Zugriff auf den Tresor gewähren, sollten Sie nur die erforderlichen Mindestberechtigungen gewähren.</span><span class="sxs-lookup"><span data-stu-id="fbd69-114">When granting vault access to developers and apps, grant only the minimum set of permissions needed.</span></span> <span data-ttu-id="fbd69-115">Berechtigungsbeschränkungen helfen, Unregelmäßigkeiten durch Codefehler zu vermeiden und die Auswirkungen von gestohlenen Anmeldeinformationen oder bösartigem Code in Ihrer Anwendung zu reduzieren.</span><span class="sxs-lookup"><span data-stu-id="fbd69-115">Permissions restrictions help avoid accidents caused by code bugs and reduce the impact of stolen credentials or malicious code injected into your app.</span></span>

<span data-ttu-id="fbd69-116">Entwickler benötigen für einen Entwicklungsumgebungstresor normalerweise nur die Berechtigungen **Get** und **List**.</span><span class="sxs-lookup"><span data-stu-id="fbd69-116">Developers will usually only need **Get** and **List** permissions to a development-environment vault.</span></span> <span data-ttu-id="fbd69-117">Ein Chef- oder leitender Entwickler benötigt Vollzugriff auf den Tresor, um bei Bedarf Geheimnisse zu ändern und hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="fbd69-117">A lead or senior developer will need full permissions to the vault to change and add secrets when necessary.</span></span> <span data-ttu-id="fbd69-118">Vollzugriffsberechtigungen für Tresore in Produktionsumgebungen sind in der Regel für leitende Mitarbeiter reserviert.</span><span class="sxs-lookup"><span data-stu-id="fbd69-118">Full permissions to production-environment vaults are typically reserved for senior operations staff.</span></span>

<span data-ttu-id="fbd69-119">Für Apps sind in der Regel nur **Get**-Berechtigungen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="fbd69-119">For apps, typically only **Get** permissions are required.</span></span> <span data-ttu-id="fbd69-120">Einige Anwendungen können **List** erfordern, je nachdem, wie die App implementiert ist.</span><span class="sxs-lookup"><span data-stu-id="fbd69-120">Some apps may require **List** depending on the way the app is implemented.</span></span> <span data-ttu-id="fbd69-121">Die App, die wir in der Übung dieses Moduls implementieren werden, benötigt die Berechtigung **List** aufgrund der Technik, mit der sie Geheimnisse aus dem Tresor liest.</span><span class="sxs-lookup"><span data-stu-id="fbd69-121">The app we'll implement in this module's exercise requires the **List** permission because of the technique it uses to read secrets from the vault.</span></span>

## <a name="exercise"></a><span data-ttu-id="fbd69-122">Übung</span><span class="sxs-lookup"><span data-stu-id="fbd69-122">Exercise</span></span>

<span data-ttu-id="fbd69-123">Angesichts der ganzen Schwierigkeiten, die das Unternehmen mit Anwendungsgeheimnissen hatte, hat die Geschäftsleitung Sie gebeten, eine kleine Einstiegs-App zu erstellen, um die anderen Entwickler auf den richtigen Weg zu bringen.</span><span class="sxs-lookup"><span data-stu-id="fbd69-123">Given all the trouble the company's been having with application secrets, management has asked you to create a small starter app to set the other developers on the right path.</span></span> <span data-ttu-id="fbd69-124">Die App muss bewährte Methoden veranschaulichen, wie Geheimnisse so einfach und sicher wie möglich verwaltet werden können.</span><span class="sxs-lookup"><span data-stu-id="fbd69-124">The app needs to demonstrate best practices for managing secrets as simply and securely as possible.</span></span>

<span data-ttu-id="fbd69-125">Als Erstes erstellen Sie einen Tresor, in dem Sie ein Geheimnis speichern.</span><span class="sxs-lookup"><span data-stu-id="fbd69-125">To start, you'll create a vault and store one secret.</span></span>

### <a name="create-a-resource-group"></a><span data-ttu-id="fbd69-126">Erstellen einer Ressourcengruppe</span><span class="sxs-lookup"><span data-stu-id="fbd69-126">Create a resource group</span></span>
<!---TODO: Update for sandbox?--->

<span data-ttu-id="fbd69-127">Erstellen Sie für alle Ressourcen in dieser Einheit eine Ressourcengruppe namens `keyvault-exercise-group`.</span><span class="sxs-lookup"><span data-stu-id="fbd69-127">Create a resource group called `keyvault-exercise-group` for all of the resources In this unit.</span></span> <span data-ttu-id="fbd69-128">Am Ende dieses Moduls löschen wir diese Ressourcengruppe, um alles auf einmal zu bereinigen.</span><span class="sxs-lookup"><span data-stu-id="fbd69-128">At the end of this module, we'll be deleting this resource group to cleanup everything at once.</span></span> <span data-ttu-id="fbd69-129">Wir verwenden `eastus` als Speicherort für alles in dieser Einheit.</span><span class="sxs-lookup"><span data-stu-id="fbd69-129">We'll use `eastus` as the location for everything In this unit.</span></span>

<span data-ttu-id="fbd69-130">Verwenden Sie das Azure Cloud Shell-Terminalfenster auf der rechten Seite, um den folgenden Azure CLI-Befehl auszuführen.</span><span class="sxs-lookup"><span data-stu-id="fbd69-130">Use the Azure Cloud Shell terminal on the right to run the following Azure CLI command.</span></span> <span data-ttu-id="fbd69-131">Dadurch wird die Ressourcengruppe in Ihrem Abonnement erstellt.</span><span class="sxs-lookup"><span data-stu-id="fbd69-131">This will create the resource group in your subscription.</span></span>

```azurecli
az group create --name keyvault-exercise-group --location eastus
```

### <a name="create-the-vault-and-store-the-secret-in-it"></a><span data-ttu-id="fbd69-132">Erstellen Sie den Tresor, und speichern sie das Geheimnis darin.</span><span class="sxs-lookup"><span data-stu-id="fbd69-132">Create the vault and store the secret in it</span></span>

<span data-ttu-id="fbd69-133">Als Nächstes erstellen wir den Tresor und speichern unser Geheimnis darin.</span><span class="sxs-lookup"><span data-stu-id="fbd69-133">Next, we'll create the vault and store our secret in it.</span></span>

<span data-ttu-id="fbd69-134">**Key Vault-Namen müssen global eindeutig sein. Daher Sie müssen einen eindeutigen Namen auswählen**.</span><span class="sxs-lookup"><span data-stu-id="fbd69-134">**Key Vault names must be globally unique, so you'll need to pick a unique name**.</span></span> <span data-ttu-id="fbd69-135">Tresornamen müssen 3-24 Zeichen lang sein und dürfen nur alphanumerische Zeichen und Bindestriche enthalten.</span><span class="sxs-lookup"><span data-stu-id="fbd69-135">Vault names must be 3-24 characters long and contain only alphanumeric characters and dashes.</span></span>

```azurecli
az keyvault create --name <your-unique-vault-name> --resource-group keyvault-exercise-group --location eastus
```

<span data-ttu-id="fbd69-136">Nach Abschluss des Vorgangs sehen Sie die JSON-Ausgabe mit einer Beschreibung des neuen Tresors.</span><span class="sxs-lookup"><span data-stu-id="fbd69-136">When it finishes, you'll see JSON output describing the new vault.</span></span>

<span data-ttu-id="fbd69-137">Fügen Sie nun das Geheimnis hinzu. Unser Geheimnis erhält den Namen **SecretPassword** mit dem Wert **Reindeer_flotilla**.</span><span class="sxs-lookup"><span data-stu-id="fbd69-137">Now add the secret: our secret will be named **SecretPassword** with a value of **reindeer_flotilla**.</span></span>

```azurecli
az keyvault secret set --name SecretPassword --value reindeer_flotilla --vault-name <your-unique-vault-name>
```

<span data-ttu-id="fbd69-138">Notieren Sie sich den Tresornamen, da Sie ihn bald wieder benötigen.</span><span class="sxs-lookup"><span data-stu-id="fbd69-138">Make a note of the vault name &mdash; you'll be needing it again soon.</span></span>

<span data-ttu-id="fbd69-139">Wir schreiben in Kürze den Code für unsere Anwendung. Aber zuerst müssen wir ein wenig darüber lernen, wie sich unsere App bei einem Tresor authentifiziert.</span><span class="sxs-lookup"><span data-stu-id="fbd69-139">We'll write the code for our application shortly, but first we need to learn a little bit about how our app is going to authenticate to a vault.</span></span>