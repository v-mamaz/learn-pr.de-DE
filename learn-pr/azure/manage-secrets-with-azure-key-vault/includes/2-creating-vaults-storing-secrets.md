## <a name="creating-key-vaults-for-your-applications"></a><span data-ttu-id="d490e-101">Erstellen von Key Vault-Instanzen für Ihre Anwendungen</span><span class="sxs-lookup"><span data-stu-id="d490e-101">Creating Key Vaults for your applications</span></span>

<span data-ttu-id="d490e-102">Bewährte Methode ist jede Anwendung einen separaten Tresor für jede bereitstellungsumgebung gewähren, die Sie, z. B. Entwicklung, Test und Produktion verwenden.</span><span class="sxs-lookup"><span data-stu-id="d490e-102">Good practice is to give each application a separate vault for each deployment environment you use, such as development, test and production.</span></span> <span data-ttu-id="d490e-103">Es möglicherweise sinnvoll, die Geheimnisse in apps gemeinsam nutzen, aber die Auswirkungen von ein Angreifer erhält Lesezugriff auf einen Tresor erhöht wird, mit der Anzahl von Geheimnissen aus dem Tresor.</span><span class="sxs-lookup"><span data-stu-id="d490e-103">It may be convenient to share secrets across apps, but the impact of an attacker gaining read access to a vault increases with the number of secrets in the vault.</span></span>

> [!TIP]
> <span data-ttu-id="d490e-104">Wenn Sie die gleichen Namen für den geheimen Schlüssel für verschiedene Umgebungen verwenden, ist die nur bestimmte-Konfiguration, die Änderungen in Ihrer app an die schlüsseltresor-URL an.</span><span class="sxs-lookup"><span data-stu-id="d490e-104">If you use the same names for secrets across different environments, the only environment-specific configuration that has to change in your app is the vault URL.</span></span>

<span data-ttu-id="d490e-105">Erstellen eines Tresors erfordert keine anfängliche Konfiguration.</span><span class="sxs-lookup"><span data-stu-id="d490e-105">Creating a vault requires no initial configuration.</span></span> <span data-ttu-id="d490e-106">Ihre Benutzer-ID wird automatisch erteilt sämtliche Berechtigungen der Verwaltung von Geheimnissen ein, und Sie beginnen, geheime Schlüssel sofort hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="d490e-106">Your user identity is automatically granted the full set of secret management permissions and you can start adding secrets immediately.</span></span> <span data-ttu-id="d490e-107">Nachdem Sie einen Tresor verfügen, können hinzufügen und Verwalten von Geheimnissen aus jeder Azure Verwaltungsoberfläche, einschließlich der im Portal der Azure-Befehlszeilenschnittstelle und Azure PowerShell erfolgen.</span><span class="sxs-lookup"><span data-stu-id="d490e-107">Once you have a vault, adding and managing secrets can be done from any Azure administrative interface, including the portal, the Azure CLI and Azure PowerShell.</span></span> <span data-ttu-id="d490e-108">Wenn Sie Ihre Anwendung zur Verwendung des Tresors eingerichtet haben, müssen Sie die richtigen Berechtigungen zuweisen; Wir sehen, die in der nächsten Einheit.</span><span class="sxs-lookup"><span data-stu-id="d490e-108">When you set up your application to use the vault, you'll need to assign the correct permissions to it; we'll see that in the next unit.</span></span>

## <a name="vault-authentication-and-permissions"></a><span data-ttu-id="d490e-109">Tresor-Authentifizierung und Berechtigungen</span><span class="sxs-lookup"><span data-stu-id="d490e-109">Vault authentication and permissions</span></span>

<span data-ttu-id="d490e-110">Key Vault API verwendet Azure Active Directory zum Authentifizieren von Benutzern und Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="d490e-110">Key Vault's API uses Azure Active Directory to authenticate users and applications.</span></span> <span data-ttu-id="d490e-111">Schlüsseltresor-Zugriffsrichtlinien basieren auf *Aktionen*, und für einen gesamten Tresor angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="d490e-111">Vault access policies are based on *actions*, and are applied across an entire vault.</span></span> <span data-ttu-id="d490e-112">Z. B. eine Anwendung mit **erhalten** (Lesen geheime Werte), **Liste** (Auflisten der Namen aller Geheimnisse), und **festgelegt** (erstellen oder aktualisieren Sie geheime Werte) Berechtigungen für einen Tresor kann. Listen Sie alle geheimen Namen, um geheime Schlüssel zu erstellen, abrufen Sie und legen Sie alle geheime Werte in diesem Tresor.</span><span class="sxs-lookup"><span data-stu-id="d490e-112">For example, an application with **Get** (read secret values), **List** (list names of all secrets), and **Set** (create or update secret values) permissions to a vault is able to create secrets, list all secret names, and get and set all secret values in that vault.</span></span>

<span data-ttu-id="d490e-113">*Alle* Aktionen für einen Tresor erfordern eine Authentifizierung und Autorisierung &mdash; besteht keine Möglichkeit, um jegliche Art von anonymen Zugriff zu gewähren.</span><span class="sxs-lookup"><span data-stu-id="d490e-113">*All* actions performed on a vault require authentication and authorization &mdash; there is no way to grant any kind of anonymous access.</span></span>

> [!TIP]
> <span data-ttu-id="d490e-114">Wenn Vault-Zugriff für Entwickler und apps zu gewähren, erteilen Sie nur den Minimalsatz an Berechtigungen, die erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="d490e-114">When granting vault access to developers and apps, grant only the minimum set of permissions needed.</span></span> <span data-ttu-id="d490e-115">Einschränkungen der Berechtigungen helfen, vermeiden von Störungen, die durch Fehler im Code verursacht, und reduzieren die Auswirkungen von gestohlenen Anmeldeinformationen oder bösartigen Code in Ihrer app eingefügt.</span><span class="sxs-lookup"><span data-stu-id="d490e-115">Permissions restrictions help avoid accidents caused by code bugs and reduce the impact of stolen credentials or malicious code injected into your app.</span></span>

<span data-ttu-id="d490e-116">Entwickler werden in der Regel brauchen nur noch **erhalten** und **Liste** Berechtigungen für eine Entwicklungsumgebung Tresor.</span><span class="sxs-lookup"><span data-stu-id="d490e-116">Developers will usually only need **Get** and **List** permissions to a development-environment vault.</span></span> <span data-ttu-id="d490e-117">Einen Lead oder leitender Entwickler benötigen Vollzugriff auf den Tresor ändern und Hinzufügen von Geheimnissen, die bei Bedarf.</span><span class="sxs-lookup"><span data-stu-id="d490e-117">A lead or senior developer will need full permissions to the vault to change and add secrets when necessary.</span></span> <span data-ttu-id="d490e-118">Vollzugriff auf die produktionsumgebung Tresore sind in der Regel für leitende Mitarbeiter reserviert.</span><span class="sxs-lookup"><span data-stu-id="d490e-118">Full permissions to production-environment vaults are typically reserved for senior operations staff.</span></span>

<span data-ttu-id="d490e-119">Für apps in der Regel nur **erhalten** Berechtigungen sind erforderlich.</span><span class="sxs-lookup"><span data-stu-id="d490e-119">For apps, typically only **Get** permissions are required.</span></span> <span data-ttu-id="d490e-120">Einige apps erfordern **Liste** je nachdem, wie die app implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="d490e-120">Some apps may require **List** depending on the way the app is implemented.</span></span> <span data-ttu-id="d490e-121">Die app, die wir in diesem Modul des Übung implementieren erfordert die Berechtigung zum Auflisten, aufgrund der Technik, die zum Lesen von Geheimnissen aus dem Tresor verwendet.</span><span class="sxs-lookup"><span data-stu-id="d490e-121">The app we'll implement in this module's exercise requires the List permission because of the technique it uses to read secrets from the vault.</span></span>

# <a name="exercise"></a><span data-ttu-id="d490e-122">Übung</span><span class="sxs-lookup"><span data-stu-id="d490e-122">Exercise</span></span>

<span data-ttu-id="d490e-123">Wenn alle Probleme, die das Unternehmen mit Geheimnissen aus Anwendungen wurden die, hat Management Sie zum Erstellen einer kleinen Starter-app zum Festlegen von anderen Entwickler auf dem richtigen Weg gebeten.</span><span class="sxs-lookup"><span data-stu-id="d490e-123">Given all the trouble the company's been having with application secrets, management has asked you to create a small starter app to set the other developers on the right path.</span></span> <span data-ttu-id="d490e-124">Die app muss sich um bewährte Methoden für die Verwaltung geheimer Schlüssel als einfach und sicher wie möglich zu veranschaulichen.</span><span class="sxs-lookup"><span data-stu-id="d490e-124">The app needs to demonstrate best practices for managing secrets as simply and securely as possible.</span></span>

<span data-ttu-id="d490e-125">Um Sie zu starten. erstellen Sie einen Tresor und ein Geheimnis zu speichern.</span><span class="sxs-lookup"><span data-stu-id="d490e-125">To start you'll create a vault and store one secret.</span></span>

### <a name="create-a-resource-group"></a><span data-ttu-id="d490e-126">Erstellen einer Ressourcengruppe</span><span class="sxs-lookup"><span data-stu-id="d490e-126">Create a resource group</span></span>

<span data-ttu-id="d490e-127">Erstellen Sie eine Ressourcengruppe namens `keyvault-exercise-group` für alle Ressourcen in dieser Übung.</span><span class="sxs-lookup"><span data-stu-id="d490e-127">Create a resource group called `keyvault-exercise-group` for all of the resources in this exercise.</span></span> <span data-ttu-id="d490e-128">Am Ende dieses Modul werden wir diese Ressourcengruppe auf, um alles auf einmal zu bereinigen, werden gelöscht.</span><span class="sxs-lookup"><span data-stu-id="d490e-128">At the end of this module, we'll be deleting this resource group to clean up everything at once.</span></span> <span data-ttu-id="d490e-129">Wir verwenden `eastus` als Speicherort für alles, was in dieser Übung.</span><span class="sxs-lookup"><span data-stu-id="d490e-129">We'll use `eastus` as the location for everything in this exercise.</span></span>

<span data-ttu-id="d490e-130">Verwenden Sie die Cloud Shell-Terminal auf der rechten Seite, um den folgenden Azure CLI-Befehl ausführen.</span><span class="sxs-lookup"><span data-stu-id="d490e-130">Use the Cloud Shell terminal on the right to run the following Azure CLI command.</span></span> <span data-ttu-id="d490e-131">Dadurch wird die Ressourcengruppe in Ihrem Abonnement erstellt.</span><span class="sxs-lookup"><span data-stu-id="d490e-131">This will create the resource group in your subscription.</span></span>

```azurecli
az group create --name keyvault-exercise-group --location eastus
```

### <a name="create-the-vault-and-store-the-secret-in-it"></a><span data-ttu-id="d490e-132">Erstellen Sie den Tresor, und speichern sie den geheimen Schlüssel</span><span class="sxs-lookup"><span data-stu-id="d490e-132">Create the vault and store the secret in it</span></span>

<span data-ttu-id="d490e-133">Als Nächstes, wir erstellen den Tresor und geheimen Schlüssel in der sie speichern.</span><span class="sxs-lookup"><span data-stu-id="d490e-133">Next, we'll create the vault and store our secret in it.</span></span>

<span data-ttu-id="d490e-134">**Key Vault-Namen müssen global eindeutig sein, daher Sie einen eindeutigen Namen auswählen müssen**.</span><span class="sxs-lookup"><span data-stu-id="d490e-134">**Key Vault names must be globally unique, so you'll need to pick a unique name**.</span></span> <span data-ttu-id="d490e-135">Tresornamen müssen 3 bis 24 Zeichen lang sein und darf nur alphanumerische Zeichen und Bindestriche enthalten.</span><span class="sxs-lookup"><span data-stu-id="d490e-135">Vault names must be 3-24 characters long and contain only alphanumerics and dashes.</span></span>

```azurecli
az keyvault create --name <your-unique-vault-name> --resource-group keyvault-exercise-group --location eastus
```

<span data-ttu-id="d490e-136">Wenn sie abgeschlossen ist, sehen Sie die JSON-Ausgabe, die den neuen Tresor beschreibt.</span><span class="sxs-lookup"><span data-stu-id="d490e-136">When it finishes, you'll see JSON output describing the new vault.</span></span>

<span data-ttu-id="d490e-137">Fügen Sie nun den geheimen Schlüssel hinzu: geheimen Schlüssel erhält **SecretPassword** mit einem Wert von **Reindeer_flotilla**.</span><span class="sxs-lookup"><span data-stu-id="d490e-137">Now add the secret: our secret will be named **SecretPassword** with a value of **reindeer_flotilla**.</span></span>

```azurecli
az keyvault secret set --name SecretPassword --value open_sesame --vault-name <your-unique-vault-name>
```

<span data-ttu-id="d490e-138">Notieren Sie sich den Namen des schlüsseltresors &mdash; Sie werde benötigen sie es später noch mal.</span><span class="sxs-lookup"><span data-stu-id="d490e-138">Make a note of the vault name &mdash; you'll be needing it again soon.</span></span>

<span data-ttu-id="d490e-139">Schreiben wir den Code für die Anwendung kurz, aber zunächst müssen wir ein bisschen erfahren Sie, wie unsere app geht, einen Tresor zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="d490e-139">We'll write the code for our application shortly, but first we need to learn a little bit about how our app is going to authenticate to a vault.</span></span>