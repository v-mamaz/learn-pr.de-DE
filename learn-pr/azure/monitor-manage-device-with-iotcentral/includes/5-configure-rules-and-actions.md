<span data-ttu-id="1e02f-101">Sie haben Ihre Kaffeemaschine mit der Azure IoT Central-Anwendung verbunden und so den Austausch von Daten aktiviert, mit deren Hilfe Sie Ihre Kaffeemaschine überwachen und verwalten können.</span><span class="sxs-lookup"><span data-stu-id="1e02f-101">You have connected your coffee machine to the Azure IoT Central application, enabling the exchange of data that allows you to monitor and manage your coffee machine.</span></span> <span data-ttu-id="1e02f-102">In dieser Übungseinheit erstellen Sie Regeln, die Aktionen auslösen, wenn die Wassertemperatur der Kaffeemaschine außerhalb des normalen Bereichs liegt.</span><span class="sxs-lookup"><span data-stu-id="1e02f-102">In this module, you create rules that trigger actions when the water temperature of the coffee machine is out of the normal range.</span></span> <span data-ttu-id="1e02f-103">Die Aktionen sind entweder E-Mails oder SMS-Benachrichtigungen, je nachdem, ob für die Maschine noch Garantie gilt oder nicht.</span><span class="sxs-lookup"><span data-stu-id="1e02f-103">The actions are either emails or mobile notifications depending on whether or not the machine is under warranty.</span></span> <span data-ttu-id="1e02f-104">Um Microsoft Flow als Aktion hinzuzufügen, benötigen Sie ein Azure-Abonnement.</span><span class="sxs-lookup"><span data-stu-id="1e02f-104">To add Microsoft Flow as an action, you need an Azure subscription.</span></span> <span data-ttu-id="1e02f-105">Wenn Sie nicht über ein Azure-Abonnement verfügen, ist das Hinzufügen von Microsoft Flow als Aktion optional.</span><span class="sxs-lookup"><span data-stu-id="1e02f-105">If you do not have an Azure subscription, adding Microsoft Flow as an action is optional.</span></span>

## <a name="create-rules-in-iot-central-with-email-as-the-action"></a><span data-ttu-id="1e02f-106">Erstellen von Regeln in IoT Central mit E-Mail als Aktion</span><span class="sxs-lookup"><span data-stu-id="1e02f-106">Create rules in IoT Central with Email as the action</span></span>
<span data-ttu-id="1e02f-107">Azure IoT Central kann Benachrichtigungen mithilfe seiner nativen E-Mail-Funktion senden.</span><span class="sxs-lookup"><span data-stu-id="1e02f-107">Azure IoT Central has its native email capabilities to send notifications.</span></span> <span data-ttu-id="1e02f-108">In diesem Szenario wird, wenn die Kaffeemaschine außerhalb des optimalen Temperaturbereichs liegt und nicht durch Garantie geschützt ist, eine E-Mail von IoT Central an die Wartungsabteilung des Kunden gesendet.</span><span class="sxs-lookup"><span data-stu-id="1e02f-108">In this scenario, if the coffee machine is outside the optimal temperature range and is not protected by the warranty, an email is sent by IoT Central to the client’s maintenance department.</span></span>

<span data-ttu-id="1e02f-109">Fügen Sie die folgenden zwei Regeln hinzu, wenn die Garantie der Kaffeemaschine abgelaufen ist und die Wassertemperatur außerhalb des optimalen Bereichs liegt.</span><span class="sxs-lookup"><span data-stu-id="1e02f-109">Add the following two rules when the coffee machine warranty has expired and the water temperature is outside the optimal range.</span></span> <span data-ttu-id="1e02f-110">Wählen Sie abschließend **Speichern** aus.</span><span class="sxs-lookup"><span data-stu-id="1e02f-110">When you're finished, choose **Save**.</span></span> 

> [!NOTE]
> <span data-ttu-id="1e02f-111">Wenn die Bedingungen angewendet werden, müssen alle Aussagen wahr sein, damit die Regeln ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="1e02f-111">When conditions are applied, all statements have to be true for the rules to be executed.</span></span> <span data-ttu-id="1e02f-112">Wenn Ihre Bedingung eine „Oder“-Aussage ist, wie in diesem Szenario (z. B. die optimale Temperatur ist unterhalb von 90° Celsius oder oberhalb von 98° Celsius bei abgelaufener Garantie), teilen Sie die Aussage in zwei Regeln auf, wie hier dargestellt.</span><span class="sxs-lookup"><span data-stu-id="1e02f-112">If your condition is an "or" statement as in this scenario (e.g. the optimal temperature is less than 90 Celsius or greater than 98 Celsius while the warranty has expired), split the statement into two rules as shown here.</span></span>

1. <span data-ttu-id="1e02f-113">Benennen Sie die Regel: Wasser in Kaffeemaschine zu kalt (abgelaufen)</span><span class="sxs-lookup"><span data-stu-id="1e02f-113">Name the rule: Coffee Maker Water Too Cold (Expired)</span></span>

    <span data-ttu-id="1e02f-114">Fügen Sie die Bedingungen hinzu:</span><span class="sxs-lookup"><span data-stu-id="1e02f-114">Add the conditions:</span></span>      
    * <span data-ttu-id="1e02f-115">Abgelaufene Gerätegarantie entspricht 1</span><span class="sxs-lookup"><span data-stu-id="1e02f-115">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="1e02f-116">Die Wassertemperatur liegt unterhalb der niedrigsten Temperatur der Kaffeemaschine ![Regel anwenden](../images/5-flow-g.png)</span><span class="sxs-lookup"><span data-stu-id="1e02f-116">Water Temperature is less than Coffee Makers Min Temperature ![Using Rule](../images/5-flow-g.png)</span></span>

1. <span data-ttu-id="1e02f-117">Benennen Sie die Regel: Wasser in Kaffeemaschine zu heiß (abgelaufen)</span><span class="sxs-lookup"><span data-stu-id="1e02f-117">Name the rule: Coffee Maker Water Too Hot (Expired)</span></span>

    <span data-ttu-id="1e02f-118">Fügen Sie die Bedingungen hinzu:</span><span class="sxs-lookup"><span data-stu-id="1e02f-118">Add the conditions:</span></span>      
    * <span data-ttu-id="1e02f-119">Abgelaufene Gerätegarantie entspricht 1</span><span class="sxs-lookup"><span data-stu-id="1e02f-119">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="1e02f-120">Die Wassertemperatur liegt oberhalb der höchsten Temperatur der Kaffeemaschine ![Regel anwenden](../images/5-flow-k.png)</span><span class="sxs-lookup"><span data-stu-id="1e02f-120">Water Temperature is greater than Coffee Makers Max Temperature ![Using Rule](../images/5-flow-k.png)</span></span>     

1. <span data-ttu-id="1e02f-121">Scrollen Sie zum Hinzufügen einer Aktion im Bereich Configure Telemetry Rule (Telemetrieregel konfigurieren) nach unten, und klicken Sie neben **Aktionen** auf das Pluszeichen (+) und dann auf **E-Mail**.</span><span class="sxs-lookup"><span data-stu-id="1e02f-121">To add an **Action**, scroll down on the Configure Telemetry Rule panel and choose the + next to Actions, then choose **Email**</span></span>

1. <span data-ttu-id="1e02f-122">Um die Aktion zu definieren, fügen Sie die E-Mail-Adresse hinzu, die Sie für die Anmeldung bei der IoT Central-Anwendung verwendet haben.</span><span class="sxs-lookup"><span data-stu-id="1e02f-122">To define the action, add the email address that you used to sign in to the IoT Central application.</span></span> <span data-ttu-id="1e02f-123">Fügen Sie die Benachrichtigungsmeldung für die zu hohe Wassertemperatur hinzu: „Das Wasser in der Kaffeemaschine ist zu heiß.</span><span class="sxs-lookup"><span data-stu-id="1e02f-123">Add the notification message when the water temperature is too hot: "Coffee maker's water is too hot.</span></span> <span data-ttu-id="1e02f-124">Wartung erforderlich.</span><span class="sxs-lookup"><span data-stu-id="1e02f-124">Maintenance is required.</span></span>  <span data-ttu-id="1e02f-125">Die Garantie ist abgelaufen.“</span><span class="sxs-lookup"><span data-stu-id="1e02f-125">Warranty has expired."</span></span> <span data-ttu-id="1e02f-126">Wiederholen Sie die gleichen Schritte für die zu kalte Wassertemperatur.</span><span class="sxs-lookup"><span data-stu-id="1e02f-126">Repeat the same steps for when the water temperature is too cold.</span></span> <span data-ttu-id="1e02f-127">Fügen Sie die Nachricht hinzu: „Das Wasser in der Kaffeemaschine ist zu kalt.</span><span class="sxs-lookup"><span data-stu-id="1e02f-127">Add the message: "Coffee maker's water is too cold.</span></span> <span data-ttu-id="1e02f-128">Wartung erforderlich.</span><span class="sxs-lookup"><span data-stu-id="1e02f-128">Maintenance is required.</span></span>  <span data-ttu-id="1e02f-129">Die Garantie ist abgelaufen.“</span><span class="sxs-lookup"><span data-stu-id="1e02f-129">Warranty has expired."</span></span>

1. <span data-ttu-id="1e02f-130">Wählen Sie **Speichern** aus.</span><span class="sxs-lookup"><span data-stu-id="1e02f-130">Choose **Save**.</span></span> <span data-ttu-id="1e02f-131">Ihre Regel ist auf der Seite Regeln aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="1e02f-131">Your rule is listed on the Rules page:</span></span>

1. <span data-ttu-id="1e02f-132">Um die Regel auszulösen, können Sie warten, bis die Temperatur den Bereich verlässt, oder Sie können die Temperatur in den Einstellungen außerhalb des optimalen Bereichs einstellen.</span><span class="sxs-lookup"><span data-stu-id="1e02f-132">To trigger the rule, you can wait for the temperature to go out of the range or you can purposely set the temperature out of the optimal range in settings.</span></span> <span data-ttu-id="1e02f-133">Sobald Sie beginnen, E-Mail-Benachrichtigungen zu erhalten, denken Sie daran, die Regel zu deaktivieren, um einen Ansturm auf Ihren Posteingang mit E-Mails von Azure IoT Central zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="1e02f-133">Once you begin to receive email notification, remember to disable the rule to avoid flooding your Inbox with emails from Azure IoT Central.</span></span> 

> [!NOTE]
> <span data-ttu-id="1e02f-134">Deaktivieren Sie die Regeln, sobald Sie die Überprüfung abgeschlossen haben, um ein Fluten Ihres Posteingangs mit E-Mails zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="1e02f-134">Turn off the rules once you are done with validation to avoid flooding your Inbox with emails.</span></span> 

## <a name="create-rules-in-iot-central-with-microsoft-flow-as-the-action"></a><span data-ttu-id="1e02f-135">Erstellen von Regeln in IoT Central mit Microsoft Flow als Aktion</span><span class="sxs-lookup"><span data-stu-id="1e02f-135">Create rules in IoT Central with Microsoft Flow as the action</span></span>

<span data-ttu-id="1e02f-136">Microsoft Flow automatisiert Workflows übergreifend über viele Anwendungen hinweg.</span><span class="sxs-lookup"><span data-stu-id="1e02f-136">Microsoft Flow automates workflows across many applications.</span></span> <span data-ttu-id="1e02f-137">Es ist eine der Aktionen, die durch Auslösen einer Regel in IoT Central eingeleitet werden können.</span><span class="sxs-lookup"><span data-stu-id="1e02f-137">It’s one of the actions that can be triggered when a rule is fired in IoT Central.</span></span> <span data-ttu-id="1e02f-138">In diesem Szenario sendet Microsoft Flow eine SMS-Benachrichtigung an einen lokalen Techniker, wenn die Kaffeemaschine einen bestimmten Temperaturschwellenwert erreicht und noch der Garantie unterliegt.</span><span class="sxs-lookup"><span data-stu-id="1e02f-138">In this scenario, Microsoft Flow sends a mobile notification to a local technician when the coffee machine reaches certain temperature threshold and is under warranty.</span></span> <span data-ttu-id="1e02f-139">Navigieren Sie zu **Regeln**, um Bedingungen zu konfigurieren und einen Flow als Aktion hinzuzufügen, wenn die Regel ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="1e02f-139">Navigate to **Rules** to configure conditions and add a Flow as an action when the rule is fired.</span></span> 
 
> [!NOTE]
> <span data-ttu-id="1e02f-140">Diese Übung ist optional, wenn Sie nicht über ein Azure-Abonnement verfügen, mit dem Sie Microsoft Flow aktivieren können.</span><span class="sxs-lookup"><span data-stu-id="1e02f-140">This exercise is optional if you do not have an Azure subscription to turn on Microsoft Flow.</span></span>

<span data-ttu-id="1e02f-141">Fügen Sie die folgenden Regeln hinzu, wenn für die Kaffeemaschine noch Garantie gilt.</span><span class="sxs-lookup"><span data-stu-id="1e02f-141">Add the following rules when the coffee machine is under warranty.</span></span> 

1. <span data-ttu-id="1e02f-142">Benennen Sie die Regel: Wasser in Kaffeemaschine zu kalt (Garantie)</span><span class="sxs-lookup"><span data-stu-id="1e02f-142">Name the rule: Coffee Maker Water Too Cold (Warranty)</span></span>

    <span data-ttu-id="1e02f-143">Fügen Sie die Bedingungen hinzu:</span><span class="sxs-lookup"><span data-stu-id="1e02f-143">Add the conditions:</span></span>      
    * <span data-ttu-id="1e02f-144">Abgelaufene Gerätegarantie entspricht 0</span><span class="sxs-lookup"><span data-stu-id="1e02f-144">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="1e02f-145">Die Wassertemperatur liegt unterhalb der niedrigsten Temperatur der Kaffeemaschine ![Regel anwenden](../images/5-flow-l.png)</span><span class="sxs-lookup"><span data-stu-id="1e02f-145">Water Temperature is less than Coffee Makers Min Temperature ![Using Rule](../images/5-flow-l.png)</span></span>

1. <span data-ttu-id="1e02f-146">Benennen Sie die Regel: Wasser in Kaffeemaschine zu heiß (Garantie)</span><span class="sxs-lookup"><span data-stu-id="1e02f-146">Name the rule: Coffee Maker Water Too Hot (Warranty)</span></span>

    <span data-ttu-id="1e02f-147">Fügen Sie die Bedingungen hinzu:</span><span class="sxs-lookup"><span data-stu-id="1e02f-147">Add the conditions:</span></span>      
    * <span data-ttu-id="1e02f-148">Abgelaufene Gerätegarantie entspricht 0</span><span class="sxs-lookup"><span data-stu-id="1e02f-148">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="1e02f-149">Die Wassertemperatur liegt oberhalb der höchsten Temperatur der Kaffeemaschine ![Regel anwenden](../images/5-flow-h.png)</span><span class="sxs-lookup"><span data-stu-id="1e02f-149">Water Temperature is greater than Coffee Makers Max Temperature ![Using Rule](../images/5-flow-h.png)</span></span>

1. <span data-ttu-id="1e02f-150">Nachdem Sie die Regelbedingungen gespeichert haben, wählen Sie Microsoft Flow als neue Aktion aus, wenn für die Kaffeemaschine noch Garantie gilt.</span><span class="sxs-lookup"><span data-stu-id="1e02f-150">After you save the rule conditions, choose Microsoft Flow as a new action when the coffee maker is under warranty.</span></span> <span data-ttu-id="1e02f-151">In Ihrem Browser sollte eine neue Registerkarte oder ein neues Fenster geöffnet werden, um Ihnen den Zugang zu Microsoft Flow zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="1e02f-151">A new tab or window should open in your browser, taking you to Microsoft Flow.</span></span> <span data-ttu-id="1e02f-152">Sie gelangen auf eine Übersichtsseite, auf der ein IoT Central-Connector angezeigt wird, der eine Verbindung mit einer benutzerdefinierten Aktion herstellt.</span><span class="sxs-lookup"><span data-stu-id="1e02f-152">You land on an overview page showing an IoT Central connector connecting to a custom action.</span></span> <span data-ttu-id="1e02f-153">Klicken Sie auf **Weiter**.</span><span class="sxs-lookup"><span data-stu-id="1e02f-153">Choose **Continue**.</span></span> 

    <span data-ttu-id="1e02f-154">Sie werden an den Microsoft Flow-Designer weitergeleitet, um Ihren Workflow zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="1e02f-154">You are taken to the Microsoft Flow designer to build your workflow.</span></span> <span data-ttu-id="1e02f-155">Der Workflow verfügt über einen IoT Central-Auslöser, in den Ihre Anwendung und Regel bereits eingetragen sind.</span><span class="sxs-lookup"><span data-stu-id="1e02f-155">The workflow has an IoT Central trigger that has your Application and Rule already filled in.</span></span>

    <span data-ttu-id="1e02f-156">An diesem Punkt können Sie Ihrem Workflow eine beliebige Aktion hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="1e02f-156">At this point, you can add any action you want to your workflow.</span></span> <span data-ttu-id="1e02f-157">Als Beispiel senden wir eine Mobiltelefonbenachrichtigung.</span><span class="sxs-lookup"><span data-stu-id="1e02f-157">As an example, let's send a mobile notification.</span></span> <span data-ttu-id="1e02f-158">Suchen Sie nach „Benachrichtigung“, und wählen Sie „Benachrichtigungen – Mobiltelefonbenachrichtigung an mich senden“ aus.</span><span class="sxs-lookup"><span data-stu-id="1e02f-158">Search for notification, and choose Notifications - Send me a mobile notification.</span></span>

    <span data-ttu-id="1e02f-159">Füllen Sie in der Aktion das Feld „Text“ mit dem Inhalt der Benachrichtigung aus.</span><span class="sxs-lookup"><span data-stu-id="1e02f-159">In the action, fill in the Text field with what you want your notification to say.</span></span> <span data-ttu-id="1e02f-160">Sie können dynamische Inhalte aus Ihrer IoT Central-Regel einschließen, um wichtige Informationen wie die Geräte-ID und den Namen des Geräts zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="1e02f-160">You can include Dynamic content from your IoT Central rule, passing along important information such as device ID and name.</span></span>
    <span data-ttu-id="1e02f-161">![Verwenden von Microsoft Flow als Aktion](../images/5-flow-f.png)</span><span class="sxs-lookup"><span data-stu-id="1e02f-161">![Using Microsoft Flow as an action](../images/5-flow-f.png)</span></span>

1. <span data-ttu-id="1e02f-162">Sobald Sie den Workflow in Microsoft Flow eingerichtet haben, laden Sie die [Flow-App](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) aus dem Microsoft Store auf Ihr mobiles Gerät herunter.</span><span class="sxs-lookup"><span data-stu-id="1e02f-162">Once you've set up the workflow in Microsoft Flow, download the [Flow app](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) from Microsoft Store to your mobile device.</span></span> <span data-ttu-id="1e02f-163">Melden Sie sich mit dem gleichen Konto an, das Sie verwendet haben, um den Flow in der Flow-Web-App einzurichten.</span><span class="sxs-lookup"><span data-stu-id="1e02f-163">Sign in using the same account that you used to set up the flow in the Flow web app.</span></span> <span data-ttu-id="1e02f-164">Legen Sie für Testzwecke die optimale Temperatur außerhalb des Bereichs fest, um die Regel auszulösen.</span><span class="sxs-lookup"><span data-stu-id="1e02f-164">For testing purpose, set the optimal temperature out of range to trigger the rule.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="1e02f-165">Geräteeigenschaft: Gerätegarantie abgelaufen (1 für abgelaufen oder 0 für unter Garantie im Gerätecode) wird vom Gerät nach dem Zufallsprinzip generiert und dann vom Gerät an die Azure IoT Central-Anwendung gesendet.</span><span class="sxs-lookup"><span data-stu-id="1e02f-165">Device Property: Device Warranty Expired (1 for expired or 0 for under warranty in the device code) is randomly generated by the device and then sent by the device to the Azure IoT Central application.</span></span> <span data-ttu-id="1e02f-166">Wenn Sie für Testzwecke den Ablauf der Gerätegarantie steuern möchten (1 oder 0), starten Sie den Simulator erneut, bis Sie den gewünschten Garantiestatus erhalten, um die zu testende Aktion auszulösen.</span><span class="sxs-lookup"><span data-stu-id="1e02f-166">For testing purpose, if you'd like to control Device Warranty Expired (1 or 0), reboot your simulator until you receive the intended warranty state to trigger the action that you're testing.</span></span> <span data-ttu-id="1e02f-167">Um eine Benachrichtigung auf Ihrem mobilen Gerät zu erhalten, starten Sie den Simulator neu, bis Sie sehen, dass der Ablauf der Gerätegarantie im Protokoll der Konsole „0“ ist.</span><span class="sxs-lookup"><span data-stu-id="1e02f-167">To receive a mobile notification, reboot your simulator until you see that Device Warranty Expired is 0 in the console log.</span></span> 

    <span data-ttu-id="1e02f-168">Nach einigen Minuten wird die Benachrichtigung in der mobilen Flow-App angezeigt.</span><span class="sxs-lookup"><span data-stu-id="1e02f-168">After several minutes, notification appears in the Flow mobile app.</span></span>

    ![Verwenden von Microsoft Flow als Aktion](../images/5-flow-a.png)

## <a name="summary"></a><span data-ttu-id="1e02f-170">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="1e02f-170">Summary</span></span>
<span data-ttu-id="1e02f-171">Sie haben das Erstellen von Regeln in IoT Central gelernt und Aktionen wie das Senden einer E-Mail oder einer SMS-Benachrichtigung mithilfe von Microsoft Flow beim Auslösen der Regel ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="1e02f-171">You’ve learned to create rules in IoT Central and triggered actions such as an email or a mobile notification through Microsoft Flow when the rule is fired.</span></span> <span data-ttu-id="1e02f-172">In diesem Fall werden, wenn die Wassertemperatur der Kaffeemaschine außerhalb des optimalen Bereichs liegt, Benachrichtigungen entweder an einen Reparaturtechniker oder den Kunden gesendet, abhängig vom Garantiestatus des Geräts.</span><span class="sxs-lookup"><span data-stu-id="1e02f-172">In this case, when the water temperature of the coffee machine is out of the optimal range, notifications are sent to either a repair technician or the client depending on the state of the warranty.</span></span> 


