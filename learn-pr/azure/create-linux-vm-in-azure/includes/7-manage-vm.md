<span data-ttu-id="f9855-101">In der Regel werden Änderungen an Serverkonfigurationen mithilfe von Geräten in Ihrer lokalen Umgebung vorgenommen.</span><span class="sxs-lookup"><span data-stu-id="f9855-101">Making adjustments to server configuration is commonly performed with equipment in your on-premises environment.</span></span> <span data-ttu-id="f9855-102">In diesem Zusammenhang stellen Azure-VMs eine Erweiterung zu dieser Umgebung dar.</span><span class="sxs-lookup"><span data-stu-id="f9855-102">In this sense, you can consider Azure VMs to be an extension of that environment.</span></span> <span data-ttu-id="f9855-103">Sie können über das Azure-Portal, die Azure CLI oder Azure PowerShell-Tools die Konfiguration ändern, Netzwerke verwalten, den Datenverkehr öffnen oder blockieren und vieles mehr.</span><span class="sxs-lookup"><span data-stu-id="f9855-103">You can alter configuration, manage networks, open or block traffic, and more through the Azure portal, Azure CLI, or Azure PowerShell tools.</span></span>

<span data-ttu-id="f9855-104">Unser Server wird ausgeführt, und Apache ist installiert und stellt Seiten zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="f9855-104">We've got our server running, and Apache is installed and serving up pages.</span></span> <span data-ttu-id="f9855-105">Unser Sicherheitsteam verlangt, dass wir alle unsere Server sperren. Wir haben für diesen virtuellen Computer noch keine derartige Aktion ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="f9855-105">Our security team mandates that we lock down all our servers - we've not done anything to this VM yet.</span></span> <span data-ttu-id="f9855-106">Der Datenverkehr war geöffnet, und Apache hat an Port 80 gelauscht.</span><span class="sxs-lookup"><span data-stu-id="f9855-106">We didn't do anything, and it let Apache listen on port 80.</span></span> <span data-ttu-id="f9855-107">Lassen Sie uns die Azure-Netzwerkkonfiguration untersuchen, um zu sehen, wie Sie die integrierte Sicherheitsunterstützung nutzen können, um unseren Server zu schützen.</span><span class="sxs-lookup"><span data-stu-id="f9855-107">Let's explore the Azure network configuration to see how to use the built-in security support to harden our server.</span></span>

## <a name="opening-ports-in-azure-vms"></a><span data-ttu-id="f9855-108">Öffnen von Ports in Azure-VMs</span><span class="sxs-lookup"><span data-stu-id="f9855-108">Opening ports in Azure VMs</span></span>

<!-- TODO: Azure portal is inconsistent here in applying the NSG.
By default, new VMs are locked down. 

Apps can make outgoing requests, but the only inbound traffic allowed is from the virtual network (e.g., other resources on the same local network), and from Azure's Load Balancer (probe checks). -->

<span data-ttu-id="f9855-109">Die Anpassung der Konfiguration für die Unterstützung verschiedener Protokolle im Netzwerk erfolgt in zwei Schritten.</span><span class="sxs-lookup"><span data-stu-id="f9855-109">There are two steps to adjusting the configuration to support different protocols on the network.</span></span> <span data-ttu-id="f9855-110">Wenn Sie einen neuen virtuellen Computer erstellen, können Sie einige häufig verwendete Ports öffnen (RDP, HTTP, HTTPS und SSH).</span><span class="sxs-lookup"><span data-stu-id="f9855-110">When you create a new VM, you have an opportunity to open a few common ports (RDP, HTTP, HTTPS, and SSH).</span></span> <span data-ttu-id="f9855-111">Wenn Sie allerdings andere Änderungen an der Firewall vornehmen müssen, müssen Sie diese manuell anpassen.</span><span class="sxs-lookup"><span data-stu-id="f9855-111">However, if you require other changes to the firewall, you will need to adjust them manually.</span></span>

<span data-ttu-id="f9855-112">Dies umfasst zwei Schritte:</span><span class="sxs-lookup"><span data-stu-id="f9855-112">The process for this involves two steps:</span></span>

1. <span data-ttu-id="f9855-113">Erstellen einer Netzwerksicherheitsgruppe.</span><span class="sxs-lookup"><span data-stu-id="f9855-113">Create a Network Security Group.</span></span>
2. <span data-ttu-id="f9855-114">Erstellen einer Regel für eingehenden Datenverkehr, die Datenverkehr an den benötigten Ports zulässt.</span><span class="sxs-lookup"><span data-stu-id="f9855-114">Create an inbound rule allowing traffic on the ports you need.</span></span>

### <a name="what-is-a-network-security-group"></a><span data-ttu-id="f9855-115">Was ist eine Netzwerksicherheitsgruppe?</span><span class="sxs-lookup"><span data-stu-id="f9855-115">What is a Network Security Group?</span></span>

<span data-ttu-id="f9855-116">Virtuelle Netzwerke (VNets) stellen die Grundlage des Azure-Netzwerkmodells dar und stellen Isolation und Schutz bereit.</span><span class="sxs-lookup"><span data-stu-id="f9855-116">Virtual networks (VNets) are the foundation of the Azure networking model and provide isolation and protection.</span></span> <span data-ttu-id="f9855-117">Netzwerksicherheitsgruppen sind das wichtigste Tool zum Erzwingen und Überwachen von Regeln zum Netzwerkdatenverkehr auf Netzwerkebene.</span><span class="sxs-lookup"><span data-stu-id="f9855-117">Network Security Groups (NSGs) are the primary tool you use to enforce and control network traffic rules at the networking level.</span></span> <span data-ttu-id="f9855-118">Sie stellen eine optionale Sicherheitsebene dar, die eine Firewall für Software darstellt, indem sie eingehenden und ausgehenden Datenverkehr auf dem VNet bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="f9855-118">NSGs are an optional security layer that provides a software firewall by filtering inbound and outbound traffic on the VNet.</span></span> 

<span data-ttu-id="f9855-119">Außerdem können sie einer Netzwerkschnittstelle (für hostspezifische Regeln), einem Subnetz im VNet (das für mehrere Ressourcen verwendbar ist) oder beiden zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="f9855-119">Security groups can be associated to a network interface (for per-host rules), a subnet in the virtual network (to apply to multiple resources), or both levels.</span></span> 

#### <a name="security-group-rules"></a><span data-ttu-id="f9855-120">Regeln für Sicherheitsgruppen</span><span class="sxs-lookup"><span data-stu-id="f9855-120">Security group rules</span></span>

<span data-ttu-id="f9855-121">NGS verwenden _Regeln_, um Datenverkehr im Netzwerk zuzulassen oder zu blockieren.</span><span class="sxs-lookup"><span data-stu-id="f9855-121">NGSs use _rules_ to allow or deny traffic moving through the network.</span></span> <span data-ttu-id="f9855-122">Jede Regel erkennt die Quell- und Zieladresse (oder den Bereich), das Protokoll, den Port (oder den Bereich), die Richtung (eingehend oder ausgehend) sowie eine numerische Priorität und stellt fest, ob Datenverkehr, der der Regel entspricht, zugelassen oder blockiert wird.</span><span class="sxs-lookup"><span data-stu-id="f9855-122">Each rule identifies the source and destination address (or range), protocol, port (or range), direction (inbound or outbound), a numeric priority, and whether to allow or deny the traffic that matches the rule.</span></span>

![Regeln für Netzwerksicherheitsgruppen](../media/7-nsg-rules.png)

<span data-ttu-id="f9855-124">Jede Sicherheitsgruppe verfügt über mehrere Standardsicherheitsregeln, damit die oben beschriebenen Standardnetzwerkregeln angewendet werden können.</span><span class="sxs-lookup"><span data-stu-id="f9855-124">Each security group has a set of default security rules to apply the default network rules described above.</span></span> <span data-ttu-id="f9855-125">Diese Standardregeln können zwar nicht verändert, aber sie können _überschrieben_ werden.</span><span class="sxs-lookup"><span data-stu-id="f9855-125">These default rules cannot be modified, but _can_ be overridden.</span></span>

#### <a name="how-azure-uses-network-rules"></a><span data-ttu-id="f9855-126">So verwendet Azure Netzwerkregeln</span><span class="sxs-lookup"><span data-stu-id="f9855-126">How Azure uses network rules</span></span>

<span data-ttu-id="f9855-127">Für eingehenden Datenverkehr verarbeitet Azure zuerst die Sicherheitsgruppe, die dem Subnetz zugeordnet ist, und anschließend die Sicherheitsgruppe, die der Netzwerkschnittstelle zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="f9855-127">For inbound traffic, Azure processes the security group associated to the subnet, and then the security group applied to the network interface.</span></span> <span data-ttu-id="f9855-128">Ausgehender Datenverkehr wird in umgekehrter Reihenfolge verarbeitet (zuerst die Netzwerkschnittstelle, gefolgt vom Subnetz).</span><span class="sxs-lookup"><span data-stu-id="f9855-128">Outbound traffic is handled in the opposite order (the network interface first, followed by the subnet).</span></span>

> [!WARNING]
> <span data-ttu-id="f9855-129">Beachten Sie, dass Sicherheitsgruppen auf beiden Ebenen optional sind.</span><span class="sxs-lookup"><span data-stu-id="f9855-129">Keep in mind that security groups are optional at both levels.</span></span> <span data-ttu-id="f9855-130">Wenn keine Sicherheitsgruppe verwendet wird, lässt Azure **sämtlichen Datenverkehr** zu.</span><span class="sxs-lookup"><span data-stu-id="f9855-130">If no security group is applied then **all traffic is allowed** by Azure.</span></span> <span data-ttu-id="f9855-131">Wenn der virtuelle Computer über eine öffentliche IP-Adresse verfügt, kann dies ein ernsthaftes Risiko darstellen, insbesondere wenn das Betriebssystem keine integrierte Firewall zur Verfügung stellt.</span><span class="sxs-lookup"><span data-stu-id="f9855-131">If the VM has a public IP, this could be a serious risk particularly if the OS doesn't provide a built-in firewall.</span></span>

<span data-ttu-id="f9855-132">Die Regeln werden je nach _Priorität_ bewertet, angefangen bei der Regel mit der **niedrigsten Priorität**.</span><span class="sxs-lookup"><span data-stu-id="f9855-132">The rules are evaluated in _priority-order_, starting with the **lowest priority** rule.</span></span> <span data-ttu-id="f9855-133">Ablehnungsregeln **beenden** die Auswertung immer.</span><span class="sxs-lookup"><span data-stu-id="f9855-133">Deny rules always **stop** the evaluation.</span></span> <span data-ttu-id="f9855-134">Wenn eine Netzwerkschnittstellenregel beispielsweise eine ausgehende Anforderung blockiert, wird keine der auf das Subnetz angewandten Regeln überprüft.</span><span class="sxs-lookup"><span data-stu-id="f9855-134">For example, if a network interface rule blocks an outbound request, any rules applied to the subnet will not be checked.</span></span> <span data-ttu-id="f9855-135">Damit die Sicherheitsgruppe Datenverkehr zulässt, muss er _alle_ angewendeten Gruppen durchlaufen.</span><span class="sxs-lookup"><span data-stu-id="f9855-135">For traffic to be allowed through the security group, it must pass through _all_ applied groups.</span></span>

<span data-ttu-id="f9855-136">Die letzte Regel ist immer eine **Alle Ablehnen**-Regel.</span><span class="sxs-lookup"><span data-stu-id="f9855-136">The last rule is always a **Deny All** rule.</span></span> <span data-ttu-id="f9855-137">Es handelt sich dabei um eine Standardregel, die sämtlichen Sicherheitsregeln für eingehenden und ausgehenden Datenverkehr mit einer Priorität von 65500 hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="f9855-137">This is a default rule added to every security group for both inbound and outbound traffic with a priority of 65500.</span></span> <span data-ttu-id="f9855-138">Dies bedeutet, dass der Datenverkehr die Sicherheitsgruppe durchlaufen muss, und _Sie müssen über eine Zulassungsregel verfügen_. Andernfalls wird er von der letzten Standardregel blockiert.</span><span class="sxs-lookup"><span data-stu-id="f9855-138">That means to have traffic pass through the security group _you must have an allow rule_ or the final default rule will block it.</span></span>

> [!NOTE]
> <span data-ttu-id="f9855-139">Bei SMTP (Port 25) handelt es sich um einen Sonderfall. Abhängig von Ihrer Abonnementstufe und dem Erstelldatum Ihres Kontos, wird SMTP-Datenverkehr möglicherweise blockiert.</span><span class="sxs-lookup"><span data-stu-id="f9855-139">SMTP (port 25) is a special case, depending on your subscription level and when your account was created, outbound SMTP traffic may be blocked.</span></span> <span data-ttu-id="f9855-140">Sie können einen Antrag auf Entfernen dieser Einschränkung stellen, wenn Sie dies geschäftlich begründen können.</span><span class="sxs-lookup"><span data-stu-id="f9855-140">You can request to remove this restriction with business justification.</span></span>

<span data-ttu-id="f9855-141">Nachfolgend erfahren Sie, wie Sie eine Sicherheitsgruppe für diese VM erstellen.</span><span class="sxs-lookup"><span data-stu-id="f9855-141">Since we didn't create a security group for this VM, let's do that and apply it.</span></span>

## <a name="creating-network-security-groups"></a><span data-ttu-id="f9855-142">Erstellen von Netzwerksicherheitsgruppen</span><span class="sxs-lookup"><span data-stu-id="f9855-142">Creating Network Security Groups</span></span>

<span data-ttu-id="f9855-143">Sicherheitsgruppen sind verwaltete Ressourcen, die Sie wie beinahe alle Azure-Elemente im Azure-Portal oder über Tools zur Skripterstellung auf Befehlszeilenebene erstellen können.</span><span class="sxs-lookup"><span data-stu-id="f9855-143">Security groups are managed resources like most everything in Azure; you can create them in the Azure portal or through command-line scripting tools.</span></span> <span data-ttu-id="f9855-144">Die Schwierigkeit besteht darin, die Regeln zu definieren.</span><span class="sxs-lookup"><span data-stu-id="f9855-144">The challenge is in defining the rules.</span></span> <span data-ttu-id="f9855-145">Sehen wir uns an, wie eine neue Regel definiert wird, die den HTTP-Zugriff erlaubt und alles andere blockiert.</span><span class="sxs-lookup"><span data-stu-id="f9855-145">Let's look at defining a new rule to allow HTTP access and block everything else.</span></span>