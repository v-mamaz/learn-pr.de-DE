<span data-ttu-id="622dc-101">Aktualisieren Sie die Funktionsimplementierung, um den Textanalyse-API-Dienst aufzurufen und einen Stimmungswert abzurufen.</span><span class="sxs-lookup"><span data-stu-id="622dc-101">Let's update our function implementation to call the Text Analytics API service and get back a sentiment score.</span></span>

1. <span data-ttu-id="622dc-102">Wählen Sie in Ihrer Funktions-App im Portal die Funktion [!INCLUDE [func-name-discover](./func-name-discover.md)] aus.</span><span class="sxs-lookup"><span data-stu-id="622dc-102">Select our function, [!INCLUDE [func-name-discover](./func-name-discover.md)], in our function app in the portal.</span></span>

1. <span data-ttu-id="622dc-103">Erweitern Sie auf der rechten Bildschirmseite das Menü **Dateien anzeigen**.</span><span class="sxs-lookup"><span data-stu-id="622dc-103">Expand the **View files** menu on the right of the screen.</span></span>

1. <span data-ttu-id="622dc-104">Klicken Sie auf der Registerkarte **Dateien anzeigen** auf **index.json**, um die Codedatei im Editor zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="622dc-104">Under the **View files** tab, select **index.js** to open the code file in the editor.</span></span>

1. <span data-ttu-id="622dc-105">Ersetzen Sie den gesamten Inhalt von **index.js** durch den folgenden JavaScript-Code, und **speichern** Sie die Änderungen.</span><span class="sxs-lookup"><span data-stu-id="622dc-105">Replace the entire content of **index.js** with the following JavaScript and **Save**.</span></span>

    [!code-javascript[](../code/discover-sentiment-sort.js?highlight=7)]

1. <span data-ttu-id="622dc-106">Aktualisieren Sie den Wert von `accessKey` in dem Code, den Sie mit dem Zugriffsschlüssel für die Textanalyse-API eingefügt haben, den Sie zuvor in diesem Modul gespeichert haben.</span><span class="sxs-lookup"><span data-stu-id="622dc-106">Update the value of `accessKey` in the code you pasted with the access key for the Text Analytics API that you saved earlier in this module.</span></span> 

1. <span data-ttu-id="622dc-107">Aktualisieren Sie den Wert `uri` mit der Region, aus der Sie Ihren Zugangsschlüssel erhalten haben.</span><span class="sxs-lookup"><span data-stu-id="622dc-107">Update the `uri` value with the region from which you obtained your access key.</span></span>

<span data-ttu-id="622dc-108">Sehen Sie sich an, was im Code geschieht:</span><span class="sxs-lookup"><span data-stu-id="622dc-108">Let's look at what's happening in this code:</span></span>

- <span data-ttu-id="622dc-109">Jeder Aufruf des Textanalysediensts benötigt den Zugriffsschlüssel, den Sie als `Ocp-Apim-Subscription-Key`-Header hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="622dc-109">Each call to the Text Analytics service, needs the access key, which we add as the `Ocp-Apim-Subscription-Key` header.</span></span> 
- <span data-ttu-id="622dc-110">Jeder Anruf erfolgt zu einem regionsspezifischen Endpunkt, der durch `uri` in Ihrem Code definiert ist.</span><span class="sxs-lookup"><span data-stu-id="622dc-110">Each call is made to a region-specific endpoint, defined by `uri` in our code.</span></span>
- <span data-ttu-id="622dc-111">Am Ende der Codedatei haben wir ein `documents`-Array definiert.</span><span class="sxs-lookup"><span data-stu-id="622dc-111">At the bottom of the code file, we've defined a `documents` array.</span></span> <span data-ttu-id="622dc-112">Dieses Array ist die Nutzlast, die wir an den Textanalysedienst senden.</span><span class="sxs-lookup"><span data-stu-id="622dc-112">This array is the payload we send to the Text Analytics service.</span></span>
- <span data-ttu-id="622dc-113">Das `documents`-Array enthält in diesem Fall einen einzelnen Eintrag: die Warteschlangennachricht, die unsere Funktion ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="622dc-113">The `documents` array has a single entry in this case, which is the queue message that triggered our function.</span></span> <span data-ttu-id="622dc-114">Wenngleich wir nur über ein Dokument in unserem Array verfügen, bedeutet dies nicht, dass unsere Lösung nur jeweils eine Nachricht verarbeiten kann.</span><span class="sxs-lookup"><span data-stu-id="622dc-114">Although we only have one document in our array, it doesn't mean that our solution can only handle one message at a time.</span></span> <span data-ttu-id="622dc-115">Die Azure Functions-Runtime führt Abruf und Verarbeitung von Nachrichten in Batches durch, hierbei werden verschiedene Instanzen unserer Funktion  *parallel* aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="622dc-115">The Azure Functions runtime retrieves and processes messages in batches, calling several instances of our function *in parallel*.</span></span> <span data-ttu-id="622dc-116">Aktuell beträgt die standardmäßige Batchgröße 16 und die maximal zulässige Batchgröße 32.</span><span class="sxs-lookup"><span data-stu-id="622dc-116">Currently, the default batch size is 16 and the maximum batch size is 32.</span></span>
- <span data-ttu-id="622dc-117">Die `id` muss innerhalb des Arrays eindeutig sein.</span><span class="sxs-lookup"><span data-stu-id="622dc-117">The `id` must be unique within the array.</span></span> <span data-ttu-id="622dc-118">Die `language`-Eigenschaft gibt die Sprache des Dokumenttexts an.</span><span class="sxs-lookup"><span data-stu-id="622dc-118">The `language` property specifies the language of the document text.</span></span>
- <span data-ttu-id="622dc-119">Anschließend rufen wir unsere Methode `get_sentiments` auf, die das HTTPS-Modul zum Aufrufen der Textanalyse-API verwendet.</span><span class="sxs-lookup"><span data-stu-id="622dc-119">We then call our method `get_sentiments`, which uses the HTTPS module to make the call to Text Analytics API.</span></span> <span data-ttu-id="622dc-120">Beachten Sie, dass wir unseren Abonnement- oder Zugriffsschlüssel im Header jeder Anforderung übergeben.</span><span class="sxs-lookup"><span data-stu-id="622dc-120">Notice that we pass our subscription, or access, key in the header of every request.</span></span>
- <span data-ttu-id="622dc-121">Bei Rückgabe durch den Dienst wird `response_handler` aufgerufen, und die Antwort wird unter Verwendung von `context.log` an die Konsole ausgegeben.</span><span class="sxs-lookup"><span data-stu-id="622dc-121">When the service returns, our `response_handler` is called, and we log the response to the console using `context.log`</span></span>


## <a name="try-it-out"></a><span data-ttu-id="622dc-122">Ausprobieren</span><span class="sxs-lookup"><span data-stu-id="622dc-122">Try it out</span></span>

<span data-ttu-id="622dc-123">Bevor wir uns mit der Sortierung in Warteschlangen befassen, führen wir mit den vorhandenen Daten zunächst einen Testlauf aus.</span><span class="sxs-lookup"><span data-stu-id="622dc-123">Before we look at sorting into queues, let's take what we have for a test run.</span></span>

1. <span data-ttu-id="622dc-124">Klicken Sie bei ausgewählter Funktion [!INCLUDE [func-name-discover](./func-name-discover.md)] im Bereich „Funktions-Apps“ des Portals ganz rechts auf das Menüelement **Test**.</span><span class="sxs-lookup"><span data-stu-id="622dc-124">With our function, [!INCLUDE [func-name-discover](./func-name-discover.md)], selected in the Function Apps area of the portal, click on the **Test** menu item on the far right.</span></span>

1. <span data-ttu-id="622dc-125">Klicken Sie auf das Menüelement **Test**, und achten Sie darauf, ob der Testbereich geöffnet ist.</span><span class="sxs-lookup"><span data-stu-id="622dc-125">Select the **Test** menu item, and verify that you have the test panel open.</span></span>

1. <span data-ttu-id="622dc-126">Fügen Sie wie im Screenshot gezeigt eine Textzeichenfolge in den Anforderungstext ein.</span><span class="sxs-lookup"><span data-stu-id="622dc-126">Add a string of text into the request body as shown in the screenshot.</span></span>

    ![Screenshot mit erweitertem Bereich für den Funktionstest](../media/test-panel-open-small.png)

1.  <span data-ttu-id="622dc-128">Klicken Sie unten im Testbereich auf **Ausführen**.</span><span class="sxs-lookup"><span data-stu-id="622dc-128">Click **Run** at the bottom of the test panel.</span></span>

1. <span data-ttu-id="622dc-129">Stellen Sie sicher, dass die Registerkarte **Protokolle** im linken unteren Bereich des Hauptbildschirms (unter dem Code-Editor) erweitert ist.</span><span class="sxs-lookup"><span data-stu-id="622dc-129">Make sure the **Logs** tab is expanded at the bottom left of the main screen, under the code editor.</span></span>

1. <span data-ttu-id="622dc-130">Überprüfen Sie, ob die Registerkarte **Protokolle** anzeigt, dass die Funktion ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="622dc-130">Verify that the **Logs** tab displays log information that the function completed.</span></span> <span data-ttu-id="622dc-131">Das Fenster zeigt außerdem die Antwort des Aufrufs der Textanalyse-API an.</span><span class="sxs-lookup"><span data-stu-id="622dc-131">The window will also display the response from the Text Analytics API call.</span></span>

    ![Screenshot mit Anzeige des Testbereichs und dem Ergebnis eines erfolgreichen Tests](../media/sentiment-response-log1.png)

<span data-ttu-id="622dc-133">Herzlichen Glückwunsch!</span><span class="sxs-lookup"><span data-stu-id="622dc-133">Congratulations!</span></span> <span data-ttu-id="622dc-134">[!INCLUDE [func-name-discover](./func-name-discover.md)] arbeitet wie vorgesehen.</span><span class="sxs-lookup"><span data-stu-id="622dc-134">The [!INCLUDE [func-name-discover](./func-name-discover.md)] works as designed.</span></span> <span data-ttu-id="622dc-135">In diesem Beispiel haben wir eine sehr positive Nachricht übergeben und eine Bewertung von über 0,98 erhalten.</span><span class="sxs-lookup"><span data-stu-id="622dc-135">In this example, we passed in a very upbeat message and received a score of over 0.98.</span></span> <span data-ttu-id="622dc-136">Versuchen Sie die Nachricht so zu ändern, dass sie weniger optimistisch ist, und führen Sie den Test erneut aus. Achten Sie auf die Antwort.</span><span class="sxs-lookup"><span data-stu-id="622dc-136">Try changing the message to something less optimistic, rerun the test, and note the response.</span></span>

## <a name="add-a-message-to-the-queue"></a><span data-ttu-id="622dc-137">Hinzufügen einer Meldung zur Warteschlange</span><span class="sxs-lookup"><span data-stu-id="622dc-137">Add a message to the queue</span></span>

<span data-ttu-id="622dc-138">Wiederholen Sie den Test.</span><span class="sxs-lookup"><span data-stu-id="622dc-138">Let's repeat the test.</span></span> <span data-ttu-id="622dc-139">Dieses Mal verwenden wir jedoch nicht das Testfenster im Portal, sondern platzieren eine Nachricht in der Eingabewarteschlange und beobachten, was geschieht.</span><span class="sxs-lookup"><span data-stu-id="622dc-139">This time, instead of using the Test window of the portal, we'll actually place a message into the input queue and watch what happens.</span></span>

1. <span data-ttu-id="622dc-140">Navigieren Sie im Portal im Abschnitt **Ressourcengruppen** zu Ihrer Ressourcengruppe.</span><span class="sxs-lookup"><span data-stu-id="622dc-140">Navigate to your resource group in the **Resource Groups** section of the portal.</span></span>

1. <span data-ttu-id="622dc-141">Wählen Sie <rgn>[Name der Sandboxressourcengruppe]</rgn> aus, die in dieser Lektion verwendete Ressourcengruppe.</span><span class="sxs-lookup"><span data-stu-id="622dc-141">Select <rgn>[sandbox resource group name]</rgn>, the resource group used in this lesson.</span></span>

1. <span data-ttu-id="622dc-142">Daraufhin öffnet sich der Bereich **Ressourcengruppe**. Wählen Sie hier den Eintrag „Speicherkonto“ aus.</span><span class="sxs-lookup"><span data-stu-id="622dc-142">In the **Resource group** panel that appears, locate the Storage Account entry, and select it.</span></span>

    ![Screenshot mit ausgewähltem Speicherkonto im Fenster „Ressourcengruppe“](../media/select-storage-account.png)

1. <span data-ttu-id="622dc-144">Klicken Sie im linken Menü des Hauptfensters für das Speicherkonto auf **Storage-Explorer (Vorschau)**.</span><span class="sxs-lookup"><span data-stu-id="622dc-144">Select **Storage Explorer (preview)** from the left menu of the Storage Account main window.</span></span> <span data-ttu-id="622dc-145">Daraufhin wird im Portal der Azure Storage-Explorer geöffnet.</span><span class="sxs-lookup"><span data-stu-id="622dc-145">This action opens the Azure Storage Explorer inside the portal.</span></span> 

    ![Screenshot des Storage-Explorers mit unserem Speicherkonto, derzeit ohne Warteschlange](../media/sa-no-queue.png)

    <span data-ttu-id="622dc-147">Wie Sie sehen können, enthält dieses Speicherkonto aktuell keine Warteschlangen. Fügen Sie daher eine hinzu.</span><span class="sxs-lookup"><span data-stu-id="622dc-147">As you can see, we don't have any queues in this storage account yet, so let's add one.</span></span>

5. <span data-ttu-id="622dc-148">Sie haben zu einem früheren Zeitpunkt in dieser Lektion die Ihrem Trigger zugeordnete Warteschlange **new-feedback-q** genannt.</span><span class="sxs-lookup"><span data-stu-id="622dc-148">If you remember from earlier in this lesson, we named the queue associated with our trigger **new-feedback-q**.</span></span> <span data-ttu-id="622dc-149">Klicken Sie im Storage-Explorer mit der rechten Maustaste auf das Element **Warteschlangen**, und wählen Sie *Warteschlange erstellen* aus.</span><span class="sxs-lookup"><span data-stu-id="622dc-149">Right-click on the **Queues** item in the Storage Explorer, and select *Create Queue*.</span></span>

1. <span data-ttu-id="622dc-150">Geben Sie im nun geöffneten Dialogfeld **new-feedback-q** ein, und klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="622dc-150">In the dialog that opens, enter **new-feedback-q** and click **OK**.</span></span> <span data-ttu-id="622dc-151">Jetzt verfügen wir über eine Eingabewarteschlange.</span><span class="sxs-lookup"><span data-stu-id="622dc-151">We now have our input queue.</span></span>

1. <span data-ttu-id="622dc-152">Wählen Sie im linken Menü die neue Warteschlange aus, um den Daten-Explorer für diese Warteschlange anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="622dc-152">Select the new queue in the left-hand menu to see the data explorer for this queue.</span></span> <span data-ttu-id="622dc-153">Wie zu erwarten, ist die Warteschlange leer.</span><span class="sxs-lookup"><span data-stu-id="622dc-153">As expected, the queue is empty.</span></span> <span data-ttu-id="622dc-154">Als Nächstes fügen wir der Warteschlange mithilfe des Befehls **Nachricht hinzufügen** am oberen Rand des Fensters eine Nachricht hinzu.</span><span class="sxs-lookup"><span data-stu-id="622dc-154">Let's add a message to the queue using the **Add Message** command at the top of the window.</span></span>

1. <span data-ttu-id="622dc-155">Geben Sie im Dialogfeld **Nachricht hinzufügen** den Text „Diese Nachricht kam von unserer Eingabewarteschlange new-feedback-q“ in das Feld **Nachrichtentext** ein, und klicken Sie unten im Dialogfeld auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="622dc-155">In the **Add Message** dialog, enter "This message came from our input queue, new-feedback-q" into the **Message text** field, and click **OK** at the bottom of the dialog.</span></span>

1. <span data-ttu-id="622dc-156">Beobachten Sie die Nachricht, die der im folgenden Screenshot ähnelt, im Daten-Explorer.</span><span class="sxs-lookup"><span data-stu-id="622dc-156">Observe the message, similar to the message in the following screenshot, in the data explorer.</span></span>
    <span data-ttu-id="622dc-157">![Screenshot des Speicher-Explorers mit unserem Speicherkonto und der in der Warteschlange erstellten Nachricht](../media/message-in-input-queue.png)</span><span class="sxs-lookup"><span data-stu-id="622dc-157">![Screenshot of Storage Explorer showing our storage account, with the message we created in the queue.](../media/message-in-input-queue.png)</span></span>

1. <span data-ttu-id="622dc-158">Klicken Sie nach einigen Sekunden auf **Aktualisieren**, um die Ansicht der Warteschlange zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="622dc-158">After a few seconds, click **Refresh** to refresh the view of the queue.</span></span> <span data-ttu-id="622dc-159">Beachten Sie, dass die Warteschlange wieder **leer** ist.</span><span class="sxs-lookup"><span data-stu-id="622dc-159">Observe that the queue is **empty** once again.</span></span> <span data-ttu-id="622dc-160">Die Nachricht in der Warteschlange muss gelesen worden sein.</span><span class="sxs-lookup"><span data-stu-id="622dc-160">Something must have read the message from the queue.</span></span>

1. <span data-ttu-id="622dc-161">Navigieren Sie zurück zu unserer Funktion im Portal, und öffnen Sie die Registerkarte **Überwachung**. Wählen Sie die neueste Meldung in der Liste aus.</span><span class="sxs-lookup"><span data-stu-id="622dc-161">Navigate back to our function in the portal, and open the **Monitor** tab. Select the newest message in the list.</span></span> <span data-ttu-id="622dc-162">Unsere Funktion hat die Warteschlangennachricht also verarbeitet, die wir an „new-feedback-q“ gesendet haben.</span><span class="sxs-lookup"><span data-stu-id="622dc-162">Observe that our function processed the queue message we had posted to the new-feedback-q.</span></span> <span data-ttu-id="622dc-163">Die Ergebnisse können sich in diesem Protokoll verzögern, sodass Sie möglicherweise einige Minuten warten und auf *Aktualisieren* klicken müssen.</span><span class="sxs-lookup"><span data-stu-id="622dc-163">Results may be delayed by in this log, so you might have to wait a few minutes and hit *Refresh*.</span></span>

    ![Screenshot des Überwachungsdashboards mit Anzeige eines Eintrags, der uns darüber informiert, dass unsere Funktion die in „new-feedback-q“ platzierte Nachricht verarbeitet hat.](../media/message-in-monitor.png)

    <span data-ttu-id="622dc-165">In diesem Test haben wir einen vollständigen Durchlauf ausgeführt, indem wir eine Nachricht in unsere Warteschlange eingereiht und dann gesehen haben, wie die Funktion die Nachricht verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="622dc-165">In this test, we did a complete round trip of posting something into our queue and then seeing the function process it.</span></span>

<span data-ttu-id="622dc-166">Wir machen Fortschritte mit unserer Lösung!</span><span class="sxs-lookup"><span data-stu-id="622dc-166">We're making progress with our solution!</span></span> <span data-ttu-id="622dc-167">Unsere Funktion erfüllt jetzt einen Nutzen.</span><span class="sxs-lookup"><span data-stu-id="622dc-167">Our function is now doing something useful.</span></span> <span data-ttu-id="622dc-168">Sie empfängt Text von unserer Eingabewarteschlange und ruft dann den Textanalyse-API-Dienst auf, um eine Bewertung abzurufen.</span><span class="sxs-lookup"><span data-stu-id="622dc-168">It's receiving text from our input queue and then calling out to the Text Analytics API service to get a sentiment score.</span></span> <span data-ttu-id="622dc-169">Darüber hinaus haben wir gelernt, wie wir unsere Funktion über das Azure-Portal und den Storage-Explorer testen.</span><span class="sxs-lookup"><span data-stu-id="622dc-169">We've also learned how to test our function through the Azure portal and the Storage Explorer.</span></span> <span data-ttu-id="622dc-170">In der nächsten Übung sehen wir uns an, wie einfach es ist, mithilfe von Ausgabebindungen Schreibvorgänge in Warteschlangen durchzuführen.</span><span class="sxs-lookup"><span data-stu-id="622dc-170">In the next exercise, we'll see how easy it is to write to queues using output bindings.</span></span>