<span data-ttu-id="df80e-101">Jede Funktion muss genau eine Triggerbindung besitzen.</span><span class="sxs-lookup"><span data-stu-id="df80e-101">Every function must have one, and only one, trigger binding.</span></span> <span data-ttu-id="df80e-102">Sie definiert, wie die Ausführung des Codes ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="df80e-102">It defines how our code is triggered to run.</span></span> <span data-ttu-id="df80e-103">Zusätzlich zu einem Trigger können wir auch Bindungen zur Verbindungsherstellung mit Datenquellen definieren.</span><span class="sxs-lookup"><span data-stu-id="df80e-103">In addition to a trigger, we can define bindings that connect us to data sources.</span></span> <span data-ttu-id="df80e-104">Wie in dem Lösungsdiagramm zu sehen, möchten wir Nachrichten an drei Warteschlangen senden.</span><span class="sxs-lookup"><span data-stu-id="df80e-104">If you remember from our diagram of the solution, we want to send messages to three queues.</span></span> <span data-ttu-id="df80e-105">Wir definieren daher diese Verbindungen als Ausgabebindungen in unserer Funktion.</span><span class="sxs-lookup"><span data-stu-id="df80e-105">So, we'll define those connections as output bindings in our function.</span></span> <span data-ttu-id="df80e-106">Diese Bindungen könnten wir über die Benutzeroberfläche **Ausgabebindung** erstellen.</span><span class="sxs-lookup"><span data-stu-id="df80e-106">We could create those bindings through the **Output binding** UI.</span></span> <span data-ttu-id="df80e-107">Aus Zeitgründen bearbeiten wir jedoch die Konfigurationsdatei direkt.</span><span class="sxs-lookup"><span data-stu-id="df80e-107">However, to save time, we'll edit the config file directly.</span></span>

1. <span data-ttu-id="df80e-108">Wählen Sie im Funktions-Apps-Portal die Funktion [!INCLUDE [func-name-discover](./func-name-discover.md)] aus.</span><span class="sxs-lookup"><span data-stu-id="df80e-108">Select our function, [!INCLUDE [func-name-discover](./func-name-discover.md)], in the Function Apps portal.</span></span>

1. <span data-ttu-id="df80e-109">Erweitern Sie auf der rechten Bildschirmseite das Menü **Dateien anzeigen**.</span><span class="sxs-lookup"><span data-stu-id="df80e-109">Expand the **View files** menu on the right of the screen.</span></span>

1. <span data-ttu-id="df80e-110">Klicken Sie auf der Registerkarte **Dateien anzeigen** auf **function.json**, um die Konfigurationsdatei im Editor zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="df80e-110">Under the **View files** tab, select **function.json** to open the config file in the editor.</span></span>

1. <span data-ttu-id="df80e-111">Ersetzen Sie den gesamten Inhalt der Konfigurationsdatei durch den folgenden JSON-Code.</span><span class="sxs-lookup"><span data-stu-id="df80e-111">Replace the entire content of the config file with the following JSON.</span></span> 

[!code-json[](../code/function.json)]

<span data-ttu-id="df80e-112">Wir haben der Konfiguration drei neue Bindungen hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="df80e-112">We've added three new bindings to the config.</span></span>

- <span data-ttu-id="df80e-113">Die neuen Bindungen sind jeweils vom Typ `queue`.</span><span class="sxs-lookup"><span data-stu-id="df80e-113">Each new binding is of type `queue`.</span></span> <span data-ttu-id="df80e-114">Diese Bindungen sind für die drei Warteschlangen vorgesehen, die wir mit unseren Feedbacknachrichten auffüllen, sobald wir die Stimmung des Feedbacks kennen.</span><span class="sxs-lookup"><span data-stu-id="df80e-114">These bindings are for the three queues that we'll populate with our feedback messages to once we know the sentiment of the feedback.</span></span>
- <span data-ttu-id="df80e-115">Jede Bindung verfügt über eine als `out` definierte Richtung, da wir Nachrichten an diese Warteschlangen übermitteln möchten.</span><span class="sxs-lookup"><span data-stu-id="df80e-115">Each binding has a direction defined as `out`, since we'll post messages to these queues.</span></span>
- <span data-ttu-id="df80e-116">Jede Bindung verwendet die gleiche Verbindung mit unserem Speicherkonto.</span><span class="sxs-lookup"><span data-stu-id="df80e-116">Each binding uses the same connection to our storage account.</span></span>
- <span data-ttu-id="df80e-117">Jede Bindung besitzt einen eindeutigen Warteschlangennamen (`queueName`) und einen eindeutigen Namen (`name`).</span><span class="sxs-lookup"><span data-stu-id="df80e-117">Each binding has a unique `queueName` and `name`.</span></span>

<span data-ttu-id="df80e-118">Eine Nachricht kann ganz einfach an eine Warteschlange übermittelt werden. Beispielsweise so: `context.bindings.negativeFeedbackQueueItem = "<message>"`.</span><span class="sxs-lookup"><span data-stu-id="df80e-118">Posting a message to a queue is as easy as saying, for example,  `context.bindings.negativeFeedbackQueueItem = "<message>"`.</span></span>

## <a name="update-implementation-to-sort-feedback-into-queues-based-on-sentiment-score"></a><span data-ttu-id="df80e-119">Aktualisieren der Implementierung, um Feedback auf der Grundlage des Stimmungswerts in Warteschlangen einzusortieren</span><span class="sxs-lookup"><span data-stu-id="df80e-119">Update implementation to sort feedback into queues based on sentiment score</span></span>

<span data-ttu-id="df80e-120">Unser Feedbacksortierer soll Feedback in drei Buckets (positiv, neutral und negativ) sortieren.</span><span class="sxs-lookup"><span data-stu-id="df80e-120">The goal of our feedback sorter is to sort feedback into three buckets, positive, neutral, and negative.</span></span> <span data-ttu-id="df80e-121">Wir verfügen bislang über eine Eingabewarteschlange sowie über Code zum Aufrufen der Textanalyse-API und haben unsere Ausgabewarteschlangen definiert.</span><span class="sxs-lookup"><span data-stu-id="df80e-121">So far, we have our input queue, our code to call Text Analytics API, and we've defined our output queues.</span></span> <span data-ttu-id="df80e-122">In diesem Abschnitt fügen wir die erforderliche Logik hinzu, um Nachrichten auf der Grundlage der Stimmung in diese Warteschlangen zu verschieben.</span><span class="sxs-lookup"><span data-stu-id="df80e-122">In this section, we'll add the logic to move messages into those queues based on sentiment.</span></span>

1. <span data-ttu-id="df80e-123">Navigieren Sie zur Funktion [!INCLUDE [func-name-discover](./func-name-discover.md)], und öffnen Sie erneut `index.js` im Code-Editor.</span><span class="sxs-lookup"><span data-stu-id="df80e-123">Navigate to our function, [!INCLUDE [func-name-discover](./func-name-discover.md)], and  open `index.js` in the code editor again.</span></span>

1. <span data-ttu-id="df80e-124">Ersetzen Sie die Implementierung durch die folgende Aktualisierung.</span><span class="sxs-lookup"><span data-stu-id="df80e-124">Replace the implementation with the following update.</span></span>
[!code-javascript[](../code/discover-sentiment+sort.js?highlight=25-48)]

<span data-ttu-id="df80e-125">Wir haben der Implementierung den hervorgehobenen Code hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="df80e-125">We've added the highlighted code to our implementation.</span></span> <span data-ttu-id="df80e-126">Der Code analysiert die Antwort der Textanalyse-API von Cognitive Services.</span><span class="sxs-lookup"><span data-stu-id="df80e-126">The code parses the response from the Text Analytics API cognitive service.</span></span> <span data-ttu-id="df80e-127">Die Nachricht wird auf der Grundlage des Stimmungswerts an eine der drei Ausgabewarteschlangen weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="df80e-127">Based on the sentiment score, the message is forwarded to one of or three output queues.</span></span> <span data-ttu-id="df80e-128">Der Code zum Veröffentlichen der Nachricht legt lediglich den korrekten Bindungsparameter fest.</span><span class="sxs-lookup"><span data-stu-id="df80e-128">The code to post the message is just setting the correct binding parameter.</span></span>

## <a name="try-it-out"></a><span data-ttu-id="df80e-129">Ausprobieren</span><span class="sxs-lookup"><span data-stu-id="df80e-129">Try it out</span></span>

<span data-ttu-id="df80e-130">Um die aktualisierte Implementierung zu testen, kehren wir zum Storage-Explorer zurück.</span><span class="sxs-lookup"><span data-stu-id="df80e-130">To test the updated implementation, we'll head back to the Storage Explorer.</span></span> 

1. <span data-ttu-id="df80e-131">Navigieren Sie im Portal im Abschnitt **Ressourcengruppen** zu Ihrer Ressourcengruppe.</span><span class="sxs-lookup"><span data-stu-id="df80e-131">Navigate to your resource group in the **Resource Groups** section of the portal.</span></span>

1. <span data-ttu-id="df80e-132">Wählen Sie die in dieser Lektion verwendete Ressourcengruppe aus.</span><span class="sxs-lookup"><span data-stu-id="df80e-132">Select the resource group used in this lesson.</span></span>

1. <span data-ttu-id="df80e-133">Daraufhin öffnet sich der Bereich **Ressourcengruppe**. Wählen Sie hier den Eintrag „Speicherkonto“ aus.</span><span class="sxs-lookup"><span data-stu-id="df80e-133">In the **Resource group** panel that opens, locate the Storage Account entry and select it.</span></span>
<span data-ttu-id="df80e-134">![Screenshot: Ausgewähltes Speicherkonto im Fenster „Ressourcengruppe“.](../media-draft/select-storage-account.png)</span><span class="sxs-lookup"><span data-stu-id="df80e-134">![Screenshot storage account selected in the Resource Group window.](../media-draft/select-storage-account.png)</span></span>

1. <span data-ttu-id="df80e-135">Klicken Sie im linken Menü des Hauptfensters „Speicherkonto“ auf **Storage-Explorer (Vorschau)**.</span><span class="sxs-lookup"><span data-stu-id="df80e-135">Select **Storage Explorer (preview)** from the left menu of the Storage Account main window.</span></span>  <span data-ttu-id="df80e-136">Daraufhin wird im Portal der Azure Storage-Explorer geöffnet.</span><span class="sxs-lookup"><span data-stu-id="df80e-136">This action opens the Azure Storage Explorer inside the portal.</span></span> <span data-ttu-id="df80e-137">Der Bildschirm sollte nun wie im folgenden Screenshot aussehen.</span><span class="sxs-lookup"><span data-stu-id="df80e-137">Your screen should look like the following screenshot at this stage.</span></span>
<span data-ttu-id="df80e-138">![Screenshot des Storage-Explorers mit unserem Speicherkonto und einer Warteschlange.](../media-draft/storage-explorer-menu-inputq.png)</span><span class="sxs-lookup"><span data-stu-id="df80e-138">![Screenshot of storage explorer showing our storage account, with one queue currently.](../media-draft/storage-explorer-menu-inputq.png)</span></span>

<span data-ttu-id="df80e-139">Unter der Sammlung **Warteschlangen** befindet sich eine einzelne Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="df80e-139">We have one queue listed under the **Queues** collection.</span></span> <span data-ttu-id="df80e-140">Dabei handelt es sich um [!INCLUDE [input-q](./q-name-input.md)] (die Eingabewarteschlange, die wir im vorherigen Testabschnitt des Moduls definiert haben).</span><span class="sxs-lookup"><span data-stu-id="df80e-140">This queue is [!INCLUDE [input-q](./q-name-input.md)],  the input queue we defined in the preceding test section of the module.</span></span>

1. <span data-ttu-id="df80e-141">Klicken Sie im linken Menü auf [!INCLUDE [input-q](./q-name-input.md)], um den Daten-Explorer für diese Warteschlange anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="df80e-141">Select [!INCLUDE [input-q](./q-name-input.md)] in the left-hand menu to see the data explorer for this queue.</span></span> <span data-ttu-id="df80e-142">Wie nicht anders zu erwarten, enthält die Warteschlange keine Daten.</span><span class="sxs-lookup"><span data-stu-id="df80e-142">As expected, the queue had no data.</span></span> <span data-ttu-id="df80e-143">Als Nächstes fügen wir der Warteschlange mithilfe des Befehls **Nachricht hinzufügen** am oberen Rand des Fensters eine Nachricht hinzu.</span><span class="sxs-lookup"><span data-stu-id="df80e-143">Let's add a message to the queue using the **Add Message** command at the top of the window.</span></span> 

1. <span data-ttu-id="df80e-144">Geben Sie im Dialogfeld **Nachricht hinzufügen** den Text „I'm having fun with this exercise!“</span><span class="sxs-lookup"><span data-stu-id="df80e-144">In the **Add Message** dialog, enter "I'm having fun with this exercise!"</span></span> <span data-ttu-id="df80e-145">in das Feld **Nachrichtentext** ein, und klicken Sie am unteren Rand des Dialogfelds auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="df80e-145">into the **Message text** field and click **OK** at the bottom of the dialog.</span></span> 

1. <span data-ttu-id="df80e-146">Die Nachricht wird im Datenfenster für [!INCLUDE [input-q](./q-name-input.md)] angezeigt.</span><span class="sxs-lookup"><span data-stu-id="df80e-146">The message is displayed in the data window for [!INCLUDE [input-q](./q-name-input.md)].</span></span> <span data-ttu-id="df80e-147">Klicken Sie nach einigen Sekunden am oberen Rand der Datenansicht auf **Aktualisieren**, um die Ansicht der Warteschlange zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="df80e-147">After a few seconds, click **Refresh** at the top of the data view to refresh the view of the queue.</span></span> <span data-ttu-id="df80e-148">Wie Sie sehen, verschwindet die Nachricht nach einer Weile.</span><span class="sxs-lookup"><span data-stu-id="df80e-148">Observe that the message disappears after a while.</span></span> <span data-ttu-id="df80e-149">Aber wohin?</span><span class="sxs-lookup"><span data-stu-id="df80e-149">So, where did it go?</span></span>

1. <span data-ttu-id="df80e-150">Klicken Sie im linken Menü mit der rechten Maustaste auf die Sammlung **WARTESCHLANGEN**.</span><span class="sxs-lookup"><span data-stu-id="df80e-150">Right-click on the **QUEUES** collection in the left-hand menu.</span></span> <span data-ttu-id="df80e-151">Dort sehen Sie, dass eine *neue* Warteschlange vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="df80e-151">Observe that a *new* queue has appeared.</span></span>
<span data-ttu-id="df80e-152">![Screenshot des Storage-Explorers mit einer neuen Warteschlange in der Sammlung.</span><span class="sxs-lookup"><span data-stu-id="df80e-152">![Screenshot of Storage Explorer with showing a new queue has been created in the collection.</span></span> <span data-ttu-id="df80e-153">Die Warteschlange enthält eine einzelne Nachricht.](../media-draft/sa-new-output-q.png)</span><span class="sxs-lookup"><span data-stu-id="df80e-153">The queue has one message.](../media-draft/sa-new-output-q.png)</span></span>

<span data-ttu-id="df80e-154">Die Warteschlange [!INCLUDE [positive-q](./q-name-positive.md)] wurde automatisch erstellt, als erstmals eine Nachricht an sie gesendet wurde.</span><span class="sxs-lookup"><span data-stu-id="df80e-154">The queue [!INCLUDE [positive-q](./q-name-positive.md)] was automatically created when a message was posted to it for the first time.</span></span> <span data-ttu-id="df80e-155">Mit Ausgabebindungen für Azure Functions-Warteschlangen müssen Sie die Ausgabewarteschlange nicht erst manuell erstellen, bevor Sie etwas an sie senden.</span><span class="sxs-lookup"><span data-stu-id="df80e-155">With Azure Functions queue output bindings, you don't have to manually create the output queue before posting to it!</span></span> <span data-ttu-id="df80e-156">Nachdem durch unsere Funktion offenbar eine eingehende Nachricht in [!INCLUDE [positive-q](./q-name-positive.md)] einsortiert wurde, sehen wir uns als Nächstes an, wo die folgenden Nachrichten platziert werden.</span><span class="sxs-lookup"><span data-stu-id="df80e-156">Now that we see an incoming message has been sorted by our function into [!INCLUDE [positive-q](./q-name-positive.md)], let's see where the following messages land.</span></span>

5. <span data-ttu-id="df80e-157">Fügen Sie [!INCLUDE [input-q](./q-name-input.md)] mithilfe der Schritte von weiter oben folgende Nachrichten hinzu.</span><span class="sxs-lookup"><span data-stu-id="df80e-157">Using the same steps as above, add the following messages to [!INCLUDE [input-q](./q-name-input.md)].</span></span>

- <span data-ttu-id="df80e-158">„I like broccoli!“</span><span class="sxs-lookup"><span data-stu-id="df80e-158">"I like broccoli!"</span></span>
- <span data-ttu-id="df80e-159">„Microsoft is a company“</span><span class="sxs-lookup"><span data-stu-id="df80e-159">"Microsoft is a company"</span></span>

6. <span data-ttu-id="df80e-160">Klicken Sie auf **Aktualisieren**, bis [!INCLUDE [input-q](./q-name-input.md)] wieder leer ist.</span><span class="sxs-lookup"><span data-stu-id="df80e-160">Click **Refresh** until [!INCLUDE [input-q](./q-name-input.md)] is empty once again.</span></span> <span data-ttu-id="df80e-161">Das kann etwas dauern und mehrere Aktualisierungen erfordern.</span><span class="sxs-lookup"><span data-stu-id="df80e-161">This process might take a few moments and require several refreshes.</span></span>

1. <span data-ttu-id="df80e-162">Klicken Sie mit der rechten Maustaste auf die Sammlung **WARTESCHLANGEN**. Hier werden nun zwei weitere Warteschlangen angezeigt.</span><span class="sxs-lookup"><span data-stu-id="df80e-162">Right-click on the **QUEUES** collection and observe two more queues appearing.</span></span> <span data-ttu-id="df80e-163">Die Warteschlangen heißen [!INCLUDE [neutral-q](./q-name-neutral.md)] und [!INCLUDE [negative-q](./q-name-negative.md)].</span><span class="sxs-lookup"><span data-stu-id="df80e-163">The queues are named [!INCLUDE [neutral-q](./q-name-neutral.md)] and [!INCLUDE [negative-q](./q-name-negative.md)].</span></span> <span data-ttu-id="df80e-164">Der Vorgang dauert unter Umständen etwas. Aktualisiert Sie die Sammlung **WARTESCHLANGEN**, bis die neuen Warteschlangen angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="df80e-164">This might take a few seconds, so continue refreshing the **QUEUES** collection until new queues.</span></span> <span data-ttu-id="df80e-165">Danach sollte Ihre Warteschlangenliste wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="df80e-165">When complete, your queue list should look like the following.</span></span>

![Screenshot des Storage-Explorer-Menüs mit vier Warteschlangen in der Sammlung „WARTESCHLANGEN“.](../media-draft/sa-final-q-list.png)

<span data-ttu-id="df80e-167">Klicken Sie auf die einzelnen Warteschlangen in der Liste, um zu sehen, ob sie über Nachrichten verfügen.</span><span class="sxs-lookup"><span data-stu-id="df80e-167">Click on each queue in the list to see whether they have messages.</span></span> <span data-ttu-id="df80e-168">Wenn Sie die vorgeschlagenen Nachrichten hinzugefügt haben, sollte in [!INCLUDE [positive-q](./q-name-positive.md)], [!INCLUDE [neutral-q](./q-name-neutral.md)] und [!INCLUDE [negative-q](./q-name-negative.md)] jeweils eine Nachricht enthalten sein.</span><span class="sxs-lookup"><span data-stu-id="df80e-168">If you added the suggested messages, you should see one message in [!INCLUDE [positive-q](./q-name-positive.md)], [!INCLUDE [neutral-q](./q-name-neutral.md)], and [!INCLUDE [negative-q](./q-name-negative.md)].</span></span>

<span data-ttu-id="df80e-169">Herzlichen Glückwunsch!</span><span class="sxs-lookup"><span data-stu-id="df80e-169">Congratulations!</span></span> <span data-ttu-id="df80e-170">Sie verfügen nun über einen funktionierenden Feedbacksortierer.</span><span class="sxs-lookup"><span data-stu-id="df80e-170">We now have a working feedback sorter!</span></span> <span data-ttu-id="df80e-171">Wenn Nachrichten bei der Eingabewarteschlange eingehen, ruft unsere Funktion mithilfe des Textanalyse-API-Diensts einen Stimmungswert ab.</span><span class="sxs-lookup"><span data-stu-id="df80e-171">As messages arrive in the input queue, our function uses the Text Analytics API service to get a sentiment score.</span></span> <span data-ttu-id="df80e-172">Anschließend werden die Nachrichten auf der Grundlage dieses Werts an die entsprechende Warteschlange weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="df80e-172">Based on that score, the function forwards the messages to the appropriate queue.</span></span> <span data-ttu-id="df80e-173">Es sieht vielleicht so aus, als würde die Funktion immer nur ein Warteschlangenelement verarbeiten. Tatsächlich liest die Azure Functions-Laufzeit aber Batches mit Warteschlangenelementen und startet weitere Instanzen unserer Funktion, um sie parallel zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="df80e-173">While it seems like the function processes only one queue item at a time, the Azure Functions runtime will actually read batches of queue items and spin up other instances of our function to process them in parallel.</span></span> 